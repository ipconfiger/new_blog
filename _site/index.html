<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>å‹åŠ›å¾ˆå¤§åŒå¿—çš„BLOG</title>
  <meta name="description" content="">
  <link rel="stylesheet" href="/css/main.css">
</head>

  <body>

    <div class="site-header">

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <i class="fa fa-navicon fa-lg"></i>
      </a>

      <div class="trigger">
          <a class="page-link" href="/"> Home</a>
        
          
          <a class="page-link" href="/about.html">å…³äºå‹åŠ›</a>
          
        
      </div>
    </nav>


</div>

    <div class="page-content">
      <div class="wrapper">
        

    <div class="post">
        <h3><a href="/2016-08-26/true_lies.html">çœŸå®çš„è°è¨€</a></h3>
      
        <div class="body">
            <p><img alt="" src="http://oaye9fj7h.bkt.clouddn.com/A10D589B-431D-4E23-9208-EAC6DC5796E3_20160826213033.jpeg" /></p>
<p>æœ€è¿‘ç‹å®å¼ºçš„å®¶äº‹å¾ˆç«çˆ†å•Š.ä¸€ä¸ªè‰æ ¹æ˜æ˜Ÿçš„å©šå˜åˆºæ¿€äº†å„è·¯ç”·å±Œä¸,å¥³å±Œä¸,äººå¦–å±Œä¸çš„ç¥ç»,åå…«è·¯è¯¸ä¾¯è®¨ä¼è‘£å“çš„æ—¶å€™ä¹Ÿæ²¡æœ‰è¿™èˆ¬çƒ­é—¹å§.ä¸è¿‡é©¬è“‰çš„è°è¨€å’Œæœ¬æ–‡æ²¡æœ‰åŠæ¯›é’±å…³ç³».æˆ‘ä»Šå¤©æƒ³è¯´è¯´çœŸå®çš„è°è¨€.æ²¡æœ‰è°è¨€çš„äººç”Ÿæ˜¯ä¸çœŸå®è€Œè™šå¹»çš„,é‚£æ ·çš„äººç”Ÿå¹¶ä¸å­˜åœ¨,æ€»è€Œè¨€ä¹‹è¨€è€Œæ€»ä¹‹,å“ªæ€•æ˜¯è™šå¹»åˆ°åœ£äººçº§åˆ«çš„äººä¹Ÿæ²¡æœ‰åŠæ³•é¿å…ä¸€ä»¶äº‹æƒ…,é‚£å°±æ˜¯éª—äºº,å°±ç®—æ˜¯ä¸éª—åˆ«äºº,å¤šåŠä¹Ÿä¼šéª—éª—è‡ªå·±.  </p>
<p>ç”·å¥³ä¹‹é—´éª—æ¥éª—å»æ²¡æœ‰æ„æ€çš„,æ‰€ä»¥å…¶å®æˆ‘æƒ³è¯´å¾—å…¶å®æ˜¯è·Ÿå¤§å®¶æ›´åŠ æ¯æ¯ç›¸å…³çš„,å½“ç„¶ä¹Ÿå’Œå°æ¹¾éª—å­è¿˜æœ‰å–ä¿å¥é…’çš„æ²¡æœ‰å…³ç³».æ—¢ç„¶äººäººéš¾å…æ’’è°,é‚£ä¹ˆæˆ‘ä»¬åœ¨ä»€ä¹ˆæ—¶å€™æœ€å®¹æ˜“ä¸‹æ„è¯†çš„æ’’è°å‘¢?å…¶å®å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¸‹æ„è¯†çš„ä¼šåœ¨å¯¹å¤–è¡¨è¾¾çš„æ—¶å€™å€¾å‘äºæœ‰åˆ©äºè‡ªå·±çš„æ–¹å‘å»åå‘,æˆ–è€…æ˜¯å€¾å‘äºè‡ªå·±æœ€å–œæ¬¢æˆ–è€…æœ€æƒ³è¦çš„æ–¹å‘.æ‰€ä»¥å¾ˆå¤šæ—¶å€™äººä»¬åœ¨é¢å¯¹åŒ»ç”Ÿçš„æ—¶å€™éƒ½ä¼šä¸‹æ„è¯†çš„æ’’è°,å¹¶ä¸æ˜¯å› ä¸ºæˆ‘ä»¬æ¬ºéª—åŒ»ç”Ÿèƒ½å¯¹ç—…æƒ…æœ‰å¥½å¤„,ä½†æ˜¯å› ä¸ºä¸åŒçš„å¿ƒç†åŸå› ,æˆ‘ä»¬å¾€å¾€è¿‡ä»½å¤¸å¤§æˆ–è€…ä¼šéšè—éƒ¨åˆ†çš„ç—…æƒ….åŸå› å…¶å®ä¹Ÿæ— éå°±æ˜¯æœŸæœ›ç—…æƒ…å¹¶éæœ‰å¤šä¸¥é‡,æˆ–è€…æ˜¯è¿‡ä»½æ‹…å¿ƒç—…æƒ…è€Œä¸‹æ„è¯†çš„å¯¹äº‹å®ä½œå‡ºäº†ä¿®æ”¹.æ‰€ä»¥å…¶å®æˆ‘ä»¬å¯¹äº‹å®çš„æè¿°å¾€å¾€éƒ½æ˜¯ä¸çœŸå®å’Œå®¢è§‚çš„.  </p>
<p>åŒ»è€…,æœ›é—»é—®åˆ‡,ä¼šé—®å–„é—®æ˜¯è‰¯åŒ»çš„å¿…å¤‡æŠ€èƒ½,æ—¢ç„¶å¤§å¤šæ•°ç—…äººåœ¨é¢å¯¹åŒ»ç”Ÿçš„æ—¶å€™éƒ½ä¼šæ’’è°,é‚£ä¹ˆåœ¨è°è¨€é‡Œæ‰¾åˆ°çœŸç›¸å¯¹åŒ»ç”Ÿæ¥è¯´éå¸¸çš„é‡è¦.å½“ç„¶æˆ‘ä¸æ˜¯åŒ»ç”Ÿ,ä¸è¿‡åœ¨ç»™ç³»ç»Ÿè¯Šæ–­é”™è¯¯,åœ¨é¢å¯¹å®¢æˆ·çš„æŠ•è¯‰çš„æ—¶å€™,æˆ‘ä»¬è¦åšçš„äº‹æƒ…å…¶å®å’ŒåŒ»ç”Ÿä¹Ÿå·®ä¸å¤š,é‡åˆ°bugçš„å®¢æˆ·å…¶å®å’Œç—…äººæ²¡å•¥åŒºåˆ«,å¾€å¾€ä¸ºäº†è®©è‡ªå·±å åˆ°ä¾¿å®œå¾€å¾€ä¹Ÿä¼šå¤¸å¤§å…¶è¾,æœ‰æ—¶å€™ç”šè‡³ä¸æƒœæ’’è°(æé€ äº‹å®, æ˜¯çœŸæ’’è°, æ— ä¸­ç”Ÿæœ‰é‚£ç§).æ‰€ä»¥å®¢æˆ·ä½ ä¸èƒ½ä¸ä¿¡ä»–,ä¹Ÿä¸èƒ½å…¨ä¿¡ä»–,æ¯æŠ¥ä¸€ä¸ªBUGå°±æ˜¯ä¸€å‡ºæ–°çš„ç½—ç”Ÿé—¨.  </p>
<p>å…¶å®æˆ‘å†™çš„ä¹Ÿæœ‰æ‰€åå¥½,ä½ ä»¬åƒä¸‡åˆ«ä¿¡.å¤äººæ›°å¾—å¥½,ä¿¡ä¹‹è€…æ­»,å­¦ä¹‹è€…ç”Ÿ.  </p>
        </div>
        
        <div class="meta">
            Posted on <a href="/2016-08-26/true_lies.html">2016-08-26 00:00:00</a>
        </div>
    </div>

    <div class="post">
        <h3><a href="/2016-03-16/server-side-swift.html">ç”¨swiftå¼€å‘æœåŠ¡ç«¯åº”ç”¨</a></h3>
      
        <div class="body">
            <p>å»å¹´Swiftå¼€æºçš„æ—¶å€™å°±æ‰“ç®—è¯•è¯•ç”¨Swiftæ¥å¼€å‘æœåŠ¡ç«¯äº†, ä¸è¿‡äº‹æƒ…å¤ªå¤š, å¾ˆå¤šè½®å­ä¹Ÿä¸å…·å¤‡, å¤§æŠµä¸Šéœ€è¦è‡ªå·±é‡å†™å¾ˆå¤šä¸œè¥¿, ä½†æ˜¯äººæ°‘çš„åŠ›é‡æ˜¯å¼ºå¤§çš„, å‡ ä¸ªæœˆè¿‡å»å, å¤§æ‰¹çš„è½®å­å·²ç»åœ¨è·¯ä¸Šäº†, ç”±äºIBMçš„é‡‘å¤§è…¿åŠ å…¥, Swiftè¿›å…¥åç«¯å¼€å‘çš„è¿›åº¦æ˜æ˜¾çš„åŠ å¿«äº†.IBMçš„äº‘è®¡ç®—æœåŠ¡å·²ç»æ”¯æŒSwiftä½œä¸ºåç«¯æœåŠ¡çš„å¼€å‘è¯­è¨€, å¹¶ä¸”æ¨å‡ºäº†Swiftçš„Webæ¡†æ¶:<a href="https://github.com/IBM-Swift/Kitura">Kitura </a> . ä¸è¿‡ç»è¿‡ä¸¤å¤©è¯•ç”¨åå‘ç°æ­¤è´§ç¼–è¯‘å°¤å…¶éº»çƒ¦, releaseç¼–è¯‘è‡³ä»Šæ²¡æœ‰é€šè¿‡è¿‡ä¸€æ¬¡, ä¸”debugæ¨¡å¼ä¸‹æ€§èƒ½é—®é¢˜ä¹Ÿå¾ˆçªå‡º, é‚æ”¾å¼ƒä¹‹, åæ¥åœ¨å…¨çƒè‘—åçš„åŒæ€§äº¤å‹ç½‘ç«™ä¸Šæ‰¾åˆ°å¦å¤–ä¸€ä¸ªstarè¶…é«˜çš„æ¡†æ¶:<a href="https://github.com/necolt/Swifton">Swifton</a></p>
<p>è¿™ä¸ªæ¡†æ¶çš„åå­—å¾ˆæœ‰æ„æ€</p>
<p><img alt="" src="http://ww1.sinaimg.cn/large/578b198bgw1f20xcpria0j20zi0l2afy.jpg" />
ç”±äºè·¯ç”±è¿™äº›éƒ½æ˜¯ç…§æ¬Rails, è€Œä¸”åˆæ²¡æœ‰ORM, è„šæ‰‹æ¶å‘½ä»¤æ›´æ˜¯ç©ºè¯, æ–‡æ¡£å°±æ›´æ˜¯å› é™‹å°±ç®€äº†, æ‰€ä»¥å¦‚æœswiftæ¯”è¾ƒç†Ÿç»ƒçš„è¯è‡ªå·±RTFCæ˜¯æ¯”è¾ƒå¥½çš„é€‰æ‹©.</p>
<h2>ç¯å¢ƒé¢„å¤‡</h2>
<p>Swiftçš„æœåŠ¡ç«¯ç¯å¢ƒç°åœ¨è€Œä»Šçœ¼ç›®ä¸‹çš„çŠ¶å†µæ˜¯æ¯”è¾ƒå±€ä¿ƒçš„, å¦‚æœä¸å·®é’±ä¹°ä¸ªåƒåœ¾æ¡¶æ‹¿å»æ‰˜ç®¡, ä¹Ÿok, è¦æ˜¯è‡ªå·±å‡†å¤‡Linuxç¯å¢ƒçš„è¯ä¹Ÿå°±åªèƒ½Ubuntuäº†,å¹¸äºè¿™ä¸ªè¿˜æ˜¯æ¯”è¾ƒä¸»æµçš„,ä¸è¿‡å¥½äº›é¡¹ç›®éƒ½åœ¨Centosä¸Š, ğŸ˜‚ğŸ˜‚ğŸ˜‚ğŸ˜‚ğŸ˜‚ğŸ˜‚
æœ¬åœ°å¼€å‘ç¯å¢ƒæ¯”è¾ƒå¥½è§£å†³, å¤šäºäº†IBMçš„é‡‘å¤§è…¿, <a href="https://github.com/IBM-Swift/Kitura">Kitura </a>  çš„Reponsitoryé‡Œæœ‰Dockerçš„è„šæœ¬å’ŒVagrantçš„vagrantfile. ç”±äºæˆ‘åœ¨æœ¬åœ°å¼€å‘ç”¨çš„æ˜¯Vagrant, æ‰€ä»¥åªéœ€è¦copyè¿™ä¸ªfileåˆ°é¡¹ç›®ç›®å½•ä¸‹, ç„¶åvagrant up, ç»è¿‡æ¼«é•¿çš„ç­‰å¾…(å¤§æ¦‚20åˆ†é’Ÿ), Swiftçš„æœ¬åœ°è°ƒè¯•ç¯å¢ƒå°±æ­å»ºå¥½äº†. </p>
<h2>å¼€å§‹å¿«ä¹çš„coding</h2>
<p>é¦–å…ˆå»ºç«‹ä¸€ä¸ªé¡¹ç›®</p>
<pre><code>$~/project_path&gt;swift build --init 
Creating Package.swift
Creating .gitignore
Creating Sources/
Creating Sources/main.swift
Creating Tests/
</code></pre>
<p>ç„¶ååŠ å…¥Swiftonçš„ä¾èµ–, vim Package.swift, åŠ å…¥ä¾èµ–åå°±æ˜¯ä¸‹é¢è¿™æ ·å­:</p>
<pre><code>dependencies: [
              .Package(url: "https://github.com/necolt/Swifton.git",     versions: Version(0,0,5)..&lt;Version(1,0,0)),
              .Package(url: "https://github.com/necolt/Curassow.git", versions: Version(0,4,0)..&lt;Version(1,0,0)),
         ]
</code></pre>
<p>å»ä¸­Curassowæ˜¯ä¸€ä¸ªåµŒå…¥å¼çš„Http Server, éƒ¨ç½²çš„æ—¶å€™ç”¨å®ƒæ¥éƒ¨ç½², å¥½å¤„æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒå¯ä»¥ç›´æ¥å¯åŠ¨å¤šä¸ªè¿›ç¨‹æ¥æé«˜æ€§èƒ½.
ä¹‹åç”¨</p>
<pre><code>$~/project_path&gt;swift build
</code></pre>
<p>å°±å¼€å§‹ä¸‹è½½ä¾èµ–å¼€å§‹ç¼–è¯‘äº†. ä¸è¿‡ä¸–äº‹æ— å¸¸, è¿™é‡Œç¼–è¯‘å¿…å®šæ˜¯ä¼šå‡ºé”™çš„. å› ä¸ºSwift  buildåœ¨Devç‰ˆåŠ å…¥äº†TeståŠŸèƒ½, ç„¶åæœ‰ä¸ªbug, ä¼šå’Œå¾ˆå¤šè‡ªå¸¦äº†Testé¡¹ç›®çš„Testsç›®å½•å†²çª, ç¼–è¯‘çš„æ—¶å€™æŠ¥æ‰¾ä¸åˆ°Testsç›®å½•ä¸‹çš„èµ„æº. æ‰€ä»¥è¿™é‡Œéœ€è¦æ‰‹åŠ¨åˆ é™¤ä¸¤ä¸ªé¡¹ç›®ä¸‹çš„Testsç›®å½•</p>
<pre><code>$~/project_path&gt;rm -rf ./Packages/PathKit-0.6.1/Tests
$~/project_path&gt;rm -rf ./Packages/Stencil-0.5.3/Tests
</code></pre>
<p>ä¹‹åå†è¿è¡Œç¼–è¯‘å°±ä¼šç›´æ¥é€šè¿‡äº†.
å½“ç„¶ç°åœ¨å•¥ä¹Ÿå¹²ä¸äº†, åªèƒ½è¯æ˜ç¯å¢ƒé€šé¡ºäº†, ä¸‹é¢å¼€å§‹æ­£å¼coding.</p>
<p>å…ˆåˆ›å»ºä¸€ä¸ªController.</p>
<pre><code>$~/project_path&gt;touch ./Sources/HelloController.swift
</code></pre>
<p>å†™å…¥å¦‚ä¸‹å†…å®¹:</p>
<pre><code>import Swifton

class HelloController:Controller{
    override init() {
        super.init()
        action("index") {request in
            return renderJSON(["hello": "world"])
        }
    }
}
</code></pre>
<p>ç„¶ååœ¨main.swifté‡Œè¿™ä¹ˆå†™:</p>
<pre><code>import Swifton
import Curassow
let router = Router()
router.get("/", HelloController()["index"])
serve { router.respond($0) }
</code></pre>
<p>ç„¶åç¼–è¯‘</p>
<pre><code>$~/project_path&gt;swift build
Compiling Swift Module 'test00' (2 sources)
Linking project_name
</code></pre>
<p>è¿è¡Œ:</p>
<pre><code>$~/project_path&gt;.build/debug/project_name
[2016-03-18 12:34:23 +0800] [80691] [INFO] Listening at http://0.0.0.0:8000    (80691)
[2016-03-18 12:34:23 +0800] [80692] [INFO] Booting worker process with pid: 80692
</code></pre>
<p>è¿™ä¸ªæ—¶å€™åœ¨æµè§ˆå™¨é‡Œæ‰“å¼€ http://127.0.0.1:8000 </p>
<p>æ‰“ä¸å¼€</p>
<p>å¯¹çš„, ä¸çœ‹åˆ°è¿™é‡Œçš„äººæ˜¯ä¼šæ‰å‘é‡Œçš„, æˆ‘æ•…æ„çš„.
å› ä¸ºåœ¨Kituraçš„vagrantfileé‡Œæ˜ å°„çš„ç«¯å£æ˜¯8090åˆ°8090, æ‰€ä»¥8000åœ¨å¤–è¾¹æ˜¯è®¿é—®ä¸åˆ°çš„, æœ‰ä¸¤ä¸ªæ–¹æ³•å¯ä»¥è§£å†³, ä¸€ä¸ªæ˜¯ä¿®æ”¹å¯åŠ¨çš„æ–¹å¼, ç”¨å‚æ•° --bind 0.0.0.0:8090. æˆ–è€…ç›´æ¥ä¿®æ”¹vagrantfileé‡Œçš„ç«¯å£æ˜ å°„éƒ¨åˆ†, å¤šåŠ ä¸ª8000åˆ°8000çš„æ˜ å°„å³å¯
ç„¶åç”¨æµè§ˆå™¨æ‰“å¼€, å°±ä¼šå‡ºç°ä¹…è¿çš„ </p>
<pre><code>{"hello": "world"}
</code></pre>
<h2>æ€»ç»“ä¸€ä¸‹</h2>
<p>å¤§ä½“ä¸Šæ¥è¯´ç”¨Swiftæ¥å¼€å‘æœåŠ¡ç«¯åº”ç”¨åº”è¯¥å…·å¤‡å¯ä»¥ç©è€çš„èƒ½åŠ›äº†, ä½†æ˜¯ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ç°åœ¨è¿˜ç¼ºä¹å¤§é‡çš„è½®å­ä»¥åŠæ–‡æ¡£å’Œå®æ“ç»éªŒ.
é€šè¿‡å¯¹Swiftonçš„ä»£ç ç ”ç©¶å‘ç°, Swiftçš„è¡¨è¾¾èƒ½åŠ›è¿˜æ˜¯å¾ˆå¼ºçš„, Swiftonçš„ä»£ç ç›¸å½“çš„çŸ­å°ç²¾æ‚. Curassowä¹Ÿæ˜¯ä¸€ä¸ªä»¿Gunicornçš„Server, çº¯Swiftå®ç°, ä¹Ÿéå¸¸çš„å€¼å¾—ç ”ç©¶ä»£ç , æ€§èƒ½å®æµ‹ç”±äºMacæœ¬åœ°å¹¶å‘æ•°çš„é™åˆ¶æ²¡æœ‰æ¢åˆ°å¤´, æœ‰ç©ºæ‰¾ä¸¤å°Ubuntuçš„æœºå™¨æ¥å®æµ‹ä¸€ä¸‹Curassow</p>
        </div>
        
        <div class="meta">
            Posted on <a href="/2016-03-16/server-side-swift.html">2016-03-16 00:00:00</a>
        </div>
    </div>

    <div class="post">
        <h3><a href="/2015-07-19/bananatoast.html">ç¨‹åºå‘˜å¿«æ‰‹è¥å…»æ—©é¤->é¦™è•‰åå¸å·</a></h3>
      
        <div class="body">
            <p>å¤è¯­æœ‰äº‘äººæ˜¯é“é¥­æ˜¯é’¢ä¸€é¡¿ä¸åƒé¥¿å¾—æ…Œï¼Œæ—©é¤æ›´æ˜¯ä¸‰é¤ä¸­æœ€é‡è¦çš„ä¸€é¡¿ï¼Œä¸€é¡¿ä¸°ç››ç¾å‘³çš„æ—©é¤å¯ä»¥åœ¨ä¸€å¤©å¼€å§‹çš„æ—¶å€™ç»™äººå……æ»¡èƒ½é‡ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œé«˜çƒ­é‡é£Ÿå“åœ¨è¿™ä¸ªæ—¶å€™æ˜¯å¯ä»¥éšä¾¿åƒçš„ï¼Œä¸ç®¡ä½ æ˜¯ä¸æ˜¯åœ¨å‡è‚¥ï¼Œå¯¹ä¸€ä¸ªæ•´å¤©åç€ä¸åŠ¨çš„ç¨‹åºå‘˜æ¥è¯´ï¼Œæ—©é¤æ›´æ˜¯éå¸¸çš„é‡è¦ï¼ˆä¸åƒæ—©é¤æ˜¯ä¸å¯¹çš„ï¼Œåƒä¸‡æ³¨æ„ï¼‰ã€‚</p>
<p>ä»Šå¤©æˆ‘ä»¬è¦åšçš„æ˜¯ä¸€æ¬¾ææ–™æ˜“å¾—ï¼Œåˆ¶ä½œç®€å•å¿«æ·ï¼Œè¥å…»ä¸°å¯Œçƒ­é‡å……è¶³çš„å¿«æ‰‹æ—©é¤ï¼Œé¦™è•‰åå¸å·ã€‚</p>
<p>ä¸‹é¢æ˜¯æˆ‘ä»¬éœ€è¦ç”¨åˆ°çš„ææ–™å’Œå™¨å…·</p>
<p><img alt="image" src="http://ww2.sinaimg.cn/large/578b198bgw1eu846cl35hj208c069q3p.jpg" /></p>
<ol>
<li>èœæ¿å½“ä½œæ¡ˆæ¿ä½¿ç”¨ï¼Œæ˜¯æ•´ä¸ªæ“ä½œçš„å¹³å°</li>
<li>åå¸ç‰‡</li>
<li>å°ç±³è•‰</li>
<li>é¸¡è›‹</li>
<li>çƒ§çƒ¤é“ç®”</li>
<li>ä¿é²œè†œ</li>
<li>ç©ºæ°”ç‚¸é”…ï¼ˆçƒ¤ç®±ï¼‰</li>
</ol>
<p>ç­‰ç­‰ï¼Œé‚£ä¸ªä¹±å…¥çš„æ‰‡å­æ˜¯æ€ä¹ˆå›äº‹ï¼Œå…¶å®æœ¬æ¥è¿™é‡Œéœ€è¦çš„æ˜¯å¯¿å¸å¸˜ï¼Œä½†æ˜¯æˆ‘å®¶é‡Œçš„å› ä¸ºå¸¸å¹´ä¸ç”¨å·²ç»åˆ’æ‰äº†ï¼Œæ‰€ä»¥è¿™é‡Œç”¨éšå¤„å¯å¾—çš„æ‰‡å­ä»£æ›¿ï¼Œå½“ç„¶ä¸èƒ½æŠŠææ–™ç›´æ¥æ”¾æ‰‡å­ä¸Šï¼Œæ‰€ä»¥è¯·å‡ºäº†ä¿é²œè†œåŠ©é˜µã€‚</p>
<p>ç©ºæ°”ç‚¸é”…ä¸æ˜¯å¿…å¤‡çš„ï¼Œåªæ˜¯å®¶é‡Œæ²¡æœ‰çƒ¤ç®±ç”¨æ¥ä»£æ›¿çƒ¤ç®±ä½¿ç”¨çš„ï¼Œå¦‚æœä½ å®¶é‡Œè¿™ä¸¤ä¸ªéƒ½ä¹ˆæœ‰ï¼Œé‚£ä¹ˆå»ä¹°ä¸ªç©ºæ°”ç‚¸é”…å§ï¼Œå‡ ç™¾å…ƒæå®šï¼Œå¯çƒ¤å¯ç‚¸ï¼ŒçœŸçš„æ˜¯å±…å®¶æ—…è¡Œæ€äººè¶Šè´§å¿…å¤‡çš„ç¥å™¨ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆè¦åšä¸€äº›å‡†å¤‡å·¥ä½œï¼Œé¦–å…ˆæ˜¯ç»™ç©ºæ°”ç‚¸é”…ï¼ˆçƒ¤ç®±ï¼‰é¢„çƒ­ï¼Œæ¸©åº¦200åº¦ï¼Œæ—¶é—´æ˜¯äº”åˆ†é’Ÿ</p>
<p><img alt="image" src="http://ww4.sinaimg.cn/large/578b198bgw1eu84f0xxbmj208c0b4aau.jpg" /></p>
<p>åœ¨ç­‰é¢„çƒ­çš„äº”åˆ†é’Ÿæˆ‘ä»¬å°±å¯ä»¥æŠŠå…¶ä»–çš„å‡†å¤‡å·¥ä½œåšå®Œã€‚é¦–å…ˆæ’•ä¸€ç‰‡é“ç®”åšä¸€ä¸ªç›’å­ï¼Œå¾…ä¼šå„¿ç”¨æ¥è£…é£Ÿç‰©ç”¨</p>
<p><img alt="image" src="http://ww3.sinaimg.cn/large/578b198bgw1eu84h60zjyj208c069dgl.jpg" /></p>
<p>ç„¶åè°ƒä¸€ä¸ªé¸¡è›‹</p>
<p><img alt="image" src="http://ww3.sinaimg.cn/large/578b198bgw1eu84hin5stj208c0b43zg.jpg" /></p>
<p>ä¸‹é¢æ˜¯å¤§æ€å™¨å¡‘æ–™æ‰‡å­å‡ºåœºäº†ï¼ŒæŠŠæ‰‡å­æ”¾æ¡ˆæ¿ä¸Šï¼Œç„¶åæ’•ä¸€ç‰‡ä¿é²œè†œæ”¾ä¸Šé¢</p>
<p><img alt="image" src="http://ww1.sinaimg.cn/large/578b198bgw1eu84ii5t03j208c0b4jsi.jpg" /></p>
<p>ç„¶åæ”¾ä¸Šä¸€ç‰‡åå¸ï¼Œå†å‰¥ä¸€æ ¹é¦™è•‰æ”¾åœ¨åå¸ä¸Šï¼Œä¹‹æ‰€ä»¥é€‰å°ç±³è•‰ï¼Œå°±æ˜¯çœ‹ä¸­è¿™è´§è·Ÿåå¸çš„é•¿åº¦å·®ä¸å¤šï¼Œæ­£å¥½ä¸€ä¸ªä¸€ä¸ªä¸æµªè´¹</p>
<p><img alt="image" src="http://ww2.sinaimg.cn/large/578b198bgw1eu84k60d10j208c0693z5.jpg" /></p>
<p>ç„¶åç”¨åå¸æŠŠé¦™è•‰å·èµ·æ¥</p>
<p><img alt="image" src="http://ww1.sinaimg.cn/large/578b198bgw1eu84klph10j208c0693z6.jpg" /></p>
<p>å†æŠŠæ‰‡å­å·èµ·æ¥ï¼Œç”¨åŠ›å‹ï¼Œè·Ÿç”¨å¯¿å¸å¸˜æ˜¯ä¸€æ ·çš„ï¼ŒåŠ ä¸Šä¿é²œè†œå‹å…¶å®å’Œç”¨å¯¿å¸å¸˜åšå¯¿å¸åå·çš„æ–¹å¼å·®ä¸å¤š</p>
<p><img alt="image" src="http://ww2.sinaimg.cn/large/578b198bgw1eu84m5rf93j208c069mxs.jpg" /></p>
<p>å‹å®ä¹‹åæ”¾åœ¨é“ç®”ç›’å­é‡Œï¼Œæµ‡ä¸Šè›‹æ¶²ï¼Œç¿»æ»šï¼Œç­‰è›‹æ¶²æ¸—é€</p>
<p><img alt="image" src="http://ww4.sinaimg.cn/large/578b198bgw1eu84n7zw7sj208c069754.jpg" /></p>
<p>å…¶å®è¿™é‡Œæœ‰ä¸ªæ­¥éª¤æˆ‘æ¼æ‰äº†ï¼Œé“ç®”ç›’å­åº•éƒ¨è¦åˆ·ç‚¹æ²¹.....ä¸ç„¶ä¼šç²˜ä½</p>
<p>è¿™ä¸ªæ—¶å€™å·®ä¸å¤šå¯ä»¥è¿›ç‚¸é”…ï¼ˆçƒ¤ç®±ï¼‰äº†ï¼Œé¢„çƒ­æ—¶é—´æœ‰æ²¡æœ‰äº”åˆ†é’Ÿæ— æ‰€è°“ï¼Œä¸Šé¢çš„å·¥ä½œåšå®Œäº†å°±å¯ä»¥å¼€ç®±æ”¾è¿›å»äº†ã€‚</p>
<p><img alt="image" src="http://ww4.sinaimg.cn/large/578b198bgw1eu84pnizxbj208c069q3j.jpg" /></p>
<p>æ”¾è¿›å»åç»§ç»­åŠ äº”åˆ†é’Ÿæ—¶é—´ï¼Œç„¶åå°±å¯ä»¥å»æ´—è„¸åˆ·ç‰™äº†ï¼Œæ€»å…±åªèŠ±äº†äº”åˆ†é’Ÿè€Œå·²ã€‚</p>
<p>æœ€åç­‰å¾…å®çš„ä¸€å£°å°±å¯ä»¥å‡ºç‚‰äº†</p>
<p><img alt="image" src="http://ww3.sinaimg.cn/large/578b198bgw1eu84rks81zj208c0b4dh2.jpg" /></p>
<p>æˆå“å°±æ˜¯è¿™æ ·å­ï¼Œé‡‘é»„æ²¹äº®çš„å¤–çš®ï¼Œä½†æ˜¯å…¶å®æ•´ä¸ªè¿‡ç¨‹å®Œå…¨æ²¡æœ‰æ”¾æ²¹ã€‚</p>
<p><img alt="image" src="http://ww1.sinaimg.cn/large/578b198bgw1eu84sj1793j208c0b4jsk.jpg" /></p>
<p>æ— è§†æ‰ä¹±å…¥çš„æ‰‡å­å§</p>
<p>é…ä¸Šminipressoçš„ä¸€æ¯é¦™æµ“å’–å•¡ï¼Œä¸€é¡¿æ—©é¤å†æ— é—æ†¾</p>
<p>æœ€èµçš„ä¸€ç‚¹æ˜¯ï¼Œåšå®Œåå¾ˆå¥½æ”¶æ‹¾ï¼Œåªéœ€è¦æŠŠè°ƒè›‹çš„é‚£ä¸ªç¢—æ´—å¹²å‡€å°±å¥½äº†ã€‚</p>
<p>è¿ç€å†™äº†ä¸‰å¤©çš„åƒåƒå–å–åƒä¸‡ä¸è¦ä»¥ä¸ºæˆ‘è½¬å‹å»åšç¾é£ŸèŠ‚ç›®äº†ï¼Œä¸‹æœŸæˆ‘ç»§ç»­å›å½’æŠ€æœ¯è¯é¢˜ï¼Œæˆ‘ä»¬æ¥ç»§ç»­è®¨è®ºGPSçš„é—®é¢˜ã€‚</p>
        </div>
        
        <div class="meta">
            Posted on <a href="/2015-07-19/bananatoast.html">2015-07-19 00:00:00</a>
        </div>
    </div>

    <div class="post">
        <h3><a href="/2015-07-14/programmer-and-coffee.html">ç®€å•åšä¸€æ¯å¥½å’–å•¡ä¹‹Minipresso</a></h3>
      
        <div class="body">
            <p>é¦™æµ“çš„Espressoæ˜¯æ„å¤§åˆ©å’–å•¡çš„çµé­‚ï¼Œæ˜¯å’–å•¡ç²¾åæœ€é›†ä¸­çš„ä½“ç°ã€‚æ„æµ“å’–å•¡å£å‘³é†‡åšï¼Œæœ‰å®›è‹¥ç„¦ç³–çš„å¥‡æ„Ÿå¦™æ„ã€‚è¦è‡ªå·±åšEspressoå…¶å®å¾ˆç®€å•ï¼Œå°¤å…¶æ˜¯å½“ä½ æœ‰äº†åˆ©å™¨Minipressoä¹‹åã€‚</p>
<p>æ­¤æ¬¾ç¥å™¨ä»·æ ¼å°è´µï¼Œä¸åˆ°400å³å¯å…¥æ‰‹ï¼Œæœ‰äººè¯´è¿™ä¸ªä»·æ·»ç‚¹å°±èƒ½ä¹°å°15Paçš„æœºå™¨äº†ï¼Œä½†æ˜¯å¤ªç¬¨é‡äº†ï¼Œæ­¤ç‰©å°å·§è½»ä¾¿ï¼Œè€Œä¸”ç»¿è‰²ç¯ä¿æ— é¡»é¢å¤–çš„èƒ½æºå³å¯å·¥ä½œã€‚æˆ‘ä»¬å…ˆæ¥çœ‹å¼€ç®±ï¼š</p>
<p><img alt="image" src="http://ww3.sinaimg.cn/large/578b198bgw1eu2jxkr5gjj208c0b4752.jpg" /></p>
<p>è·Ÿä¸€ä¸ªå°ä¿æ¸©æ¯å·®ä¸å¤šå¤§çš„ä½“ç§¯</p>
<p><img alt="image" src="http://ww3.sinaimg.cn/large/578b198bgw1eu2jyqdvngj208c0b40ts.jpg" /></p>
<p>æ‹†å¼€æ˜¯è¿™å¹…æ ·å„¿ï¼š</p>
<p><img alt="image" src="http://ww2.sinaimg.cn/large/578b198bgw1eu2jz6aydwj208c0b4aau.jpg" /></p>
<p>æ‹¿åœ¨æ‰‹é‡Œè¿™èˆ¬å¤§å°</p>
<p><img alt="image" src="http://ww1.sinaimg.cn/large/578b198bgw1eu2jzw2qpjj208c0b4my1.jpg" /></p>
<p>æ‹†å¼€å°±æ˜¯ä¸‹é¢å‡ ä¸ªéƒ¨ä»¶ï¼Œåˆ†åˆ«å¥—èµ·æ¥å°±æ˜¯æ•´ä¸ªä¸œè¥¿äº†ï¼š</p>
<p><img alt="image" src="http://ww1.sinaimg.cn/large/578b198bgw1eu2k2bf4pdj208c0b4q49.jpg" /></p>
<p>åœ¨å®¶é‡Œçš„æ—¶å€™å…¶å®æ¯å­æ¯”è¾ƒå¤šä½™ï¼Œé‡åˆšå¥½ä¸€ä¸ªshotã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥åšä¸€æ¯çœ‹çœ‹å¥½ç”¨ä¸ï¼Œé¦–å…ˆï¼Œç”¨é‡å‹ºæ…¢ä¸Šä¸€å‹ºå’–å•¡ç²‰</p>
<p><img alt="image" src="http://ww1.sinaimg.cn/large/578b198bgw1eu2k4jbal7j208c0b4t9q.jpg" /></p>
<p>è¿™æ¬¡è¿˜æ˜¯ä¸Šæ¬¡é‚£åŒ…å“¥ä¼¦æ¯”äºšï¼Œå› ä¸ºæ˜¯ä¸ºæ‰‹å†²æ‰“çš„é¢—ç²’æœ‰ç‚¹ç²—ï¼Œä¸‹æ¬¡æ¢è¿‡ä¸“é—¨çš„Espressoçš„ç²‰ã€‚</p>
<p>æŠŠç²‰ç›’å€’ç½®åœ¨é‡å‹ºä¸Šï¼š</p>
<p><img alt="image" src="http://ww4.sinaimg.cn/large/578b198bgw1eu2k6ag6wwj208c0b4jsb.jpg" /></p>
<p>ç„¶åç¿»è½¬è¿‡æ¥ï¼Œè¿™æ ·å­ç²‰å°±éƒ½åˆ°ç²‰ç›’é‡Œå•¦</p>
<p><img alt="image" src="http://ww2.sinaimg.cn/large/578b198bgw1eu2k76hyshj208c0b40tl.jpg" /></p>
<p>ç°åœ¨æŠŠç²‰ç›’æ”¾å…¥ä¸»ä½“ä¸­ï¼š</p>
<p><img alt="image" src="http://ww3.sinaimg.cn/large/578b198bgw1eu2k7q1zxuj208c0b4jsd.jpg" /></p>
<p>è¿™ä¸ªæ—¶å€™æŠŠæ»¤å¤´ç›–ä¸Šï¼Œæ‹§ç´§ï¼š</p>
<p><img alt="image" src="http://ww2.sinaimg.cn/large/578b198bgw1eu2k8yt9znj208c0b43zg.jpg" /></p>
<p>å°±æ˜¯å³æ‰‹é‚£ä¸ªï¼Œå¦‚æœæ‹§ç´§äº†å°±æ˜¯è¿™æ ·å­ï¼š</p>
<p><img alt="image" src="http://ww2.sinaimg.cn/large/578b198bgw1eu2k9hjmu7j208c0b4dgt.jpg" /></p>
<p>ç„¶åç»™æ°´æ§½åŠ å…¥å¼€æ°´</p>
<p><img alt="image" src="http://ww4.sinaimg.cn/large/578b198bgw1eu2kbru83wj208c0b4dgp.jpg" /></p>
<p>å·®ä¸å¤šè¿™ä¹ˆå¤šå°±å¤Ÿäº†</p>
<p><img alt="image" src="http://ww3.sinaimg.cn/large/578b198bgw1eu2kcd7l10j208c0b4q3o.jpg" /></p>
<p>æŠŠåˆšæ‰ç»„è£…å¥½çš„ä¸»ä½“éƒ¨åˆ†æ‹§ä¸Šå»ï¼Œæœ€ååˆä½“å®Œæˆï¼š</p>
<p><img alt="image" src="http://ww2.sinaimg.cn/large/578b198bgw1eu2kdi5lr3j208c0b4wfi.jpg" /></p>
<p>æŠŠåœ†å½¢çš„ä¸œè¥¿æ‰­ä¸€ä¸‹å¼¹å‡ºæ¥ï¼Œè¿™ä¸ªå°±æ˜¯æ°”æ³µ</p>
<p><img alt="image" src="http://ww4.sinaimg.cn/large/578b198bgw1eu2ke7q3z1j208c0b4q3x.jpg" /></p>
<p>è¿™æ¬¡æˆ‘ç”¨äº†ä¸Šæ¬¡é…çš„ç»ç’ƒæ¯æ²¡ç”¨æœ¬èº«é…çš„ï¼Œå› ä¸ºç»ç’ƒæ¯æ›´å®¹æ˜“çœ‹æ¸…æ¥šç»“æœã€‚ç°åœ¨ç”¨åŠ›æŒ‰æ°”æ³µï¼Œå·®ä¸å¤šä¸€ç§’ä¸€æ¬¡çš„é¢‘ç‡ï¼Œå¤ªå¿«äº†ä¹Ÿä¸å¥½ã€‚</p>
<p>å·®ä¸å¤šæŒ‰5æ¬¡åå°±å¼€å§‹å‡ºæ°´äº†ï¼Œä¸€å¼€å§‹è¦æ’æ‰ä¸€äº›æ°”ä½“ã€‚</p>
<p>æœ€åçš„ç»“æœï¼š
<img alt="image" src="http://ww3.sinaimg.cn/large/578b198bgw1eu2kglj8t3j208c0b4t9n.jpg" /></p>
<p>åšåšçš„ä¸€å±‚æ¼‚äº®çš„é‡‘é»„è‰²creamï¼Œé—»èµ·æ¥ä¹Ÿå¾ˆé¦™</p>
<p>æ¢ä¸ªè§’åº¦çœ‹çœ‹</p>
<p><img alt="image" src="http://ww1.sinaimg.cn/large/578b198bgw1eu2khp4ztuj208c0b475b.jpg" /></p>
<p>è¿™ä¸ªæ—¶å€™å„ç§èŠ±å¼éƒ½å¯ä»¥ä»»ä½ ç©å’¯ã€‚</p>
        </div>
        
        <div class="meta">
            Posted on <a href="/2015-07-14/programmer-and-coffee.html">2015-07-14 00:00:00</a>
        </div>
    </div>

    <div class="post">
        <h3><a href="/2015-07-09/airpressor.html">ç¨‹åºå‘˜ä¸å’–å•¡ï¼šè¿œç¦»é€Ÿæº¶ç”¨çˆ±ä¹å‹åšæ¯å¥½å’–å•¡</a></h3>
      
        <div class="body">
            <p>å¦‚æœæ²¡æœ‰å’–å•¡ï¼Œä¸–ç•Œä¸Šä¸ä¼šæœ‰è¿™ä¹ˆå¤šç²¾å¦™çš„ä»£ç ï¼Œæˆ‘ä»¬çš„ç”Ÿæ´»ä¸ä¼šå¦‚æ­¤ç»šä¸½å¤šå½©ã€‚ä½†æ˜¯å¤§å¤šæ•°å±Œä¸å…¬å¸éƒ½åªèƒ½é…å¤‡é€Ÿæº¶å’–å•¡ï¼Œå°±ç®—æ˜¯æ»´æ»´é¦™æµ“çš„éº¦æ–¯éŸ¦å°”ï¼Œåªè¦æ˜¯äºŒåˆä¸€çš„ä¹Ÿéƒ½æ˜¯å……æ–¥è¿™æ°¢åŒ–æ¤ç‰©æ²¹ï¼ˆå’–å•¡ä¼´ä¾£ï¼‰ï¼Œå¤§é‡çš„åå¼è„‚è‚ªé…¸ä¼šæ‘§æ¯ç¨‹åºå‘˜å¹¶ä¸æ€ä¹ˆå¥åº·çš„èº«ä½“ã€‚ä¸€æ¯é¦™æµ“çš„ç°ç£¨å’–å•¡æ˜¾ç„¶æ‰æ˜¯ç¨‹åºå‘˜çš„æœ€ä½³ä¼´ä¾£ï¼Œä½†æ˜¯ç…®å’–å•¡æ˜¯ä¸€ä»¶éº»çƒ¦çš„äº‹æƒ…ï¼Œæ‰‹å†²ï¼ˆæŒ‚è€³æ»´æ»¤ï¼‰çš„å¤ªè‹¦ï¼Œæ³•å‹çš„åˆéœ€è¦ä¸“é—¨ç£¨ç²—é¢—ç²’ï¼Œè™¹å¸ï¼Œæ‘©å¡å£¶éƒ½æ˜¯éœ€è¦ä¸€å¤§å †å®¶ä¼™å¼çš„ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™çˆ±ä¹å‹æ¨ªç©ºå‡ºä¸–ï¼Œä»æ­¤æˆ‘ä»¬å¯ä»¥å¿«é€Ÿåˆ¶ä½œä¸€æ¯ä¸é”™çš„æ‰‹å†²ï¼ˆå‹ï¼‰å’–å•¡äº†ã€‚
<img alt="image" src="http://ww1.sinaimg.cn/large/578b198bgw1etwpmdtzzpj20b40b50tm.jpg" /></p>
<p>è¿™è´§ç°åœ¨äº¬ä¸œæ·˜å®å‡æœ‰é”€å”®ï¼Œä¸æ”¾å¿ƒæ·˜å®çš„å°±å»ç¾äºšä¹°ï¼Œä»·æ ¼åœ¨300ä»¥å†…ã€‚</p>
<p>ä¸‹é¢ç”¨æˆ‘çš„çˆ±ä¹å‹ç»™å¤§å®¶æ¼”ç¤ºä¸€ä¸‹åšä¸€æ¯å¥½å’–å•¡å…¶å®æ˜¯å¾ˆç®€å•çš„ã€‚
é¦–å…ˆæŠŠä¸»ä½“ç»„è£…å‡ºæ¥ï¼Œå’Œä¸€æ ¹å¤§é’ˆç®¡å·®ä¸å¤šï¼ˆæ—è¾¹æ˜¯é…çš„æ¯å­ï¼‰</p>
<p><img alt="image" src="http://ww3.sinaimg.cn/large/578b198bgw1etwkt9qnrhj20b40d10tr.jpg" /></p>
<p>ç„¶åå‡†å¤‡å¥½å’–å•¡ï¼Œæˆ‘ç”¨çš„åœ¨æ˜Ÿå·´å…‹ä¹°çš„ä¸­åº¦çƒ˜ç„™çš„å“¥ä¼¦æ¯”äºšï¼Œåœ¨å‡‰äº†ä»¥åä¸ä¼šäº§ç”Ÿè¿‡é‡çš„é…¸å‘³ï¼Œåœ¨è¿™ä¸ªå¤§çƒ­å¤©åšå†°å’–å¾ˆå·´é€‚ã€‚</p>
<p><img alt="image" src="http://ww2.sinaimg.cn/large/578b198bgw1etwkvm4olbj20b40fy768.jpg" /></p>
<p>æ˜Ÿå·´å…‹æä¾›ç£¨è±†æœåŠ¡ï¼ŒæŒ‰ç…§å’–å•¡æœºç”¨çš„ç²—ç»†ç£¨å°±å¥½äº†ã€‚</p>
<p>æŠŠå’–å•¡ç²‰å€’è¿›å»ï¼Œé…äº†é‡å‹ºçš„ï¼Œä¸€ä»½ä¸€å‹ºï¼Œå¤§æ¦‚å’Œä¸‹å›¾å·®ä¸å¤šï¼š</p>
<p><img alt="image" src="http://ww4.sinaimg.cn/large/578b198bgw1etwkzy911ij20b40f0dh0.jpg" /></p>
<p>ç„¶åæ³¨å…¥çƒ­æ°´ï¼Œé¥®æ°´æœºçƒ§å¼€çš„å°±è¡Œäº†ï¼Œä¸ç”¨100åº¦ï¼Œæœ€ä½³æ¸©åº¦æ˜¯80å¤šåº¦ï¼Œä¸€ä»½æ³¨å…¥ä¸€æ ¼ï¼Œå¤§æ¦‚åˆ°ä¸‹å›¾çš„ä½ç½®ï¼Œç„¶åæ…æ‹Œä¸€ä¸‹ï¼š</p>
<p><img alt="image" src="http://ww2.sinaimg.cn/large/578b198bgw1etwl490qdjj20b40d63zj.jpg" /></p>
<p>é™é™çš„æ”¾ä¸€ä¼šå„¿ï¼Œè¶è¿™ä¸ªæ—¶é—´å»ç»„è£…å®ƒçš„å¤´éƒ¨ã€‚</p>
<p>å¤´éƒ¨æ˜¯ç”±ä¸€ä¸ªç´§å›ºä»¶ï¼Œä¸€ç‰‡æ»¤çº¸å’Œä¸€å¼ é‡‘å±æ»¤ç‰‡ç»„æˆçš„ï¼š</p>
<p><img alt="image" src="http://ww2.sinaimg.cn/large/578b198bgw1etwl7fos1xj20b40etq4i.jpg" /></p>
<p>æ»¤çº¸æ˜¯å¯ä»¥é‡å¤ä½¿ç”¨å¤šæ¬¡çš„ï¼Œå›¾ä¸Šçš„æ»¤çº¸å·²ç»ç”¨è¿‡ä¸€æ¬¡äº†ï¼ŒæŒ‰ç…§å‘æ˜äººçš„è¯´æ³•ï¼Œæœ‰äººåå¤ç”¨äº†20å¤šæ¬¡ï¼Œä½†æ˜¯ä¹°çš„æ—¶å€™é€äº†å¾ˆå¤§ä¸€æ‘ï¼Œæ‰€ä»¥æˆ‘ä¸€èˆ¬åå¤ç”¨2æ¬¡ã€‚</p>
<p>è£…å¥½äº†æ˜¯ä¸‹é¢è¿™æ ·å­çš„ï¼š</p>
<p><img alt="image" src="http://ww4.sinaimg.cn/large/578b198bgw1etwlacthilj20b40d2ab4.jpg" /></p>
<p>ç°åœ¨ç”±æˆ‘æ¥ç»„æˆå¤´éƒ¨......  é¢~ï¼Œ æ˜¯æŠŠè¿™ä¸ªå¥—åœ¨é‚£ä¸ªå¤§é’ˆç®¡ä¸Šï¼š</p>
<p><img alt="image" src="http://ww4.sinaimg.cn/large/578b198bgw1etwldpgqbbj20b40ea0tw.jpg" /></p>
<p>æ‘‡ä¸€æ‘‡ï¼Œç„¶åæ•´ä¸ªå€’è¿‡æ¥æ”¾åˆ°æœ€æ—©æ”¾è¾¹ä¸Šçš„é‚£ä¸ªæ¯å­ä¸Šã€‚ç„¶åï¼Œç”¨åŠ›å‹</p>
<p><img alt="image" src="http://ww1.sinaimg.cn/large/578b198bgw1etwlfhhi3oj20b40frmyi.jpg" /></p>
<p>ç„¶åä¸€ä»½é¦™æµ“çš„å’–å•¡å°±è¯ç”Ÿäº†ï¼š</p>
<p><img alt="image" src="http://ww3.sinaimg.cn/large/578b198bgw1etwlhwuw7jj20b40cdgmm.jpg" /></p>
<p>è¿™æ ·ä¸€ä»½æµ“åº¦æ¯”è¾ƒé«˜ï¼Œå¦‚æœä¹ æƒ¯ç¾å¼å’–å•¡å°±1:1åŠ æ°´ï¼Œä¸è¿‡æˆ‘ä¹ æƒ¯åŠ å¥¶</p>
<p><img alt="image" src="http://ww4.sinaimg.cn/large/578b198bgw1etwlls5utnj20b40bmaaz.jpg" /></p>
<p>è¿™æ ·ä¸€æ¯å’–å•¡ï¼Œæ”¾åœ¨å†°ç®±é‡Œå†»ä¸€ä¸‹ï¼Œçˆ½å‘†ï¼Œå¦‚æœä½ è¦å–çƒ­çš„ï¼Œè®°å¾—å…ˆç»™å¥¶åŠ çƒ­</p>
<p>æ¸…æ´—èµ·æ¥ä¹Ÿæ˜¯å¾ˆç®€å•çš„ï¼Œå…ˆæŠŠå¤´éƒ¨æ‹†ä¸‹æ¥ï¼š</p>
<p><img alt="image" src="http://ww2.sinaimg.cn/large/578b198bgw1etwlpdil4rj20b409pdgn.jpg" /></p>
<p>æ°´é¾™å¤´å†²ä¸€å†²å°±å¥½äº†ï¼Œæ˜¯çš„ï¼Œæ»¤çº¸ä¹Ÿå¯ä»¥å†²ä¸€å†²ï¼Œç”©å¹²æ”¾å¥½å°±è¡Œäº†ã€‚</p>
<p>æœ€åæŠŠé’ˆç®¡ä¸€æ¨ï¼Œå’–å•¡æ¸£å­å°±æ¸…ç†å‡ºæ¥äº†ï¼Œä¹‹åæ°´é¾™å¤´å†²å†²å°±å¥½äº†</p>
<p><img alt="image" src="http://ww1.sinaimg.cn/large/578b198bgw1etwohy6squj20b40evta6.jpg" /></p>
<p>å¯¹çƒŸæ°‘æ¥è¯´è¿™ä¸ªæ¸£å­æ˜¯å †çƒŸç°ç¼¸çš„å¥½ä¸œè¥¿ï¼Œæˆ‘æ˜¯ä¸æŠ½çƒŸçš„ï¼Œä¸è¿‡æ‹¿æ¥å¡«èŠ±ç›†ä¹Ÿæ˜¯ä¸é”™çš„ææ–™</p>
<p>æœ€åè¯´è¯´æˆæœ¬ï¼Œä¸€åŒ…å’–å•¡ç²‰å¤§æ¦‚50 åˆ°90å…ƒä¸ç­‰ï¼Œå¯ä»¥å–ä¸€å‘¨å·¦å³ï¼ŒåŠ ä¸Šé²œå¥¶çš„ä»·æ ¼ï¼Œæ ¸ç®—ä¸‹æ¥æ¯ä¸€æ¯æˆæœ¬åœ¨10å…ƒåˆ°15å…ƒä¸Šä¸‹ï¼Œå’Œæ˜Ÿå·´å…‹çš„ä»·æ ¼æ¯”è¾ƒèµ·æ¥è¿˜æ˜¯å¾ˆåˆ’ç®—çš„ï¼Œä¸»è¦æ˜¯å¥åº·ã€‚</p>
<p>ç¥ç”¨å¾—å¼€å¿ƒ</p>
        </div>
        
        <div class="meta">
            Posted on <a href="/2015-07-09/airpressor.html">2015-07-09 00:00:00</a>
        </div>
    </div>

    <div class="post">
        <h3><a href="/2015-05-13/GPS.html">ä¸ºä»€ä¹ˆGPSè®°å½•çš„æ•°æ®ä¸å‡†ç¡®</a></h3>
      
        <div class="body">
            <p>ç°åœ¨å¼ æœé˜³å’Œå†¯å”éƒ½è·‘æ­¥äº†ï¼Œç´§è·Ÿç€è·‘æ­¥çš„Appä¹Ÿçƒ­èµ·æ¥äº†ã€‚å¥½äº†ï¼Œæˆ‘ä»¬ä¹°äº†è·‘é‹ï¼Œä¸‹è½½äº†Appå¼€å§‹è·‘èµ·æ¥ï¼Œæˆ‘ä»¬è§‰å¾—ï¼Œ</p>
<h3>è·‘å®Œåè®°å½•çš„æ•°æ®åº”è¯¥æ˜¯è¿™æ ·å­çš„ï¼š</h3>
<p><img alt="image" src="http://ww1.sinaimg.cn/large/578b198bgw1es3m51r59vj207s0dtq3y.jpg" /></p>
<h3>ä½†æ˜¯ç°å®æƒ…å†µç¡®æ˜¯è¿™æ ·å­çš„ï¼š</h3>
<p><img alt="image" src="http://ww1.sinaimg.cn/large/578b198bgw1es3m605z4zj207s0dt0ty.jpg" /></p>
<p>æ˜æ˜éƒ½æ˜¯åœ¨åŒä¸€æ¡è·¯å¾„ä¸Šç»•åœˆï¼Œä¸ºä»€ä¹ˆGPSä¼šè¿™æ ·å­æ‰­æ¥æ‰­å»çš„å‘¢ã€‚</p>
<p>è¦å¼„æ˜ç™½å…¶ä¸­çš„åŸå› ï¼Œæˆ‘ä»¬è¦ä»GPSçš„åŸç†è¯´èµ·ã€‚</p>
<p>å¤§ä½“ä¸Šæ¥è¯´ï¼ŒGPSå®šä½çš„åŸç†å¯ä»¥ç”¨ä¸‹é¢çš„å›¾ç‰‡æ¥è¯´æ˜ï¼š</p>
<p><img alt="image" src="http://ww1.sinaimg.cn/large/578b198bgw1es3m70hzk6j207s05g3yr.jpg" /></p>
<p>å…·ä½“çš„åŸç†å¯ä»¥å‚è§ï¼š<a href="http://www.cnblogs.com/magicboy110/archive/2010/12/09/1901669.html">ä¼ é€é—¨</a> ä¸Šå›¾ä¹Ÿæ¥è‡ªè¿™ç¯‡Blogã€‚</p>
<p>ç®€å•æ¥è¯´å°±æ˜¯ï¼Œæ‰‹æœºæ¥æ”¶åˆ°4é¢—å«æ˜Ÿçš„ä½ç½®ä¿¡æ¯å’Œæ—¶é—´æˆ³ï¼ˆä»£è¡¨äº†ä½ çš„ä½ç½®åˆ°å«æ˜Ÿä½ç½®çš„è·ç¦»ï¼‰ï¼Œç„¶åæ ¹æ®ä¸‰ç‚¹å®šä½çš„åŸç†ï¼ŒblablablaææŒ‡ä¸€ç®—ï¼Œå°±çŸ¥é“ä½ çš„ä½ç½®ï¼ˆç»çº¬åº¦å’Œæµ·æ‹”ï¼‰äº†ã€‚</p>
<h3>é‚£ä¹ˆGPSä¸ºä»€ä¹ˆä¼šä¸å‡†å‘¢ï¼Ÿ</h3>
<p>ç»“åˆä¸Šé¢çš„åŸç†ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼ŒGPSæ˜¯é€šè¿‡è·çŸ¥å’Œ4é¢—èƒ½æ”¶åˆ°ä¿¡å·çš„å«æ˜Ÿä¹‹é—´çš„è·ç¦»æ¥è®¡ç®—ä½ç½®çš„ï¼Œé‚£ä¹ˆå¦‚æœç”µç£æ³¢åœ¨ç†æƒ³çš„çœŸç©ºä¸­ä¼ æ’­ï¼Œè¿™å½“ç„¶æ˜¯å¾ˆç²¾ç¡®çš„ã€‚ä½†æ˜¯åœ°çƒå¤ªå±é™©äº†ï¼Œæœ‰å¾ˆå¤šæƒ…å†µå¯èƒ½ä¼šå½±å“åˆ°è¿™å››ä¸ªè·ç¦»å‚æ•°ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<h4>1.åœ°çƒç”µç¦»å±‚æ³¢åŠ¨</h4>
<p>åœ°çƒçš„ç”µç¦»å±‚ä¼šåå°„ã€æŠ˜å°„ç”µç£æ³¢ï¼Œç„¶åç”µç¦»å±‚åˆä¸æ˜¯ä¸€ä¸ªåšåº¦å’Œå½¢çŠ¶æ’å®šçš„ä¸€ä¸ªå£³ä½“ï¼Œæ‰€ä»¥å½“åœ°çƒæ°”å€™æŠ½é£çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ”¶åˆ°çš„å«æ˜Ÿå¹¿æ’­çš„ä¿¡å·å°±ä¸æ˜¯ç›´æ¥è¿‡æ¥çš„ï¼Œä»è€Œæ¥æ”¶åˆ°çš„è·ç¦»å°±ä¼šæœ‰åå·®ï¼Œè¿™æ ·è®¡ç®—å‡ºæ¥çš„ä½ç½®å°±ä¼šåç¦»æˆ‘ä»¬å®é™…æ‰€åœ¨çš„ä½ç½®ã€‚</p>
<h4>2.é«˜å±‚å»ºç­‘é®æŒ¡ã€åå°„ä¿¡å·</h4>
<p>è¿™ä¸ªæƒ…å†µçš„åŸç†å¦‚ä¸‹å›¾ï¼š</p>
<p><img alt="image" src="http://ww3.sinaimg.cn/large/578b198bgw1es3m81ahghj207s06v3yl.jpg" /></p>
<p>å¦‚å›¾å¯çŸ¥ï¼Œå³è¾¹çš„é«˜æ¥¼æŒ¡ä½äº†å«æ˜Ÿçš„ä¿¡å·ï¼Œè€Œå·¦è¾¹çš„é«˜æ¥¼å°†ä¿¡å·æŠ˜å°„äº†ï¼Œæ‰€ä»¥ä½ å¾—åˆ°çš„å«æ˜Ÿçš„è·ç¦»å°±è¿œäº†é‚£ä¹ˆä¸€ç‚¹ç‚¹ï¼Œæ‰€ä»¥å‘¢ï¼Œä½ è®¡ç®—å‡ºæ¥çš„ä½ç½®å°±ä¸åœ¨ä½ å®é™…çš„ä½ç½®ä¸Šäº†ï¼Œè€Œæ˜¯åœ¨å·¦è¾¹çš„é«˜æ¥¼çš„å·¦è¾¹å»äº†ã€‚</p>
<p>åœ¨åŸå¸‚é‡Œè¾¹ï¼Œè¿™æ˜¯æœ€å¸¸è§çš„GPSæ¼‚ç§»çš„åŸå› ï¼Œæ‰€ä»¥å»ºè®®å¤§å®¶å¦‚æœç”¨GPSè®°å½•è·‘æ­¥çš„è¯ï¼Œè¿˜æ˜¯å»ç©ºæ—·å¼€é˜”çš„åœ°æ–¹ä¼šæ¯”è¾ƒå‡†ã€‚</p>
<h4>3.ç´¯è®¡è¯¯å·®é€ æˆé‡Œç¨‹å˜å¤§ï¼Œé€Ÿåº¦å˜å¿«</h4>
<p>å½¢è±¡çš„æ¥è¯´å¯ä»¥ç”¨ä¸‹å›¾æ¥è¡¨ç¤ºï¼š</p>
<p><img alt="image" src="http://ww4.sinaimg.cn/large/578b198bgw1es3m9clyiuj207s05c74g.jpg" /></p>
<h3>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ€ä¹ˆæ ·æ‰å¯ä»¥è®©GPSè®°å½•æ›´åŠ çš„å‡†ç¡®å‘¢ï¼Ÿ</h3>
<h2>è¯·å¬ä¸‹å›åˆ†è§£</h2>
        </div>
        
        <div class="meta">
            Posted on <a href="/2015-05-13/GPS.html">2015-05-13 00:00:00</a>
        </div>
    </div>

    <div class="post">
        <h3><a href="/2015-04-07/bsbdqj-supervisor-subprocess.html">ç™¾æ’•ä¸å¾—éª‘å§ç³»åˆ—ä¹‹ä¸¢å¤±çš„signal</a></h3>
      
        <div class="body">
            <p>è¿‡èŠ‚çš„æ—¶å€™å†™äº†ä¸ªå°ä¸œè¥¿ï¼Œä¸»è¿›ç¨‹ç”¨multiprocesså¼€äº†å‡ ä¸ªå­è¿›ç¨‹æ¥åˆ†å‘ä»»åŠ¡ç»™å­è¿›ç¨‹æ‰§è¡Œï¼Œå®Œæˆåå­è¿›ç¨‹reportç»“æœç»™ä¸»è¿›ç¨‹ã€‚ä¸ºäº†åœ¨ä¸»è¿›ç¨‹æ­»æ‰åæŠŠå­è¿›ç¨‹ä¹Ÿå¹²æ‰ï¼Œæˆ‘ç›‘å¬äº†TERMçš„ä¿¡å·ï¼Œç„¶ååœ¨æ”¶åˆ°è¿™ä¸ªä¿¡å·åå»killæ‰æ‰€æœ‰å­è¿›ç¨‹ã€‚çœ‹èµ·æ¥okå•¦ï¼Œè·‘èµ·æ¥ä¹Ÿè¿˜å¥½ï¼Œå‡è®¾è¿™ä¸ªåŠŸèƒ½æ˜¯æ”¾åœ¨ serv.py é‡Œï¼Œpython serv.py &amp; æŠŠå®ƒæ”¾åˆ°åå°å»ï¼Œå†kill æ‰ï¼Œä¸€åˆ‡éƒ½å¾ˆokï¼Œä½†æ˜¯å¦‚æœç”¨supervisordæŠŠè¿™ä¸ªç®¡ç†èµ·æ¥çš„è¯å°±å‡ºäº†é—®é¢˜ï¼Œä¸»è¿›ç¨‹åŸºæœ¬ä¸Šå°±æ²¡æ”¶åˆ°TERMçš„ä¿¡å·.</p>
<pre><code>def receive_signal(signum, stack):
    import sys
    for process in worker_process:
        process.terminate()
    logging.info('child killed')
    sys.exit(0)

signal.signal(signal.SIGTERM, receive_signal)
</code></pre>
<p>supervisordçš„é…ç½®</p>
<pre><code>[program:XXX]
command=/usr/bin/python serv.py
directory=/var/code/
umask=022
startsecs=0
stopwaitsecs=0
redirect_stderr=true
stdout_logfile=/var/log/XXX.log
autorestart=true
</code></pre>
<p>è·‘èµ·æ¥çš„æ—¶å€™ tail -f /var/log/XXX.log,åœ¨ä½  supervisorctl stop XXX ä¹‹åï¼Œæ˜¯çœ‹ä¸åˆ°child killedæ‰“å°å‡ºæ¥çš„ã€‚</p>
<p>éé˜…å„ç§èµ„æ–™å‘ç°supervisoræ˜¯é€šè¿‡å‘å­è¿›ç¨‹å‘TERMä¿¡å·æ¥æ€è¿›ç¨‹çš„ã€‚ä½†æ˜¯è¿™ä¹ˆè²Œä¼¼æ²¡æœ‰å‘è¿‡è¿™ä¸ªä¿¡å·å‘¢ï¼Ÿç„¶åæˆ‘çœ‹åˆ° stopwaitsecs=0 è¿™ä¸ªå‚æ•°ï¼Œå½“åˆè®¾ç½®æˆ0æ˜¯ä¸ºäº†æ›´å¿«çš„é‡å¯è¿›ç¨‹ã€‚ä»”ç»†æƒ³æƒ³æ˜¯ä¸æ˜¯å› ä¸ºè¿™ä¸ªåœ°æ–¹æ€å¤ªå¿«äº†è¿˜æ²¡å‘ä¿¡å·å°±æŠŠè¿›ç¨‹å¹²æ‰äº†å‘¢ï¼Ÿç«‹å³æŠŠå‚æ•°æ”¹æˆäº†  stopwaitsecs=1ï¼Œç„¶åï¼Œå°±è§£å†³äº†ã€‚</p>
<p>è¿™ä¸ªé—®é¢˜å·®ä¸å¤šèŠ±äº†ä¸€éƒ¨ç”µå½±çš„æ—¶é—´æ¥è§£å†³ï¼Œåˆšå¼€å§‹çš„æ—¶å€™çœŸæ˜¯ç™¾æ’•ä¸å¾—éª‘å§å•Šã€‚å›è¿‡å¤´æ¥çœ‹çœ‹ï¼Œsupervisoråº”è¯¥æ˜¯ç”¨ç±»ä¼¼kill -9çš„æ–¹å¼æ¥ç¡®ä¿è¿›ç¨‹æœ€ç»ˆè¢«å¹²æ‰ï¼Œä½†æ˜¯å¦‚æœstopwaitsecs=0çš„æ—¶å€™å°±å¹²è„†ç»•å¼€äº†å‘TERMçš„ä¿¡å·ç›´æ¥å°±kill -9äº†ï¼Œè¿˜æ˜¯ç™¾æ’•ä¸å¾—éª‘å§ï¼Œæœ‰æœºä¼šçœ‹çœ‹supervisordçš„ä»£ç æ¥çœ‹çœ‹æ˜¯ä¸æ˜¯å’Œæˆ‘çŒœæµ‹çš„ä¸€æ ·äº†ã€‚</p>
        </div>
        
        <div class="meta">
            Posted on <a href="/2015-04-07/bsbdqj-supervisor-subprocess.html">2015-04-07 00:00:00</a>
        </div>
    </div>

    <div class="post">
        <h3><a href="/2015-04-02/simple-rough-print-with-pi.html">ä¸è¦é©±åŠ¨ï¼Œç®€å•ç²—æš´çš„ç”¨æ ‘è“æ´¾é©±åŠ¨USBæ‰“å°æœº</a></h3>
      
        <div class="body">
            <p>ç½‘ä¸Šå¾ˆå¤šæ–‡ç« éƒ½æ˜¯å†è¯´å¦‚ä½•ç”¨æ ‘è“æ´¾æ¥åšä¸€ä¸ªé€šç”¨æ‰“å°æœåŠ¡å™¨ï¼Œä½†æ˜¯åœ¨å¾ˆå¤šåº”ç”¨åœºæ™¯ä¸‹ï¼Œé…ç½®CUPSä»€ä¹ˆçš„çœŸçš„æ˜¯è‡ªå·±zuoè‡ªå·±dieçš„å¥½é€”å¾„ï¼Œå„ç±»linuxä¸‹çš„é©±åŠ¨é…ç½®èµ·æ¥ä»¤äººåè¡€ã€‚è€Œé©±åŠ¨å„ç§çƒ­æ•ç¥¨æ®æ‰“å°æœºï¼Œæ¯”å¦‚æ‰“èƒ¶å¸¦å•Šï¼ŒäºŒç»´ç è´´çº¸å•Šï¼Œå°ç¥¨ä¹‹ç±»çš„æ‰“å°æœºå› ä¸ºæ ¹æœ¬æ‰¾ä¸åˆ°linuxçš„é©±åŠ¨ï¼Œè¦æèµ·æ¥æ›´æ˜¯Mission Imposiableã€‚æ‰€ä»¥æœ¬æ–‡çš„ç›®çš„å°±æ˜¯ä¸ºäº†ä¸ç”¨é©±åŠ¨ç›´æ¥ç”¨USBæ¥å£çš„å„ç±»çƒ­æ•æ‰“å°æœºã€‚å› ä¸ºæ²¡æœ‰é©±åŠ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½ç”¨ç®€å•ç²—æš´çš„æ–¹å¼é€šè¿‡USBç›´æ¥æ“ä½œæ‰“å°æœºäº†ã€‚ä¸‹é¢æ¥çœ‹çœ‹æ€ä¹ˆæï¼š</p>
<p>é¦–å…ˆï¼Œä½ å¾—æœ‰ä¸€å°æ‰“å°æœºï¼Œæ·˜å®æœ‰å–çš„ï¼Œå‡ åå…ƒåˆ°ä¸€ä¸¤ç™¾ï¼Œå¯ä»¥æ‰“çƒ­æ•èƒ¶å¸¦ï¼Œæ‰€ä»¥åšä¸ªæ‰“å°æœåŠ¡å™¨æ ‡ç­¾çš„ä¸œè¥¿ä¹Ÿä¸é”™çš„ï¼Œå…¶ä»–ç”¨é€”å¯ä»¥è‡ªè¡Œå¼€å‘ã€‚</p>
<p>å…ˆæŠŠæ‰“å°æœºç”¨usbçº¿æ¥åˆ°æ ‘è“æ´¾ä¸Šï¼Œç„¶ååœ¨æ ‘è“æ´¾æ‰§è¡Œ lsusb å‘½ä»¤ï¼Œè¿™ä¸ªæ—¶å€™ä¼šåˆ—è¡¨è¿æ¥ä¸Šçš„æ‰€æœ‰usbè®¾å¤‡ï¼Œå¦‚ä¸‹:</p>
<pre><code>Bus 005 Device 001: ID 0000:0000 
Bus 001 Device 001: ID 0000:0000 
Bus 004 Device 001: ID 0000:0000 
Bus 003 Device 001: ID 0000:0000 
Bus 002 Device 006: ID 15d9:0a37 
Bus 002 Device 001: ID 0000:0000
</code></pre>
<p>è¿™ä¸ªæ—¶å€™ä¸çŸ¥é“è°æ˜¯æ‰“å°æœºå‘¢ï¼ä¸è¿‡ä¸è¦ç´§ï¼Œä½ æ‹”æ‰æ‰“å°æœºçš„usbçº¿åå†æ‰§è¡Œä¸€æ¬¡ï¼Œçœ‹ç¼ºè°ï¼Œè°å°±æ˜¯æ‰“å°æœºäº†ã€‚</p>
<p>IDåå†’å·éš”å¼€çš„ä¸¤ä¸ªæ•°å­—å°±æ˜¯usbè®¾å¤‡çš„ vendor IDå’Œproduct Idäº†ï¼Œè®°ä¸‹æ¥å…ˆï¼Œä¸€ä¼šå„¿è¿æ¥çš„æ—¶å€™æœ‰å¤§ç”¨ã€‚</p>
<p>ä¸ºäº†è¿æ¥æ‰“å°æœºï¼Œä½ éœ€è¦å®‰è£…python-usbè¿™ä¸ªåº“ï¼Œç”¨äºç›´æ¥é€šè¿‡usbæ¥å£æ¥æ“ä½œusbè®¾å¤‡ã€‚æœ¬æ–‡çš„ç¬¬ä¸€ä¸ªå‘å°±å‡ºåœ¨è¿™é‡Œï¼Œå› ä¸ºpipåº“é‡Œçš„ç‰ˆæœ¬æœ‰ä¸€ä¸ªbugçš„æ–¹å¼åœ¨åé¢çš„åº“ä¼šç”¨åˆ°ï¼Œæ‰€ä»¥å¿…é¡»ç”¨ä»githubé‡Œæœ€æ–°çš„å»é™¤äº†bugçš„ä»£ç é‡Œå®‰è£…æ‰ä¸ä¼šå‡ºé—®é¢˜ã€‚æ‰€ä»¥åªèƒ½</p>
<pre><code>git clone https://github.com/walac/pyusb.git
cd pyusb
python setup.py install
</code></pre>
<p>ç”¨è¿™æ ·å­çš„æ–¹å¼æ¥å®‰è£…æ‰è¡Œã€‚</p>
<p>å®‰è£…å¥½åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡usbæ¥å£æ¥æ“ä½œæ‰“å°æœºäº†ï¼Œç”±äºå¤§å¤šæ•°æ‰“å°æœºéƒ½æ”¯æŒEPSONçš„æ‰“å°åè®®ï¼ˆå¾ˆå¤è€çš„åè®®äº†ï¼Œæ‰€ä»¥åˆ°å¤„éƒ½æ”¯æŒï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å®‰è£…ä¸€ä¸ªå«python-escpos çš„åº“æ¥é€šè¿‡python-usbæ¥ç”¨EPSONçš„åè®®æ“ä½œæ‰“å°æœºã€‚</p>
<pre><code>sudo pip install python-escpos
</code></pre>
<p>ä½†æ˜¯æ­¤å¤„è¿˜æ˜¯æœ‰å‘ï¼Œå› ä¸ºè¿™è´§çš„æ–‡æ¡£åŸºæœ¬ä¸Šå’Œå®é™…æƒ…å†µå°±æ˜¯ç‰›å¤´ä¸å¯¹é©¬å˜´ã€‚æ‰€ä»¥å°±åˆ«ç®¡è¿™è´§çš„æ–‡æ¡£äº†ã€‚</p>
<pre><code>from escpos import *
pt = printer.Usb(0x0fe6, 0x811e, 0, out_ep=0x03)
</code></pre>
<p>æ­¤å¤„è¦æ³¨æ„  out_ep ä¸èƒ½ç”¨é»˜è®¤å€¼ï¼Œé»˜è®¤çš„é“å®šæ‰“ä¸äº†ï¼Œä½†æ˜¯è¿™é‡Œçš„å°è£…åˆæœ‰é—®é¢˜ä¸èƒ½å»è‡ªåŠ¨è·å–ï¼Œæ‰€ä»¥ä¸‹é¢ç»™ä¸€æ®µè‡ªåŠ¨è·å– out_ep çš„ä»£ç </p>
<pre><code>import usb.core
import usb.util
import sys

dev =  usb.core.find(idVendor= 0x5345, idProduct= 0x1234)

cfg = dev.get_active_configuration()
intf = cfg[(0,0)]
ep = usb.util.find_descriptor(
    intf,
    # match the first OUT endpoint
    custom_match = \
    lambda e: \
    usb.util.endpoint_direction(e.bEndpointAddress) == \
    usb.util.ENDPOINT_OUT
)
dev.reset()
</code></pre>
<p>æˆ‘æ‰‹å¤´çš„æ‰“å°æœºè·å–åˆ°çš„out_epæ˜¯0x03,æ‰€ä»¥æˆ‘å°±å†™çš„è¿™ä¸ªå€¼ã€‚
ä¹‹åå‘¢å°±å¯ä»¥æ„‰å¿«çš„æ‰“å°äº†ï¼š</p>
<pre><code>from escpos import *
usb = printer.Usb(0x0fe6, 0x811e, 0, out_ep=0x03)

usb.text(u"ç»ˆäºå¯ä»¥æ„‰å¿«çš„æ‰“å°å•¦\n\n\n\n\n\n\n\n".encode('gbk'))

usb.image(â€˜image pathâ€™)  #æ‰“å°å›¾ç‰‡ï¼ˆé»‘ç™½2å€¼ï¼‰

usb.qr(â€˜å€¼â€™)   #æ‰“å°äºŒç»´ç 

usb.set(codepage=None, align=â€˜centerâ€™)  #è®¾ç½®é¡µé¢å±…ä¸­

usb.cut()  #åˆ‡çº¸

usb.close()  #å…³é—­è¿æ¥
</code></pre>
<p>ç¥ç©å¾—æ„‰å¿«ã€‚</p>
        </div>
        
        <div class="meta">
            Posted on <a href="/2015-04-02/simple-rough-print-with-pi.html">2015-04-02 00:00:00</a>
        </div>
    </div>

    <div class="post">
        <h3><a href="/2014-06-25/noblocking-coredata-in-multithread.html">é€šåˆ™ä¸ç—›ï¼Œè¿œç¦»é˜»å¡-åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨CoreDataï¼Œä»¥åŠä¸€ä¸ªç®€å•çš„å°è£…</a></h3>
      
        <div class="body">
            <p>ä¸Šå›ä¹¦è¯´é“ï¼Œå…¶å®CoreDataå­¦èµ·æ¥ä¹Ÿæ²¡æœ‰å¾ˆå¤æ‚ï¼Œæˆ‘ä»¬å…¶å®å¢åˆ æ”¹æŸ¥éƒ½å’Œåˆ«çš„ORMå¤§åŒå°å¼‚ã€‚ä½†æ˜¯ä¸–ç•Œæ€»æ˜¯å¾ˆå¤æ‚çš„ï¼Œä¸€æ ¹ç­‹çš„å»è€ƒè™‘é—®é¢˜å¾ˆå®¹æ˜“å¡åˆ°è›‹ï¼Œé»˜è®¤æƒ…å†µä¸‹æˆ‘ä»¬çš„ä»£ç éƒ½åœ¨Main Threadä¸­æ‰§è¡Œï¼Œæ•°æ®åº“æ“ä½œä¸€æ—¦é‡å¤šäº†ï¼Œé¢‘ç¹äº†ï¼ŒåŠ¿å¿…ä¼šé˜»å¡ä½ä¸»çº¿ç¨‹çš„å…¶ä»–æ“ä½œï¼Œä¿—è¯è¯´ï¼Œå¡ä½äº†ã€‚</p>
<p>è¿™ä¸ªä¸–ç•Œå¤©ç„¶æ˜¯å¤šçº¿ç¨‹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ“ä½œæ•°æ®ä¹Ÿå¿…é¡»å¤šçº¿ç¨‹ã€‚CoreDataå¯¹å¤šçº¿ç¨‹çš„æ”¯æŒæ¯”è¾ƒå¥‡æ€ªï¼ˆæŒ‰ç…§ä¸€èˆ¬çš„æ€è·¯æ¥è¯´ï¼‰ï¼ŒCoreDataçš„NSPersistentStoreCoordinatorå’ŒNSManagedObjectContextå¯¹è±¡éƒ½æ˜¯ä¸èƒ½è·¨çº¿ç¨‹ä½¿ç”¨çš„ï¼ŒNSManagedObjectä¹Ÿä¸è¡Œï¼Œæœ‰äººæƒ³åŠ é”ä¸å°±å®Œäº†ã€‚Noï¼Œä½œä¸ºä¸€ä¸ªå¤„å¥³åº§æ˜¯ä¸èƒ½å¿å—è¿™ä¹ˆä¸‘é™‹çš„è§£å†³æ–¹æ¡ˆçš„ã€‚å…¶å®NSManagedObjectContextå·²ç»å¯¹è·¨çº¿ç¨‹æä¾›äº†å†…ç½®çš„æ”¯æŒï¼Œåªä¸è¿‡æ–¹å¼æ¯”è¾ƒç‰¹æ®Šï¼Œéœ€è¦è„‘æ´å¤§å¼€æ‰è¡Œã€‚</p>
<p>åœ¨åˆ›å»ºNSManagedObjectçš„æ—¶å€™æœ‰ä¸ªæ„é€ å™¨å‚æ•°initWithConcurrencyTypeå°±æ˜¯è§£å†³çš„å…³é”®æ‰€åœ¨ï¼Œè¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæšä¸¾ï¼Œæœ‰ä¸‰ä¸ªå¯é€‰å€¼ï¼š</p>
<ol>
<li>NSConfinementConcurrencyType  (æˆ–è€…ä¸åŠ å‚æ•°ï¼Œé»˜è®¤å°±æ˜¯è¿™ä¸ª)</li>
<li>NSMainQueueConcurrencyType    (è¡¨ç¤ºåªä¼šåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œ)</li>
<li>NSPrivateQueueConcurrencyType (è¡¨ç¤ºå¯ä»¥åœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œ)</li>
</ol>
<p>é‚£ä¹ˆç©¶ç«Ÿåº”è¯¥æ€ä¹ˆä½¿ç”¨æ‰èƒ½æ— é˜»å¡æ— ç—›å‘¢ï¼Ÿ</p>
<p>ç»è¿‡å‚è€ƒï¼š http://www.cocoanetics.com/2012/07/multi-context-coredata/ è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‰å±‚ NSManagedObjectContext åµŒå¥—çš„æ–¹å¼ã€‚</p>
<p>NSManagedObjectContextæ˜¯å¯ä»¥åŸºäºå…¶ä»–çš„ NSManagedObjectContextçš„ï¼Œé€šè¿‡ setParentContext æ–¹æ³•ï¼Œå¯ä»¥è®¾ç½®å¦å¤–ä¸€ä¸ª NSManagedObjectContext ä¸ºè‡ªå·±çš„çˆ¶çº§ï¼Œè¿™ä¸ªæ—¶å€™å­çº§å¯ä»¥è®¿é—®çˆ¶çº§ä¸‹æ‰€æœ‰çš„å¯¹è±¡ï¼Œè€Œä¸”å­çº§ NSManagedObjectContext çš„å†…å®¹å˜åŒ–åï¼Œå¦‚æœæ‰§è¡Œsaveæ–¹æ³•ï¼Œä¼šè‡ªåŠ¨çš„ merge åˆ°çˆ¶çº§ NSManagedObjectContext ä¸­ï¼Œä¹Ÿå°±æ˜¯å­çº§saveåï¼Œå˜åŠ¨ä¼šåŒæ­¥åˆ°çˆ¶çº§ NSManagedObjectContextã€‚å½“ç„¶è¿™ä¸ªæ—¶å€™çˆ¶çº§ä¹Ÿå¿…é¡»å†saveä¸€æ¬¡ï¼Œå¦‚æœçˆ¶çº§æ²¡æœ‰çˆ¶çº§äº†ï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥å‘NSPersistentStoreCoordinatorä¸­å†™å…¥ï¼Œå¦‚æœæœ‰å°±ä¼šæ¥ç€å‘å†ä¸Šä¸€å±‚çš„çˆ¶çº§å†’æ³¡......</p>
<p>é‚£ä¹ˆè¿™é‡Œå¦‚åŒå‚è€ƒçš„æ–‡ç« ä¸€æ ·ï¼Œé€šè¿‡ä¸‰ä¸ªçº§åˆ«çš„ NSManagedObjectContextï¼Œ ä¸€ä¸ªè´Ÿè´£åœ¨backgroundæ›´æ–°NSPersistentStoreCoordinatorã€‚ä¸€ä¸ªç”¨åœ¨ä¸»çº¿ç¨‹ï¼Œä¸»è¦æ‰§è¡Œæ’å…¥ï¼Œä¿®æ”¹å’Œåˆ é™¤æ“ä½œï¼Œä¸€äº›å°çš„æŸ¥è¯¢ä¹Ÿå¯ä»¥åœ¨è¿™é‡ŒåŒæ­¥æ‰§è¡Œï¼Œå¦‚æœæœ‰å¤§çš„æŸ¥è¯¢ï¼Œå°±èµ·ä¸€ä¸ªæ–°çš„ NSPrivateQueueConcurrencyType ç±»å‹çš„ NSManagedObjectContextï¼Œç„¶åæ”¾åœ¨åå°å»æ‰§è¡ŒæŸ¥è¯¢ï¼ŒæŸ¥è¯¢å®Œæˆåå°†ç»“æœè¿”å›ä¸»çº¿ç¨‹ã€‚</p>
<p>NSManagedObjectContextåœ¨åå°çº¿ç¨‹æ‰§è¡Œæ˜¯é€šè¿‡ performBlock æ–¹æ³•æ¥å®ç°çš„ï¼Œåœ¨ä¼ å…¥çš„åŒ¿åblockä¸­æ‰§è¡Œçš„ä»£ç å°±æ˜¯åœ¨å­çº¿ç¨‹ä¸­äº†ï¼Œæ¯”å¦‚</p>
<pre><code>[_bgObjectContext performBlock:^{
    __block NSError *inner_error = nil;
    [_bgObjectContext save:&amp;inner_error];
}];
</code></pre>
<p>é‚£ä¹ˆå¦‚æœæ˜¯æŸ¥è¯¢çš„è¯ï¼Œå› ä¸º NSManagedObject ä¹Ÿä¸èƒ½è·¨çº¿ç¨‹è®¿é—®ï¼Œæ‰€ä»¥åœ¨blocké‡Œè·å–åˆ°çš„NSManagedObjectå¯¹è±¡åªèƒ½å°†objectidä¼ åˆ°ä¸»çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹å†é€šè¿‡ objectWithID æ¢å¤å¯¹è±¡çš„æ–¹æ³•ï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹ï¼š</p>
<pre><code>+(void)one:(NSString*)predicate on:(ObjectResult)handler{
    NSManagedObjectContext *ctx = [[mmDAO instance] createPrivateObjectContext];
    [ctx performBlock:^{
        NSFetchRequest *fetchRequest = [self makeRequest:ctx predicate:predicate orderby:nil offset:0 limit:1];
        NSError* error = nil;
        NSArray* results = [ctx executeFetchRequest:fetchRequest error:&amp;error];
        if (error) {
            NSLog(@"error: %@", error);
            [[mmDAO instance].mainObjectContext performBlock:^{
                handler(@[], nil);
            }];
        }
        if ([results count]&lt;1) {
            [[mmDAO instance].mainObjectContext performBlock:^{
                handler(@[], nil);
            }];
        }
        NSManagedObjectID *objId = ((NSManagedObject*)results[0]).objectID;
        [[mmDAO instance].mainObjectContext performBlock:^{
            handler([[mmDAO instance].mainObjectContext objectWithID:objId], nil);
        }];
    }];
}
</code></pre>
<p>æœ€åæˆ‘ä»¬å°†ä¸Šè¿°çš„è¦ç‚¹ç»“åˆèµ·æ¥ï¼Œè§£å†³æ–¹æ¡ˆå°±å‘¼ä¹‹æ¬²å‡ºäº†ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬è¿˜æ˜¯éœ€è¦ä¸€ä¸ªæŠ½è±¡å­˜å‚¨å’Œæ•°æ®æ“ä½œçš„æ ¸å¿ƒ</p>
<p>mmDAO.h</p>
<pre><code>//
//  mmDAO.h
//  agent
//
//  Created by LiMing on 14-6-24.
//  Copyright (c) 2014å¹´ Alexander. All rights reserved.
//

#import &lt;Foundation/Foundation.h&gt;

typedef void(^OperationResult)(NSError* error);

@interface mmDAO : NSObject
@property (readonly, strong, nonatomic) NSOperationQueue *queue;
@property (readonly ,strong, nonatomic) NSManagedObjectContext *bgObjectContext;
@property (readonly, strong, nonatomic) NSManagedObjectContext *mainObjectContext;

+(mmDAO*)instance;
-(void) setupEnvModel:(NSString *)model DbFile:(NSString*)filename;
- (NSManagedObjectContext *)createPrivateObjectContext;
-(NSError*)save:(OperationResult)handler;

@end
</code></pre>
<p>mmDAO.m</p>
<pre><code>//
//  mmDAO.m
//  agent
//
//  Created by LiMing on 14-6-24.
//  Copyright (c) 2014å¹´ Alexander. All rights reserved.
//

#import "mmDAO.h"
#import "mmAppDelegate.h"

static mmDAO *onlyInstance;

@interface mmDAO ()
@property (nonatomic, copy)NSString *modelName;
@property (nonatomic, copy)NSString *dbFileName;
@end

@implementation mmDAO
+(mmDAO*)instance{
    static dispatch_once_t onceToken;
    dispatch_once(&amp;onceToken, ^{
        onlyInstance = [[mmDAO alloc] init];
    });
    return onlyInstance;
}

- (instancetype)init
{
    self = [super init];
    if (self) {
    }
    return self;
}

-(void) setupEnvModel:(NSString *)model DbFile:(NSString*)filename{
    _modelName = model;
    _dbFileName = filename;
    [self initCoreDataStack];
}

- (void)initCoreDataStack
{
    NSPersistentStoreCoordinator *coordinator = [self persistentStoreCoordinator];
    if (coordinator != nil) {
        _bgObjectContext = [[NSManagedObjectContext alloc] initWithConcurrencyType:NSPrivateQueueConcurrencyType];
        [_bgObjectContext setPersistentStoreCoordinator:coordinator];

        _mainObjectContext = [[NSManagedObjectContext alloc] initWithConcurrencyType:NSMainQueueConcurrencyType];
        [_mainObjectContext setParentContext:_bgObjectContext];
    }

}


- (NSManagedObjectContext *)createPrivateObjectContext
{
    NSManagedObjectContext *ctx = [[NSManagedObjectContext alloc] initWithConcurrencyType:NSPrivateQueueConcurrencyType];
    [ctx setParentContext:_mainObjectContext];

    return ctx;
}


- (NSManagedObjectModel *)managedObjectModel
{
    NSManagedObjectModel *managedObjectModel;
    NSURL *modelURL = [[NSBundle mainBundle] URLForResource:_modelName withExtension:@"momd"];
    managedObjectModel = [[NSManagedObjectModel alloc] initWithContentsOfURL:modelURL];
    return managedObjectModel;
}

- (NSPersistentStoreCoordinator *)persistentStoreCoordinator
{
    NSPersistentStoreCoordinator *persistentStoreCoordinator = nil;
    NSURL *storeURL = [[self applicationDocumentsDirectory] URLByAppendingPathComponent:_dbFileName];

    NSError *error = nil;
    persistentStoreCoordinator = [[NSPersistentStoreCoordinator alloc] initWithManagedObjectModel:[self managedObjectModel]];
    if (![persistentStoreCoordinator addPersistentStoreWithType:NSSQLiteStoreType configuration:nil URL:storeURL options:nil error:&amp;error]) {
        NSLog(@"Unresolved error %@, %@", error, [error userInfo]);
        abort();
    }
    return persistentStoreCoordinator;
}

- (NSURL *)applicationDocumentsDirectory
{
    return [[[NSFileManager defaultManager] URLsForDirectory:NSDocumentDirectory inDomains:NSUserDomainMask] lastObject];
}


-(NSError*)save:(OperationResult)handler{
    NSError *error;
    if ([_mainObjectContext hasChanges]) {
        [_mainObjectContext save:&amp;error];
        [_bgObjectContext performBlock:^{
            __block NSError *inner_error = nil;
            [_bgObjectContext save:&amp;inner_error];
            if (handler){
                //handler(error);
                //è¿™é‡Œéœ€è¦è¿”å›ä¸»çº¿ç¨‹ï¼Œä¸ç„¶åœ¨å›è°ƒé‡Œæ“ä½œç•Œé¢ä¼šå‡ºé”™
                [_mainObjectContext performBlock:^{
                    handler(error);
                }];
            }
        }];
    }
    return error;
}


@end
</code></pre>
<p>ç„¶åæˆ‘ä»¬æ‰©å±• NSManagedObjectï¼ŒæŠŠæ“ä½œæ³¨å…¥åˆ°ç±»é‡Œï¼Œè¿™æ ·å­æœ‰ä¸ªå¥½å¤„æ˜¯å¯ä»¥è‡ªåŠ¨è·å–ç±»åï¼Œç„¶åå°±ä¸ç”¨å­çº§å†™å­—ç¬¦ä¸²çš„ç±»åäº†ã€‚</p>
<p>NSManagedObject+helper.h</p>
<pre><code>//
//  NSManagedObject+helper.h
//  agent
//
//  Created by LiMing on 14-6-24.
//  Copyright (c) 2014å¹´ bangban. All rights reserved.
//

typedef void(^ListResult)(NSArray* result, NSError *error);
typedef void(^ObjectResult)(id result, NSError *error);

#import &lt;CoreData/CoreData.h&gt;
#import "mmDAO.h"


@interface NSManagedObject (helper)

+(id)createNew;

+(NSError*)save:(OperationResult)handler;

+(NSArray*)filter:(NSString *)predicate orderby:(NSArray *)orders offset:(int)offset limit:(int)limit;

+(void)filter:(NSString *)predicate orderby:(NSArray *)orders offset:(int)offset limit:(int)limit on:(ListResult)handler;

+(id)one:(NSString*)predicate;

+(void)one:(NSString*)predicate on:(ObjectResult)handler;

+(void)delobject:(id)object;
@end
</code></pre>
<p>NSManagedObject+helper.m</p>
<pre><code>//
//  NSManagedObject+helper.m
//  agent
//
//  Created by LiMing on 14-6-24.
//  Copyright (c) 2014å¹´ bangban. All rights reserved.
//

#import "NSManagedObject+helper.h"

@implementation NSManagedObject (helper)
+(id)createNew{
    NSString *className = [NSString stringWithUTF8String:object_getClassName(self)];
    return [NSEntityDescription insertNewObjectForEntityForName:className inManagedObjectContext:[mmDAO instance].mainObjectContext];
}

+(NSError*)save:(OperationResult)handler{
    return [[mmDAO instance] save:handler];
}

+(NSArray*)filter:(NSString *)predicate orderby:(NSArray *)orders offset:(int)offset limit:(int)limit{

    NSManagedObjectContext *ctx = [mmDAO instance].mainObjectContext;
    NSFetchRequest *fetchRequest = [self makeRequest:ctx predicate:predicate orderby:orders offset:offset limit:limit];

    NSError* error = nil;
    NSArray* results = [ctx executeFetchRequest:fetchRequest error:&amp;error];
    if (error) {
        NSLog(@"error: %@", error);
        return @[];
    }
    return results;
}


+(NSFetchRequest*)makeRequest:(NSManagedObjectContext*)ctx predicate:(NSString*)predicate orderby:(NSArray*)orders offset:(int)offset limit:(int)limit{
    NSString *className = [NSString stringWithUTF8String:object_getClassName(self)];
    NSFetchRequest *fetchRequest = [[NSFetchRequest alloc] init];
    [fetchRequest setEntity:[NSEntityDescription entityForName:className inManagedObjectContext:ctx]];
    [fetchRequest setPredicate:[NSPredicate predicateWithFormat:predicate]];
    NSMutableArray *orderArray = [[NSMutableArray alloc] init];
    if (orders!=nil) {
        for (NSString *order in orders) {
            NSSortDescriptor *orderDesc = nil;
            if ([[order substringToIndex:1] isEqualToString:@"-"]) {
                orderDesc = [[NSSortDescriptor alloc] initWithKey:[order substringFromIndex:1]
                                                        ascending:NO];
            }else{
                orderDesc = [[NSSortDescriptor alloc] initWithKey:order
                                                        ascending:YES];
            }
        }
        [fetchRequest setSortDescriptors:orderArray];
    }
    if (offset&gt;0) {
        [fetchRequest setFetchOffset:offset];
    }
    if (limit&gt;0) {
        [fetchRequest setFetchLimit:limit];
    }
    return fetchRequest;
}

+(void)filter:(NSString *)predicate orderby:(NSArray *)orders offset:(int)offset limit:(int)limit on:(ListResult)handler{

    NSManagedObjectContext *ctx = [[mmDAO instance] createPrivateObjectContext];
    [ctx performBlock:^{
        NSFetchRequest *fetchRequest = [self makeRequest:ctx predicate:predicate orderby:orders offset:offset limit:limit];
        NSError* error = nil;
        NSArray* results = [ctx executeFetchRequest:fetchRequest error:&amp;error];
        if (error) {
            NSLog(@"error: %@", error);
            [[mmDAO instance].mainObjectContext performBlock:^{
                handler(@[], nil);
            }];
        }
        if ([results count]&lt;1) {
            [[mmDAO instance].mainObjectContext performBlock:^{
                handler(@[], nil);
            }];
        }
        NSMutableArray *result_ids = [[NSMutableArray alloc] init];
        for (NSManagedObject *item  in results) {
            NSLog(@"id=%@", item.objectID);
            [result_ids addObject:item.objectID];
        }
        [[mmDAO instance].mainObjectContext performBlock:^{
            NSMutableArray *final_results = [[NSMutableArray alloc] init];
            for (NSManagedObjectID *oid in result_ids) {
                [final_results addObject:[[mmDAO instance].mainObjectContext objectWithID:oid]];
            }
            handler(final_results, nil);
        }];
    }];
}


+(id)one:(NSString*)predicate{
    NSManagedObjectContext *ctx = [mmDAO instance].mainObjectContext;
    NSFetchRequest *fetchRequest = [self makeRequest:ctx predicate:predicate orderby:nil offset:0 limit:1];
    NSError* error = nil;
    NSArray* results = [ctx executeFetchRequest:fetchRequest error:&amp;error];
    if ([results count]!=1) {
        raise(1);
    }
    return results[0];
}

+(void)one:(NSString*)predicate on:(ObjectResult)handler{
    NSManagedObjectContext *ctx = [[mmDAO instance] createPrivateObjectContext];
    [ctx performBlock:^{
        NSFetchRequest *fetchRequest = [self makeRequest:ctx predicate:predicate orderby:nil offset:0 limit:1];
        NSError* error = nil;
        NSArray* results = [ctx executeFetchRequest:fetchRequest error:&amp;error];
        if (error) {
            NSLog(@"error: %@", error);
            [[mmDAO instance].mainObjectContext performBlock:^{
                handler(@[], nil);
            }];
        }
        if ([results count]&lt;1) {
            [[mmDAO instance].mainObjectContext performBlock:^{
                handler(@[], nil);
            }];
        }
        NSManagedObjectID *objId = ((NSManagedObject*)results[0]).objectID;
        [[mmDAO instance].mainObjectContext performBlock:^{
            handler([[mmDAO instance].mainObjectContext objectWithID:objId], nil);
        }];
    }];
}


+(void)delobject:(id)object{
    //[[mmDAO instance].mainObjectContext delete:object];
    //è¿™é‡Œæ–¹æ³•åå†™é”™äº†
    [[mmDAO instance].mainObjectContext deleteObject:object];
}

@end
</code></pre>
<p>æœ¬æ–‡å†…å®¹å·²ç»æ‰“åŒ…æ”¾åœ¨äº†githubï¼Œæœ‰å…´è¶£çš„å¯ä»¥forkä¸‹æ¥ç›´æ¥ç”¨  <a href="https://github.com/ipconfiger/asyncCoreDataWrapper">https://github.com/ipconfiger/asyncCoreDataWrapper</a></p>
<p>å¦ï¼Œæ–‡ä¸­ä»£ç æœ‰ä¸¤å¤„é”™è¯¯ï¼Œå·²ç»åŠ ä¸Šäº†æ³¨é‡Šï¼Œæå‰çœ‹äº†çš„åŒå­¦è®°å¾—ä»¥githubä¸ºå‡†ã€‚</p>
        </div>
        
        <div class="meta">
            Posted on <a href="/2014-06-25/noblocking-coredata-in-multithread.html">2014-06-25 00:00:00</a>
        </div>
    </div>

    <div class="post">
        <h3><a href="/2014-06-25/coredata-guide-for-pythoner.html">ç»™Pythonç¨‹åºå‘˜çš„CoreDataç®€å•æŒ‡å—</a></h3>
      
        <div class="body">
            <p>åˆšä¸Šæ‰‹çš„æ—¶å€™éƒ½è¯´CoreDataå­¦ä¹ æ›²çº¿å¾ˆé™¡ï¼Œå…¶å®å¦‚æœæœ‰Hibernateæˆ–è€…SqlAlchemyç»éªŒçš„å¼€å‘äººå‘˜æ¥è¯´ï¼Œåªè¦ç›¸åº”çš„å‡ ä¸ªæ¦‚å¿µå¯¹ä¸Šå·äº†åï¼Œå­¦ä¹ èµ·æ¥è¿˜æ˜¯æ„Ÿè§‰æŒºç®€å•çš„äº†ã€‚</p>
<blockquote>
<p>é˜…è¯»æœ¬æ–‡éœ€è¦Pythonç¼–ç¨‹ç»éªŒï¼ŒObjectiveï¼Cç¼–ç¨‹ç»éªŒä»¥åŠä½¿ç”¨SqlAlchemyçš„ç»éªŒ</p>
</blockquote>
<p>é¦–å…ˆæˆ‘ä»¬ä»æ¦‚å¿µä¸Šæ¥ç†æ¸…æ¥šä¸€ä¸ªå¯¹åº”å…³ç³»</p>
<p>æ•°æ®æ˜ å°„å±‚ï¼š</p>
<table border="1">
    <tr>
        <td width="50%">SqlAlchemy</td>
        <td width="50%">CoreData</td>
    </tr>
    <tr>
        <td>
        SqlAlchemyçš„æ•°æ®æ˜ å°„æ˜¯ç”±ç»§æ‰¿è‡ªsqlalchemy.ext.declarativeä¸‹çš„declarative_baseçš„ç±»æ¥å®šä¹‰çš„ï¼Œæˆ‘ä»¬å¿…é¡»æ‰‹å·¥æŒ‡å®šå­—æ®µçš„å¯¹åº”å…³ç³»ï¼Œå†™ä»£ç æ¥å®Œæˆæ˜ å°„çš„å·¥ä½œã€‚
        </td>
        <td>
        CodeDataçš„æ˜ å°„æ˜¯ç”±xcodeç»´æŠ¤çš„XMLæ–‡ä»¶æ¥å®šä¹‰ï¼Œç”¨å·¥å…·å¯ä»¥ç”Ÿæˆå¯¹åº”çš„å®ä½“ç±»æ–‡ä»¶ï¼Œè¿è¡Œæ—¶é€šè¿‡NSManagedObjectModelçš„å®ä¾‹åŠ è½½åˆ°ç¨‹åºé‡Œã€‚
        </td>
    </tr>
</table>

<p>æŒä¹…åŒ–å±‚ï¼š</p>
<table border="1">
    <tr>
        <td width="50%">SqlAlchemy</td>
        <td width="50%">CoreData</td>
    </tr>
    <tr>
        <td width="50%">
        SqlAlchemyçš„æŒä¹…åŒ–å±‚æ˜¯æŠ½è±¡äº†å¯¹æ•°æ®åº“çš„è¿æ¥å’ŒåŸºæœ¬æ“ä½œï¼Œæ¯”å¦‚ï¼š
        DB = create_engine(settings.DB_URI, encoding="utf-8", pool_recycle=settings.TIMEOUT, echo=False)
        æ‰€æœ‰çš„sqlè¯­å¥æœ€ç»ˆéƒ½æ˜¯ç»è¿‡DBå¯¹è±¡æ¥æ‰§è¡Œçš„
        </td>
        <td width="50%">
        CodeDataçš„æŒä¹…è¯æ˜¯é€šè¿‡NSPersistentStoreCoordinatorç±»çš„å®ä¾‹æ¥æŠ½è±¡çš„ã€‚å¦‚æœå°±ä½¿ç”¨SqlLiteåº•å±‚æŒä¹…è¯æ¥çœ‹çš„åŒ–ï¼Œç­‰äºæ˜¯è¿™ä¸ªå¯¹è±¡ä¿æŒäº†å¯¹SqlLiteçš„è¿æ¥å’Œé€šè¿‡ä»–å¤„ç†æ‰€æœ‰çš„SQLè¯­å¥ï¼Œäº‹å®ä¸Šåœ¨æ„é€ çš„æ—¶å€™è¿˜ä¼ å…¥äº†NSManagedObjectModelçš„å®ä¾‹ï¼Œæ‰€ä»¥æˆ‘çŒœç”ŸæˆSQLä¹Ÿæ˜¯åœ¨è¿™é‡Œå®Œæˆçš„ã€‚
        </td>
    </tr>
</table>

<p>ä¼šè¯å±‚ï¼š</p>
<p>ä¼šè¯å±‚ä¿æŒäº†å¯¹è±¡çŠ¶æ€ï¼Œå¯¹å¯¹è±¡çš„æ“ä½œéƒ½æ˜¯é€šè¿‡è¿™ä¸ªå±‚çº§å®Œæˆçš„ã€‚
<table border="1">
    <tr>
        <td width="50%">SqlAlchemy</td>
        <td width="50%">CoreData</td>
    </tr>
    <tr>
        <td>
        SqlAlchemyçš„ä¼šè¯å±‚æ˜¯é€šè¿‡ä¸€ç³»åˆ—çš„sessionå¯¹è±¡æ¥å®ç°çš„ï¼Œæœ€ç»å¸¸çš„æ•°æ®æ“ä½œéƒ½æ˜¯é€šè¿‡è¿™äº›sessionçš„å¯¹è±¡æ¥å®Œæˆçš„ã€‚æ¯”å¦‚Session = scoped_session(sessionmaker(bind=DB))ï¼Œç„¶å  session ï¼ Session()ã€‚æœ€åå¾—åˆ°çš„sessionå¯¹è±¡å°±æ˜¯ä¼šè¯å±‚çš„å¯¹è±¡äº†ã€‚
        </td>
        <td>
        CodeDataçš„ä¼šè¯æ˜¯é€šè¿‡NSManagedObjectContextç±»çš„å®ä¾‹æ¥å®ç°çš„ä¼šè¯ï¼Œinsertï¼Œdeleteï¼Œupdateå’Œqueryéƒ½æ˜¯é€šè¿‡ä¼šè¯æ¥æ“ä½œçš„ã€‚
        </td>
    </tr>
</table></p>
<blockquote>
<p>æ‰€ä»¥åŸºæœ¬ä¸ŠORMçš„å¤§éƒ¨åˆ†æ¦‚å¿µæ˜¯æƒ³é€šçš„ï¼Œæˆ‘ä»¬äº†è§£äº†å„è‡ªæ¦‚å¿µä¸Šç›¸åŒçš„ï¼Œå¯ç±»æ¯”çš„åœ°æ–¹ï¼Œç„¶åå†ææ¸…æ¥šå…·ä½“æ¯ä¸ªç‚¹ä¸Šå·®å¼‚ï¼Œé‚£ä¹ˆåŸºæœ¬ä¸Šå°±å¯ä»¥å¾ˆå¿«çš„æŒæ¡æ–°çš„æŠ€æœ¯äº†ã€‚</p>
</blockquote>
<p>ä¸‹é¢ä»å®é™…çš„ä»£ç ä¸Šæ¥æ„Ÿå—ä¸€ä¸‹ç›¸åŒç‚¹å’Œä¸åŒç‚¹ï¼š</p>
<h2>Python Sqlalchemyç‰ˆ åˆå§‹åŒ–æ•°æ®åº“ç¯å¢ƒï¼š</h2>
<h3>modelå®šä¹‰ï¼š</h3>
<pre><code>from sqlalchemy import Column, Integer, String
from sqlalchemy.ext.declarative import declarative_base, declared_attr

TABLEARGS = {
    'mysql_engine': 'InnoDB',
    'mysql_charset': 'utf8'
}

class DeclaredBase(object):
    @declared_attr
    def __tablename__(cls):
        return cls.__name__.lower()
    id = Column(Integer, primary_key=True, autoincrement=True)

Base = declarative_base(cls=DeclaredBase)
GroupBase = declarative_base(cls=DeclaredBase)

class User(Base):
    user_id = Column(String(36), unique=True)
    user_name = Column(String(20))
    password = Column(String(36))
    gender = Column(Integer)
    online = Column(Boolean)
    last_update = Column(Integer)
    __table_args__ = TABLEARGS
</code></pre>
<h3>åˆå§‹åŒ–æŒä¹…è¯å’Œä¼šè¯ï¼š</h3>
<pre><code>from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker, scoped_session

DB = create_engine("localhost", encoding="utf-8", pool_recycle=3600, echo=False)
Session = scoped_session(sessionmaker(bind=DB))
db = Session()
</code></pre>
<h2>CoreDataç‰ˆ åˆå§‹åŒ–æ•°æ®åº“ç¯å¢ƒï¼š</h2>
<h3>modelå®šä¹‰</h3>
<p>å€¼å¾—å¼€å¿ƒçš„æ˜¯ï¼ŒXcodeå®šä¹‰æ¨¡å‹åªéœ€è¦ç‚¹ç‚¹é¼ æ ‡å¡«åå­—ï¼Œå¤ªç°ä»£åŒ–äº†
<img alt="image" src="http://ww4.sinaimg.cn/large/578b198bgw1ehqh5ifbwsj20bs0bhq3s.jpg" /></p>
<p>å·¥å…·è‡ªåŠ¨ç”Ÿæˆå­ç±»ï¼š</p>
<pre><code>#import &lt;Foundation/Foundation.h&gt;
#import &lt;CoreData/CoreData.h&gt;

@interface User : NSManagedObject

@property (nonatomic, retain) NSString * avatar;
@property (nonatomic, retain) NSDecimalNumber * balance;
@property (nonatomic, retain) NSString * birthday;
@property (nonatomic, retain) NSString * desp;
@property (nonatomic) int16_t gender;
@property (nonatomic, retain) NSString * mobile;
@property (nonatomic, retain) NSString * nick;
@property (nonatomic) int32_t user_id;

@end
</code></pre>
<h3>åˆå§‹åŒ–æŒä¹…è¯å’Œä¼šè¯ï¼š</h3>
<p>è¿™ä¸€æ­¥é¡ºåºä¸Šå’ŒSqlAlchemyåœ¨é¡ºåºä¸Šæœ‰ç‚¹åŒºåˆ«ï¼Œå› ä¸ºéœ€è¦åœ¨æŒä¹…è¯å¯¹è±¡é‡Œä¼ å…¥æ•°æ®æ¨¡å‹å¯¹è±¡ï¼Œæ‰€ä»¥éœ€è¦å…ˆå®ä¾‹åŒ–æ•°æ®æ¨¡å‹çš„å¯¹è±¡</p>
<pre><code>//è¿”å›å®ä¾‹åŒ–åçš„æ¨¡å‹å¯¹è±¡
- (NSManagedObjectModel *)managedObjectModel
{
    NSManagedObjectModel *managedObjectModel;
    NSURL *modelURL = [[NSBundle mainBundle] URLForResource:@"æ¨¡å‹çš„åå­—" withExtension:@"momd"];
    managedObjectModel = [[NSManagedObjectModel alloc] initWithContentsOfURL:modelURL];
    return managedObjectModel;
}

//è¿”å›å®ä¾‹åŒ–çš„æŒä¹…è¯å¯¹è±¡,å¯¹åº”åˆ°create_engine
- (NSPersistentStoreCoordinator *)persistentStoreCoordinator
{
    NSPersistentStoreCoordinator *persistentStoreCoordinator = nil;
    NSURL *storeURL = [[self applicationDocumentsDirectory] URLByAppendingPathComponent:@"agent.sqlite"];

    NSError *error = nil;
    persistentStoreCoordinator = [[NSPersistentStoreCoordinator alloc] initWithManagedObjectModel:[self managedObjectModel]];
    if (![persistentStoreCoordinator addPersistentStoreWithType:NSSQLiteStoreType configuration:nil URL:storeURL options:nil error:&amp;error]) {
        NSLog(@"Unresolved error %@, %@", error, [error userInfo]);
        abort();
    }
    return persistentStoreCoordinator;
}

   //è¿”å›ä¼šè¯å¯¹è±¡ï¼Œå¯¹åº”åˆ° Session()
   - (NSManagedObjectContext *)createObjectContext:(NSPersistentStoreCoordinator*)coordinator
{
    NSManagedObjectContext *ctx = [[NSManagedObjectContext alloc] init];
    [ctx setPersistentStoreCoordinator:coordinator];
    return ctx;
}
</code></pre>
<p>ç›¸å¯¹æ¥è¯´Pythonçš„ä»£ç è‚¯å®šçŸ­å°å¾ˆå¤šäº†ï¼ŒObjective-Cå†™èµ·æ¥æ¯”è¾ƒå•°å—¦ï¼Œä½†æ˜¯å…¶å®ç®€å•çš„å°è£…ä¸€ä¸‹ç”¨èµ·æ¥ä¹Ÿæ²¡æœ‰è¿™ä¹ˆéº»çƒ¦äº†ã€‚ä¸‹å›æˆ‘ä»¬æ¥è¯´è¯´å°è£…çš„äº‹æƒ…ï¼Œè¿™é‡Œå°±ç®€å•çš„ä¸¢åˆ°ä¸€ä¸ªå•ä¾‹çš„ç±»é‡Œå°±okã€‚Xcodeçš„ä»£ç æ¨¡ç‰ˆæ˜¯æŠŠCoordinatorå’ŒObjectContextéƒ½æ”¾åˆ°äº†appDelegateå¯¹è±¡é‡Œï¼Œä½†æ˜¯å¿…é¡»</p>
<pre><code>[(YourAppDelegate*)[[UIApplication sharedApplication] delegate] doYourBusiness];
</code></pre>
<p>è¿™æ ·å­æ‰èƒ½è®¿é—®ï¼Œæ¯”è¾ƒå•°å—¦ï¼Œåæ­£å®˜æ–¹çš„ä¾‹å­éƒ½æ˜¯æ”¾å…¨å±€å˜é‡äº†ï¼Œæˆ‘ä»¬å°±ç”¨ä¸€ä¸ªç®€å•çš„å•ä¾‹ä»£æ›¿ï¼š</p>
<pre><code>static mmDAO *onlyInstance;

@implementation mmDAO
+(mmDAO*)instance{
    static dispatch_once_t onceToken;
    dispatch_once(&amp;onceToken, ^{
        onlyInstance = [[mmDAO alloc] init];
    });
    return onlyInstance;
}

- (instancetype)init
{
    self = [super init];
    if (self) {
        [self initCoreDataStack];
    }
    return self;
}

- (void)initCoreDataStack
{
    NSPersistentStoreCoordinator *coordinator = [self persistentStoreCoordinator];
    if (coordinator != nil) {
        _ObjectContext = [[NSManagedObjectContext alloc] initWithConcurrencyType:NSPrivateQueueConcurrencyType];
        [_ObjectContext setPersistentStoreCoordinator:coordinator];
    }

}

- (NSManagedObjectModel *)managedObjectModel
{
    NSManagedObjectModel *managedObjectModel;
    NSURL *modelURL = [[NSBundle mainBundle] URLForResource:@"XXX" withExtension:@"momd"];
    managedObjectModel = [[NSManagedObjectModel alloc] initWithContentsOfURL:modelURL];
    return managedObjectModel;
}

- (NSPersistentStoreCoordinator *)persistentStoreCoordinator
{
    NSPersistentStoreCoordinator *persistentStoreCoordinator = nil;
    NSURL *storeURL = [[self applicationDocumentsDirectory] URLByAppendingPathComponent:@"agent.sqlite"];

    NSError *error = nil;
    persistentStoreCoordinator = [[NSPersistentStoreCoordinator alloc] initWithManagedObjectModel:[self managedObjectModel]];
    if (![persistentStoreCoordinator addPersistentStoreWithType:NSSQLiteStoreType configuration:nil URL:storeURL options:nil error:&amp;error]) {
        NSLog(@"Unresolved error %@, %@", error, [error userInfo]);
        abort();
    }
    return persistentStoreCoordinator;
}

- (NSURL *)applicationDocumentsDirectory
{
    return [[[NSFileManager defaultManager] URLsForDirectory:NSDocumentDirectory inDomains:NSUserDomainMask] lastObject];
}

@end
</code></pre>
<p>è¿™æ ·å­åªéœ€è¦é€šè¿‡</p>
<pre><code>[mmDAO instance].objectContext
</code></pre>
<p>å°±å¯ä»¥è®¿é—®åˆ°ä¼šè¯å¯¹è±¡æ¥æ“ä½œæ•°æ®äº†</p>
<h2>å„è‡ªç‰ˆæœ¬çš„å¢åˆ æ”¹</h2>
<p>SqlAlchemyçš„æƒ³æ³•æ˜¯åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œæ”¾å…¥Contextï¼š</p>
<pre><code>user = User()
user.user_name = 'Alex'
...
session.add(user)
</code></pre>
<p>CoreDataçš„æƒ³æ³•æ˜¯ä»Contexté‡Œæ‹¿ä¸€ä¸ªå‡ºæ¥å°±ä¸ç”¨æ”¾è¿›å»äº†ï¼š</p>
<pre><code>User *user = [NSEntityDescription insertNewObjectForEntityForName:@"User" inManagedObjectContext:[mmDAO instance].objectContext];
user.user_name = @"Alex"
...
</code></pre>
<p>SqlAlchemyåˆ é™¤å¯¹è±¡çš„æ–¹æ³•æ˜¯ï¼ŒæŠŠå¯¹è±¡ä¸¢è¿›contextçš„deleteæ–¹æ³•</p>
<pre><code>session.delete(user)
</code></pre>
<p>CoreDataä¹Ÿæ˜¯è¿™æ ·å­</p>
<pre><code>[[mmDAO instance].objectContext delete:user];
</code></pre>
<p>SqlAlchemyæ’å…¥äº†å¯¹è±¡åï¼Œä¿®æ”¹äº†å¯¹è±¡çš„å±æ€§åï¼Œæˆ–è€…åˆ é™¤äº†å¯¹è±¡åï¼Œåªéœ€è¦æ‰§è¡Œcommitï¼Œå°±ä¼šå°†æ”¹åŠ¨å…¨éƒ¨ä¸€æ¬¡æ€§æäº¤ç»™æ•°æ®åº“ï¼Œå…¶å®æ‰§è¡Œflushå°±å¯ä»¥ï¼Œæ‰§è¡Œcommitä¼šæäº¤äº‹åŠ¡ã€‚è€ŒCoreDataä¹Ÿæ˜¯é€šè¿‡Contextçš„saveæ–¹æ³•å°†æ•°æ®ä¸€æ¬¡æ€§æäº¤ç»™æŒä¹…åŒ–è®¾æ–½ï¼Œæ¯”å¦‚SqlLiteã€‚</p>
<blockquote>
<p>å¯¹æ¯”åˆ°è¿™é‡Œå…¶å®æˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒORMçš„åŸºæœ¬å®ç°éƒ½è¶‹åŒåŒ–äº†ï¼Œåœ¨æŒæ¡ä¸€é—¨ORMçš„æ“ä½œåå†å­¦ä¹ å…¶ä»–çš„ORMå…¶å®ä¹Ÿå¹¶ä¸å­˜åœ¨å¾ˆæŠ–çš„å­¦ä¹ æ›²çº¿ã€‚å­¦è¿‡Hibernateçš„åŒå­¦ä¹Ÿå¯ä»¥é€šè¿‡ç›¸åŒçš„æ–¹å¼æ¥ç±»æ¯”ä¸€ä¸‹ï¼Œç›¸ä¿¡å¯¹äºæŒæ¡CoreDataçš„å¼€å‘èƒ½å¤Ÿèµ·åˆ°æ„æƒ³ä¸åˆ°çš„ä½œç”¨</p>
</blockquote>
        </div>
        
        <div class="meta">
            Posted on <a href="/2014-06-25/coredata-guide-for-pythoner.html">2014-06-25 00:00:00</a>
        </div>
    </div>

    <div class="post">
        <h3><a href="/2014-05-11/ä½¿NodeJsçš„requireèƒ½å¤ŸåŠ è½½å˜æ›´åçš„æ¨¡å—.html">ä½¿NodeJsçš„requireèƒ½å¤ŸåŠ è½½å˜æ›´åçš„æ¨¡å—</a></h3>
      
        <div class="body">
            <p>èµ·å› æ˜¯è¿™æ ·å­çš„ï¼Œæˆ‘æ‰“ç®—åšä¸ªå·¥å…·ï¼Œéœ€è¦èƒ½å¤ŸåŠ¨æ€åŠ è½½å¤–éƒ¨çš„æ¨¡å—ï¼Œç”±äºæ˜¯è·‘èµ·æ¥éœ€è¦æ¯”è¾ƒé•¿æ—¶é—´è¿è¡Œï¼Œæ‰€ä»¥éœ€è¦èƒ½ç›‘æµ‹æ–‡ä»¶å˜æ›´ï¼Œä¸€æ—¦æ¨¡å—æ–‡ä»¶æ”¹åŠ¨äº†å°±è‡ªåŠ¨é‡æ–°åŠ è½½ï¼Œç½‘ä¸Šæµä¼ çš„ç»å¤§éƒ¨åˆ†å¿ƒæ³•éƒ½æ˜¯ç›‘æµ‹æ–‡ä»¶å˜åŠ¨åå°±é‡å¯ä¸€éäº†äº‹ï¼Œè¿™ç±»å¤©é­”è§£ä½“ä¼¼çš„åŠŸæ³•è¿‡äºéœ¸é“ï¼Œå†™èµ·æ¥éº»çƒ¦ï¼ŒåŠ¨è¾„æ¶‰åŠè¿›ç¨‹çº¿ç¨‹ä»€ä¹ˆçš„å¤§æ‹›ï¼Œç®€ä¾¿ç‚¹çš„å°±æ˜¯å€ŸåŠ©å¤–ç‰©ï¼Œæ¯”å¦‚node supervisoä¹‹ç±»çš„è¦å…¨å±€å®‰è£…çš„ä¾èµ–ï¼Œå¯¹äºä¸€ä¸ªåŠŸèƒ½ä»£ç ä¸€ç™¾æ¥è¡Œçš„å°å·¥å…·æ¥è¯´å¤ªè¿‡äºéœ¸é“äº†ï¼Œæ‰€ä»¥ç»†æŸ¥äº†nodeçš„æ–‡æ¡£åæ‰¾åˆ°äº†ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„æ–¹æ³•ã€‚</p>
<p>requireæ¨¡å—æœ‰ä¸€ä¸ªcacheå±æ€§ï¼ŒåŠ¨æ€åŠ è½½çš„ç“¶é¢ˆå°±åœ¨è¿™é‡Œï¼Œç›‘æµ‹æ–‡ä»¶å˜æ›´å¾ˆeasyï¼Œä½†æ˜¯é‡å¤æ‰§è¡Œrequireæ¨¡å—å¾—åˆ°çš„åªèƒ½æ˜¯ç¬¬ä¸€æ¬¡åŠ è½½çš„å†…å®¹ï¼Œç›–å› ä¸ºrequireæ¨¡å—æŠŠåŠ è½½çš„å¤–éƒ¨æ¨¡å—éƒ½ç¼“å­˜åœ¨äº†cahceè¿™ä¸ªå±æ€§é‡Œã€‚æ‰€ä»¥æˆ‘ä»¬è¦ä½œçš„äº‹æƒ…å°±å¾ˆç®€å•äº†ï¼Œcacheæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬åªéœ€è¦éå†è¿™ä¸ªå¯¹è±¡çš„å±æ€§ç„¶ååˆ¤æ–­é‚£äº›å±æ€§å¯¹åº”çš„æ¨¡å—å˜æ›´è¿‡ï¼Œå°±åˆ æ‰è¿™ä¸ªå±æ€§ï¼Œç„¶åé‡æ–°ç”¨requireåŠ è½½ä¸€è¾¹å°±okäº†ã€‚</p>
<p>åªæ˜¯ä¸ªå°æŠ€å·§ï¼Œä¸ç”¨å…¶ä»–é«˜æ·±çš„åŠŸæ³•ï¼Œä»£ç åœ¨ <a href="https://github.com/ipconfiger/node-mockit" title="node-mockit">ä¼ é€é˜µï¼šç‚¹å‡»è¿›å…¥</a>
ä¹Ÿå°±æ˜¯å‰ä¸¤å¤©æ™šä¸Šå†™çš„å°å·¥å…·</p>
        </div>
        
        <div class="meta">
            Posted on <a href="/2014-05-11/ä½¿NodeJsçš„requireèƒ½å¤ŸåŠ è½½å˜æ›´åçš„æ¨¡å—.html">2014-05-11 00:00:00</a>
        </div>
    </div>

    <div class="post">
        <h3><a href="/2014-05-06/æœ€è¿‘å•¥éƒ½æ²¡å†™ï¼Œèµ¶è„šå¥½æœ‰è´Ÿç½ªæ„Ÿ.html">æœ€è¿‘å•¥éƒ½æ²¡å†™ï¼Œèµ¶è„šå¥½æœ‰è´Ÿç½ªæ„Ÿ</a></h3>
      
        <div class="body">
            <p>RT</p>
        </div>
        
        <div class="meta">
            Posted on <a href="/2014-05-06/æœ€è¿‘å•¥éƒ½æ²¡å†™ï¼Œèµ¶è„šå¥½æœ‰è´Ÿç½ªæ„Ÿ.html">2014-05-06 00:00:00</a>
        </div>
    </div>

    <div class="post">
        <h3><a href="/2014-04-04/redis-message-with-tornado.html">ç”¨Redisä½œä¸ºåç«¯æ¥å®ç°é«˜æ€§èƒ½çš„Longpollingæ¶ˆæ¯ç³»ç»Ÿ</a></h3>
      
        <div class="body">
            <p>Redisæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„å†…å­˜KVæ•°æ®åº“ï¼Œä½†æ˜¯ç”±äºå…¶æ”¯æŒäº†å„ç§æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¯ä»¥è§†å…¶ä¸ºä¸€ä¸ªé«˜æ€§èƒ½çš„æ•°æ®ç»“æ„ï¼Œç”±æ­¤å¯ä»¥æ‰©å±•å‡ºå¾ˆå¤šå…¶ä»–ç”¨é€”ï¼Œæ¯”å¦‚ç”¨äºå®ç°ä¸€ä¸ªå¯æ‰©å±•çš„é«˜æ€§èƒ½æ¶ˆæ¯ç³»ç»Ÿã€‚æ¶ˆæ¯ç³»ç»Ÿçš„å‰ç«¯å¯ä»¥ç”¨TCPä¹Ÿå¯ä»¥ç”¨HTTPæ¥å®ç°ï¼ŒTCPé•¿è¿æ¥åœ¨ç§»åŠ¨ç«¯å—åˆ°å¾ˆå¤šé™åˆ¶ï¼Œæ¯”å¦‚å¾ˆå¤šç§»åŠ¨ç½‘å…³ä¼šè‡ªåŠ¨å…³é—­é•¿æ—¶é—´ç©ºé—²çš„TCPè¿æ¥ï¼Œæ‰€ä»¥è¿˜éœ€è¦å®ç°å¿ƒè·³ï¼Œå¿ƒè·³é¢‘ç‡ä¹Ÿéœ€è¦å°å¿ƒè®¾è®¡ã€‚è€ŒHTTPåè®®åˆ™æ˜¯åœ¨äº’è”ç½‘é¢†åŸŸç•…é€šæ— é˜»çš„åè®®ï¼Œå¯ä»¥ç”¨åœ¨å„ç§åœ°æ–¹ï¼Œä½†æ˜¯HTTPæ˜¯ä¸€ä¸ªç”±å®¢æˆ·ç«¯å‘èµ·çš„æ— ä¼šè¯åè®®ï¼Œè½®è¯¢è·å–æ¶ˆæ¯å¯¹æœåŠ¡ç«¯å‹åŠ›æ˜¯å¾ˆå¤§çš„è€ƒéªŒè€Œä¸”å®æ—¶æ€§ä¹Ÿä¸æ˜¯å¾ˆå¥½ï¼Œè¦ä»æœåŠ¡ç«¯ä¸»åŠ¨æ¨é€æ•°æ®ä¹Ÿæ˜¯ä¸å¯èƒ½çš„ã€‚ä½†æ˜¯Longpullingæ¦‚å¿µçš„æ¨å‡ºè§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼ŒæœåŠ¡å™¨å‹åŠ›é€‚ä¸­ï¼Œå®æ—¶æ€§ä¸è¾“TCPé•¿è¿æ¥ï¼Œåœ¨ç§»åŠ¨äº’è”çš„æ—¶ä»£ä¹Ÿå…·å¤‡æ„ä¹‰çš„äº‹æƒ…æ˜¯â€œé•¿â€è½®è¯¢ï¼Œæ­£å¥½è§„é¿äº†å¿ƒè·³åŒ…çš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨Longpullingçš„httpæœåŠ¡æ¥ä½œä¸ºæ¶ˆæ¯æœåŠ¡çš„å‰ç«¯ã€‚</p>
<p>åŸºæœ¬æ€è·¯æ˜¯è¿™æ ·å­çš„ã€‚æˆ‘ä»¬ç”¨tornadoä½œä¸ºå‰ç«¯ï¼Œæ‰‹æœºAppæ¯ä¸¤åˆ†é’Ÿå‘èµ·ä¸€ä¸ªhttpè¯·æ±‚åˆ°tornadoï¼Œè¯·æ±‚ä¼šå¸¦ä¸€ä¸ªå®¢æˆ·ç«¯æ ‡è¯†ï¼Œæ¯”å¦‚user_idä»€ä¹ˆçš„ï¼Œtornadoæ”¶åˆ°è¿™ä¸ªIDåï¼Œå¯¹Rediså‘èµ·ä¸€ä¸ªblpopçš„è¯·æ±‚ï¼Œç”¨è¿™ä¸ªIDä½œä¸ºkeyï¼Œè¿™æ ·å­ä¼šé˜»å¡è¿™ä¸ªè¯·æ±‚ç›´åˆ°è¶…æ—¶ï¼Œæˆ–è€…æœ‰ä¸€ä¸ªå€¼è¢«pushåˆ°è¿™ä¸ªkeyã€‚</p>
<p>ç”±äºéœ€è¦éé˜»å¡çš„è®¿é—®Redisï¼Œéœ€è¦ä¸€ä¸ªå«tornado-redisçš„åº“ã€‚</p>
<p>æˆ‘ä»¬å…ˆ pip install tornado tornado-redis å®‰è£…éœ€è¦çš„åº“</p>
<p>tornadoçš„ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>from tornado import ioloop
from tornado import web
from tornado import gen
import tornadoredis
import logging
import settings

class MainHandler(web.RequestHandler):
    @web.asynchronous
    @gen.engine
    def get(self):
        tokens = self.get_argument("token").split(",")
        c = tornadoredis.Client(host=â€™127.0.0.1â€˜, port=6379, selected_db=1)
            message = yield gen.Task(c.blpop, tokens, 120)
        if message:
            self.finish(message.values()[0])
        else:
            self.finish("{}")

class SendHandler(web.RequestHandler):
    @web.asynchronous
    @gen.engine
    def post(self):
        to = self.get_argument("target")
        message = self.get_argument("message")
        c = tornadoredis.Client(host=â€™127.0.0.1â€˜, port=6379, selected_db=1)
            message = yield gen.Task(c.blpop, tokens, 120)
        rs = yield gen.Task(c.rpush, to, message)
        self.finish(json.dumps(dict(rs=True)))


application = web.Application([
    (r"/", MainHandler),
    (r"/send", SendHandler)
], debug=True)

if __name__ == "__main__":
    application.listen(int(sys.argv[1]))
    loop = ioloop.IOLoop.instance()
    loop.start()
</code></pre>
<p>ä¸Šé¢çš„ä»£ç å®ç°äº†ä¸€ä¸ªåŸºäºredisçš„æ¶ˆæ¯æœåŠ¡ï¼Œæ”¯æŒæ¶ˆæ¯æŒä¹…åŒ–ï¼Œæ”¯æŒç‚¹å¯¹ç‚¹ã€‚</p>
<p>ç„¶åæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªIOSçš„Appæ¥æµ‹è¯•è¿™ä¸ªbrokerï¼š</p>
<p>æ ¸å¿ƒObjective-Cä»£ç å¤§è‡´æ˜¯ä¸‹é¢è¿™æ ·å­çš„ï¼š</p>
<pre><code>-(void) startListen:(void (^)(BOOL, NSString *))handler{
    NSMutableURLRequest* request = [NSMutableURLRequest requestWithURL:[NSURL URLWithString:self.url]];
    request.timeoutInterval = 120;
    if(queue==nil){
        queue = [[NSOperationQueue alloc] init];
    }
    NSLog(@"start listen");
    [NSURLConnection sendAsynchronousRequest:request queue:queue completionHandler:^(NSURLResponse *response, NSData *data, NSError *connectionError) {
    //
        if(connectionError){
            NSLog(@"%@",connectionError);
        }else{
            NSString* txt = [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding];
            NSLog(@"%@",txt);
            handler(YES, txt);
        }
        [self startListen:handler];
    }];
}
</code></pre>
<p>å¦‚æœè§‰å¾—tornadoçš„æ€§èƒ½è¿˜ä¸å¤Ÿçš„è¯è¿˜å¯ä»¥æ¢node.jsæ¥ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå‚è€ƒçš„å®ç°æ–¹å¼ï¼š</p>
<pre><code>var cluster = require('cluster');
var http = require('http');
var url = require('url');
var util = require('util');
var querystring = require('querystring');
var redis = require('redis')
var numCPUs = require('os').cpus().length;

function processResp(res, err, item){
    if(!err &amp;&amp; item){
        var data = JSON.parse(item[1]);
        res.end(JSON.stringify(data));
    }else{
        res.end(JSON.stringify(JSON.parse("{}")));
    }
}

function startServer(port){
    http.createServer(
        function (req, res) {        
            var arg = url.parse(req.url).query;
            var params = querystring.parse(arg);
            res.writeHead(200,{'Content-Type':'application/json'});
            var queue = params.token;
            var r = redis.createClient(6379, '127.0.0.1');
            r.blpop(queue, 10, function(err, item) {
                processResp(res, err, item);
            });
        }
    ).listen(port, "127.0.0.1");
}

if (cluster.isMaster){
    console.log('master stared');
    for (var i=0;i&lt;numCPUs;i++){
        cluster.fork();
    }
    cluster.on('listening', function(worker, address){
    });
}else if (cluster.isWorker){
    startServer(8888);
}
</code></pre>
<p>å‘é€æ²¡å†™ï¼Œéœ€è¦çš„è‡ªå·±å»å®ç°ã€‚</p>
<p>æ‰©å±•çš„æ–¹æ³•ï¼š</p>
<p>ç”¨å¤šç»„Redisç»„æˆå¤šä¸ªåŒºåŸŸï¼Œç„¶åå„è‡ªç”¨ä¸€ä¸ªåŸŸåæ¥æ ‡è¯†ï¼Œæ¯”å¦‚ msg0åˆ°msg10ï¼Œæ¯ä¸ªåŸŸä¸€ä¸ªrediså®ä¾‹ï¼Œç™»å½•çš„æ—¶å€™ç»™å®¢æˆ·ç«¯åˆ†é…ä¸€ä¸ªåŒºåŸŸå°±okäº†ã€‚</p>
<p>å¦‚æœæƒ³æ”¯æŒç¾¤ç»„æ¶ˆæ¯ï¼Œå°±ç”¨pubsubæ¥å®ç°</p>
        </div>
        
        <div class="meta">
            Posted on <a href="/2014-04-04/redis-message-with-tornado.html">2014-04-04 00:00:00</a>
        </div>
    </div>

    <div class="post">
        <h3><a href="/2014-01-16/dynamic-object-mapping-for-json.html">åŠ¨æ€æ˜ å°„jsonæ•°æ®åˆ°objective-cçš„å¯¹è±¡</a></h3>
      
        <div class="body">
            <p>æœ€è¿‘åœ¨å®ç°IOSçš„appè¿æ¥Restful Apiçš„éƒ¨åˆ†åŠŸèƒ½ï¼Œå‘ç°ä»Apiè·å–åˆ°jsonååºåˆ—åŒ–æˆå­—å…¸åå¦‚æœè¦æ˜ å°„åˆ°ç¨‹åºé‡Œçš„å®ä½“ï¼Œéœ€è¦å†™å¾ˆå¤šé‡å¤çš„ä»£ç ï¼Œåˆ°å¤„éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œå¾€å¾€jsonç»“æ„æ¯”è¾ƒå¤æ‚çš„æ—¶å€™ä¼šæå…¶çš„è›‹ç—›ï¼Œæ‰€ä»¥å®ç°äº†ä¸€ä¸ªå°†å­—å…¸å¯¹è±¡æ˜ å°„åˆ°objective-cç±»å®ä¾‹å±æ€§çš„ä¸œä¸œï¼Œé¡ºä¾¿å­¦ä¹ ä¸€ä¸‹objective-cçš„ä¸€éƒ¨åˆ†åŠ¨æ€ç‰¹æ€§ã€‚</p>
<p>é¦–å…ˆæ­ä¸ªæ¶å­å…ˆï¼Œå› ä¸ºè¦æ˜ å°„çš„ç›®æ ‡å¾ˆå¤šï¼Œæ‰€ä»¥æˆ‘ä»¬å®šä¹‰ä¸ªåŸºç±»ï¼Œç„¶åéœ€è¦æ˜ å°„çš„ç±»ç»§æ‰¿è¿™ä¸ªåŸºç±»å°±okäº†ï¼š</p>
<pre><code>@interface BaseModle : NSObject
- (id)init:(NSDictionary *)data;
@end
</code></pre>
<p>åªéœ€è¦æš´éœ²ä¸€ä¸ªæ„é€ å™¨å°±è¶³å¤Ÿäº†ï¼Œæ”¾å…¥ä¸€ä¸ªå­—å…¸ï¼Œç„¶åä¸€åˆ‡åŸºç±»è‡ªå·±æå®šã€‚</p>
<pre><code>#import "BaseModle.h"

@implementation BaseModle
-(id)init:(NSDictionary *)data{
    self = [super init];
    if (self){
        [self setAttributes:data];
    }
    return (self);
}

- (void)setAttributes:(NSDictionary *)data{
    //æˆ‘ä»¬å°†åœ¨è¿™é‡Œå®Œæˆæ˜ å°„çš„åŠŸèƒ½ï¼Œå½“ç„¶åªæ˜¯åŠŸèƒ½çš„èµ·å§‹ç‚¹
}
@end
</code></pre>
<p>ç„¶åæƒ³ä¸€æƒ³ï¼Œæˆ‘ä»¬åœ¨å­ç±»é‡Œä¼šå®šä¹‰å¾ˆå¤šå±æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦èƒ½å¤Ÿè·å–åˆ°è¿™äº›å±æ€§çš„åç§°å’Œç±»å‹ã€‚çŸ¥é“è¿™äº›åå†åˆ°å­—å…¸é‡Œå»å–å¯¹åº”çš„é”®å€¼èµ‹å€¼åˆ°å±æ€§ä¸Šå°±okå•¦ã€‚</p>
<p>è¦é€šè¿‡åå°„è·å–ç±»é‡Œå®šä¹‰çš„å±æ€§åˆ—è¡¨ï¼Œéœ€è¦å…ˆå¼•å…¥ objc/message.hï¼Œè¿™é‡Œå®šä¹‰äº†æˆ‘ä»¬éœ€è¦çš„class_copyPropertyListå‡½æ•°å’Œobjc_property_tç±»å‹ã€‚</p>
<pre><code>unsigned int outCount = 0;
objc_property_t *properties = class_copyPropertyList(self.class, &amp;outCount);
for (int i = 0; i &lt; outCount; i++) {
    objc_property_t property = properties[i];
    NSString *propName = [NSString stringWithUTF8String:property_getName(property)];
}
</code></pre>
<p>è¿™ä¸ªæ—¶å€™å˜é‡propNameå°±æ˜¯å±æ€§çš„åç§°äº†ï¼Œè¿™ä¸ªæ—¶å€™åªéœ€è¦æ ¹æ®å±æ€§çš„åç§°ä»dataé‡Œå–å¯¹åº”çš„é”®å€¼å°±okäº†ã€‚å¾—åˆ°å€¼åéœ€è¦ç»™å±æ€§èµ‹å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡å±æ€§åç§°å»æ„é€ ä¸€ä¸ªç»™å±æ€§èµ‹å€¼çš„selectorã€‚</p>
<pre><code>- (SEL)getSetterAttributeName:(NSString *)attributeName
{
    NSString *capital = [[attributeName substringToIndex:1] uppercaseString];
    NSString *setterSelStr = [NSString stringWithFormat:@"set%@%@:",capital,[attributeName substringFromIndex:1]];
    return NSSelectorFromString(setterSelStr);
}
</code></pre>
<p>è¿™ä¸ªæ—¶å€™åªéœ€è¦ [self performSelectorOnMainThread:sel withObject:value waitUntilDone:YES]; å°±å¯ä»¥ç»™å±æ€§èµ‹å€¼äº†ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ç»„ç»‡èµ·ç¬¬ä¸€ä¸ªç‰ˆæœ¬äº†ï¼Œä¸è¿‡ä½¿ç”¨æ¥å£çš„ä¸€ä¸ªå–œæ¬¢å‘µå‘µçš„å®¶ä¼™è¯´ï¼Œå¦‚æœjsoné‡Œæœ‰åµŒå¥—çš„å­—å…¸æ€ä¹ˆåŠå‘¢ï¼Ÿæ‰€ä»¥å†è¿›ä¸€æ­¥å®ç°é€’å½’åµŒå¥—çš„åŠŸèƒ½ã€‚è¿™ä¸ªæ—¶å€™éœ€è¦çŸ¥é“å±æ€§çš„ç±»å‹ï¼Œç„¶åæ ¹æ®ç±»å‹æ¥åŠ¨æ€åˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹ï¼Œç„¶åæŠŠåµŒå¥—çš„å­—å…¸ä¸¢è¿›å»ç»§ç»­æ˜ å°„ã€‚</p>
<p>å…ˆçœ‹çœ‹æ€ä¹ˆè·å–å±æ€§çš„ç±»å‹ï¼š</p>
<pre><code>- (NSDictionary *)attributeMapDictionary{
    NSMutableDictionary *propertyDict = [[NSMutableDictionary alloc] init];
    unsigned int outCount = 0;
    objc_property_t *properties = class_copyPropertyList(self.class, &amp;outCount);
    for (int i = 0; i &lt; outCount; i++) {
        objc_property_t property = properties[i];
        NSString *propName = [NSString stringWithUTF8String:property_getName(property)];
        const char *typeName =property_getAttributes(property);
        NSString *properyTypeName = [[NSString alloc] initWithCString:typeName encoding:NSUTF8StringEncoding];
        [propertyDict setObject:properyTypeName forKey:propName];
    }
    return propertyDict;
}
</code></pre>
<p>æˆ‘ä»¬åœ¨åˆšæ‰è·å–å±æ€§åçš„åŸºç¡€ä¸Šæ‰©å±•ä¸€ä¸‹ï¼Œç°åœ¨æˆ‘ä»¬è·å–åˆ°äº†å±æ€§çš„åç§°å’Œç±»å‹åï¼Œç„¶åç”Ÿæˆä¸€ä¸ªç”¨å±æ€§åä¸ºKeyï¼Œå±æ€§ç±»å‹åç§°ä½œä¸ºValueçš„å­—å…¸è¿”å›ã€‚</p>
<p>ä¸è¿‡è¿™ä¸ªæ—¶å€™è¿”å›çš„ç±»å‹åç§°æ˜¯ç±»ä¼¼ï¼šT@"NSString",C,N,V_test è¿™æ ·å­è›‹ç—›çš„å½¢å¼ï¼Œæ‰€ä»¥è¿˜éœ€è¦ä¸€ä¸ªè§£æå‡½æ•°æ¥è¾…åŠ©</p>
<pre><code>- (NSString*) className:(NSString *)propertyTypeName {
    NSLog(@"%@", propertyTypeName);
    NSString* name = [[propertyTypeName componentsSeparatedByString:@","] objectAtIndex:0];
    NSString* cName = [[name substringToIndex:[name length]-1] substringFromIndex:3];
    return cName;
}
</code></pre>
<p>è¿™ä¸ªæ—¶ä¾¯æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªå¹²å‡€çš„ç±»åäº†ï¼Œä¹‹åå°±å¯ä»¥é€šè¿‡NSClassFromStringæ¥è·å¾—ç±»å¯¹è±¡ï¼Œç„¶åå®ä¾‹åŒ–è¿™ä¸ªç±»å‹å‡ºæ¥ã€‚æ•´ç†ä¸€ä¸‹ç¬¬äºŒä¸ªç‰ˆæœ¬ç±»ä¼¼ï¼š</p>
<pre><code>- (void)setAttributes:(NSDictionary *)data{
    NSDictionary *propertys = [self attributeMapDictionary];
    for (NSString *attributeName in [propertys allKeys]){
        SEL sel = [self getSetterAttributeName:attributeName];
        if ([self respondsToSelector:sel]) {
            id value = [data objectForKey:attributeName];
            if (value) {
                NSString* className = [self className:[propertys objectForKey:attributeName]];
                if ([value isKindOfClass:[NSDictionary class]]) {
                    id subObject = [[NSClassFromString(className) alloc] init:value];
                    [self performSelectorOnMainThread:sel withObject: subObject waitUntilDone:YES];
                    continue;
                }                
                [self performSelectorOnMainThread:sel withObject:value waitUntilDone:YES];
            }
        }
    }
}
</code></pre>
<p>è¿™ä¸ªæ—¶å€™åµŒå¥—çš„ç±»åªéœ€è¦å®šä¹‰å±æ€§ä¸ºï¼š</p>
<pre><code>@property (nonatomic, strong) MyClass *subObject;
</code></pre>
<p>ä½†æ˜¯å†ç»§ç»­æƒ³ä¸€ä¸‹ï¼Œå¦‚æœåµŒå¥—çš„æ˜¯æ•°ç»„å‘¢ï¼Œæ•°ç»„é‡Œå†æœ‰åµŒå¥—çš„å­—å…¸å‘¢ï¼Œè¿™ä¸ªæ—¶å€™çš„éº»çƒ¦æ˜¯éœ€è¦çŸ¥é“æ•°ç»„é‡Œçš„å¯¹è±¡æ˜¯ä»€ä¹ˆç±»å‹ï¼Œä¹Ÿå°±æ˜¯åœ¨å®šä¹‰å±æ€§çš„æ—¶å€™è¦ä¼ å…¥ä¸€ä¸ªç±»å‹çš„åç§°è¿›å»ã€‚Howï¼Ÿæœ€åè¯•äº†è¯•ï¼Œåœ¨å®šä¹‰protocalçš„æ—¶å€™è·å–åˆ°çš„åç§°ä¼šåŒ…å«protocalçš„åç§°ï¼Œæ¯”å¦‚å®šä¹‰ä¸€ä¸ªç©ºåè®®å’Œè¦åµŒå¥—è¿›å»çš„ç±»åŒåï¼š </p>
<pre><code>@protocol MyClass
@end

@interface MyClass : BaseModle
@property (nonatomic, copy) NSString* test;
@property (nonatomic, strong) NSArray&lt;MyClass&gt;* subList;
@end
</code></pre>
<p>è¿™ä¸ªæ—¶å€™è·å–åˆ°çš„ç±»å‹åç§°æ˜¯ï¼šT@"NSArray<MyClass>",C,N,V_mySelf</p>
<p>è¿™ä¸ªæ—¶å€™ä¿®æ”¹ä¸€ä¸‹è·å–ç±»å‹åç§°çš„è¾…åŠ©æ–¹æ³•å°±å¯ä»¥è·å–åˆ°åµŒå¥—çš„ç±»å‹äº†ã€‚</p>
<p>å®Œæ•´çš„å®ç°ä»£ç ï¼š</p>
<script src="https://gist.github.com/ipconfiger/8458066.js"></script>

<p>ä½¿ç”¨çš„è¯ï¼š</p>
<pre><code>#import "BaseModle.h"
@protocol mmMyObject
@end

@interface mmMyObject : BaseModle
@property (nonatomic, copy) NSString* test;
@property (nonatomic, copy) NSArray&lt;mmMyObject&gt;* mySelf;
@end
</code></pre>
<p>å…ˆå®šä¹‰ä¸€ä¸ªå­ç±»ï¼Œç„¶åï¼š</p>
<pre><code>mmMyObject *myobj = [[mmMyObject alloc] init:@{@"test": @"hahahaha", @"mySelf": @[@{@"test": @"huohuohuohuo"}]}];
mmMyObject *obj = [myobj.mySelf objectAtIndex:0];
NSLog(@"%@", obj.test);
</code></pre>
<p>å¾—åˆ°ç»“æœï¼šhuohuohuohuo</p>
<h2>å¤§åŠŸå‘Šæˆï¼ï¼ç¢å«å»ä¹Ÿ</h2>
        </div>
        
        <div class="meta">
            Posted on <a href="/2014-01-16/dynamic-object-mapping-for-json.html">2014-01-16 00:00:00</a>
        </div>
    </div>

    <div class="post">
        <h3><a href="/2014-01-12/python-multitask-fixed.html">å…³äºPythonå¹¶è¡Œä»»åŠ¡æŠ€å·§çš„å‡ ç‚¹è¡¥å®Œ</a></h3>
      
        <div class="body">
            <p>æ—©ä¸Šé€›å¾®åšå‘ç°äº†SegmentFaultä¸Šçš„è¿™ç¯‡æ–‡ç« ï¼š<a href="http://segmentfault.com/a/1190000000382873">å…³äºPythonå¹¶è¡Œä»»åŠ¡æŠ€å·§</a> ã€‚çœ‹è¿‡ä¹‹åå¤§æœ‰è£¨ç›Šã€‚é¡ºæ‰‹è¯•äº†è¯•åé‡åˆ°å‡ ä¸ªå°å‘ï¼Œè®°å½•ä¸‹æ¥ä½œä¸ºè¡¥å®Œï¼ˆä½œè€…ä¹Ÿæœ‰ç‚¹è¯­ç„‰ä¸è¯¦å“¦^_^ï¼‰ã€‚</p>
<p>ç¬¬ä¸€ç‚¹æ˜¯ä¼ å…¥çš„functionï¼Œåªèƒ½æ¥æ”¶ä¸€ä¸ªä¼ å…¥å‚æ•°ï¼Œä¸€å¼€å§‹ä»¥ä¸ºåœ¨ä¼ å…¥çš„åºåˆ—é‡Œç”¨tupleå¯ä»¥è‡ªåŠ¨è§£åŒ…æˆå¤šä¸ªå‚æ•°ä¼ è¿›å»ï¼Œå¯æƒœå®è·µåæ˜¯ä¸è¡Œçš„ï¼š</p>
<pre><code>#coding=utf8
from multiprocessing import Pool

def do_add(n1, n2):
    return n1+n2

pool = Pool(5)
print pool.map(do_add, [(1,2),(3,4),(5,6)])
pool.close()
pool.join()
</code></pre>
<p>æ‰§è¡Œåç»“æœå°±æŠ¥é”™äº†ï¼š</p>
<pre><code>Traceback (most recent call last):
  File "mt.py", line 8, in &lt;module&gt;
    print pool.map(do_add, [(1,2),(3,4),(5,6)])
  File "/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/multiprocessing/pool.py", line 250, in map
    return self.map_async(func, iterable, chunksize).get()
  File "/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/multiprocessing/pool.py", line 554, in get
    raise self._value
TypeError: do_add() takes exactly 2 arguments (1 given)
</code></pre>
<p>ç¬¬äºŒæ˜¯ä¼ å…¥çš„functionå¦‚æœè¦åšé•¿æœŸæ‰§è¡Œï¼Œæ¯”å¦‚æ”¾ä¸€ä¸ªæ­»å¾ªç¯åœ¨é‡Œé¢é•¿æœŸæ‰§è¡Œçš„è¯ï¼Œå¿…é¡»å¤„ç†å¿…è¦çš„å¼‚å¸¸ï¼Œä¸ç„¶ctrl+cæ€ä¸æ‰è¿›ç¨‹ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code>#coding=utf8
from multiprocessing import Pool
import time

def do_add(n1):
    while True:
        time.sleep(1)
        print n1

pool = Pool(5)
print pool.map(do_add, [1,2,3,4,5,6])
pool.close()
pool.join()
</code></pre>
<p>è¿™æ®µä»£ç ä¸€è·‘èµ·æ¥æ˜¯ctrl+cæ€ä¸æ‰çš„ï¼Œæœ€ååªèƒ½æŠŠconsoleæ•´ä¸ªå…³æ‰æ‰è¡Œã€‚
ä¸è¿‡è¿™ä¹ˆå†™å°±okäº†ï¼š</p>
<pre><code>#coding=utf8
from multiprocessing import Pool
import time

def do_add(n1):
    try:
        while True:
            time.sleep(1)
            print n1
    except:
        return n1

pool = Pool(5)
print pool.map(do_add, [1,2,3,4,5,6])
pool.close()
pool.join()
</code></pre>
<hr />
<p>è¡¥å®Œçš„è¡¥å®Œï¼Œæœ‰ç½‘å‹æä¾›äº†è§£å†³åŠæ³•ï¼Œä½¿ç”¨functoolsçš„partialå¯ä»¥è§£å†³ï¼Œè¯¦è§ <a href="http://stackoverflow.com/questions/5442910/python-multiprocessing-pool-map-for-multiple-arguments">çˆ†æ ˆ</a></p>
<hr />
<p>ç¬¬ä¸‰ç‚¹æ˜¯ä¸ºä»€ä¹ˆè¦åœ¨å­è¿›ç¨‹é‡Œç”¨æ­»å¾ªç¯è®©å…¶é•¿æœŸæ‰§è¡Œã€‚çªƒä»¥ä¸ºä½œè€…çš„ç›´æ¥æŠŠä¸Šåƒä¸ªä»»åŠ¡æš´åŠ›ä¸¢ç»™è¿›ç¨‹æ± çš„åšæ³•å¹¶ä¸æ˜¯æœ€é«˜æ•ˆçš„æ–¹å¼ï¼Œå³ä¾¿æ˜¯æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹æ•°å’ŒCPUæ•°èƒ½åŒ¹é…å¾—åˆ‡åˆ°å¥½å¤„ï¼Œä½†æ˜¯ä¸€å¤§å †çš„è¿›ç¨‹åˆ‡æ¢çš„å¼€é”€ä¹Ÿä¼šæœ‰ç›¸å½“çš„è´Ÿæ‹…ã€‚ä½†æ˜¯åˆ›å»ºå‡ ä¸ªé•¿æœŸè¿è¡Œçš„å·¥ä½œè¿›ç¨‹ï¼Œæ¯ä¸ªå·¥ä½œè¿›ç¨‹å¤„ç†å¤šä¸ªä»»åŠ¡ï¼Œçœç•¥æ‰äº†å¤§é‡å¼€å¯å…³é—­è¿›ç¨‹çš„å¼€é”€ï¼ŒåŸç†ä¸Šæ¥è¯´ä¼šæ•ˆç‡é«˜ä¸€äº›ã€‚ä¸è¿‡è¿™ä¸ªé—®é¢˜æˆ‘æ²¡æœ‰å®æµ‹è¿‡ã€‚å†ä¸è¿‡å…¶å®ä»åŸç†ä¸Šæ¥è¯´è¿™ä¸ªå¼€é”€è™½ç„¶æœ‰ä½†æ˜¯å¹¶ä¸æ˜¯æœ‰å¤šä¹ˆå¤§ï¼Œå¾ˆå¤šæ—¶å€™å®Œå…¨å¯ä»¥å¿½ç•¥ï¼Œæ¯”å¦‚ä½œè€…ç”¨çš„ä¾‹å­ã€‚
æ‰€ä»¥å…¶å®æ›´ç¡®åˆ‡ä¸€ç‚¹çš„éœ€æ±‚åè€Œæ˜¯ç”¨äºå®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ã€‚å› ä¸ºåœ¨ä½œè€…çš„ä¾‹å­é‡Œï¼Œä»»åŠ¡æ•°æ˜¯å›ºå®šçš„ï¼Œä¸å¯æ§çš„ï¼Œæ›´å¤šçš„æ—¶å€™æˆ‘ä»¬åè€Œæ˜¯éœ€è¦ç”¨ç”Ÿäº§è€…åˆ›å»ºä»»åŠ¡ï¼Œç”±workerè¿›ç¨‹å»æ‰§è¡Œä»»åŠ¡ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œç”Ÿäº§è€…ç›‘å¬ä¸€ä¸ªredisçš„é˜Ÿåˆ—ï¼Œæœ‰æ–°urlæ”¾è¿›å»çš„æ—¶å€™å°±é€šçŸ¥workerè¿›ç¨‹å»å–ã€‚</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>#coding=utf8
from multiprocessing import Pool, Queue
import redis
import requests

queue = Queue(20)

def consumer():
    r = redis.Redis(host='127.0.0.1',port=6379,db=1)
    while True:
        k, url = r.blpop(['pool',])
        queue.put(url)

def worker():
    while True:
        url = queue.get()
        print requests.get(url).text

def process(ptype):
    try:
        if ptype:
            consumer()
        else:
            worker()
    except:
        pass

pool = Pool(5)
print pool.map(process, [1,0,0,0,0])
pool.close()
pool.join()
</code></pre>
<p>æ¯”èµ·ç»å…¸çš„æ–¹å¼æ¥è¯´ç®€å•å¾ˆå¤šï¼Œæ•ˆç‡é«˜ï¼Œæ˜“æ‡‚ï¼Œè€Œä¸”æ²¡ä»€ä¹ˆæ­»é”çš„é™·é˜±ã€‚</p>
        </div>
        
        <div class="meta">
            Posted on <a href="/2014-01-12/python-multitask-fixed.html">2014-01-12 00:00:00</a>
        </div>
    </div>

    <div class="post">
        <h3><a href="/2013-11-05/speedup-gunicorn-and-restart-gracefully.html">ç”¨meinheldåŠ é€Ÿgunicornä¸ä¼˜é›…çš„é‡å¯gunicornçš„worker</a></h3>
      
        <div class="body">
            <p>åºŸè¯ä¸ç”¨å¤šè¯´ï¼Œå¼‚æ­¥çš„workerå°±æ˜¯å¿«ï¼Œä¸è¦é—®ä¸ºä»€ä¹ˆï¼Œgunicornæ”¯æŒçš„å¤šç§workerï¼Œç»è¿‡æµ‹è¯•meinheldè¶…çº§å¿«ï¼Œç½‘ä¸Šæ‰’çš„æµ‹è¯•ç»“æœï¼Œè§å›¾ï¼š
<img alt="image" src="http://www.360ito.com/misc/photo/13.jpg" />
æ²¡æ—¶é—´è‡ªå·±æµ‹äº†ï¼Œæœ‰ç©ºçš„è‡ªå·±æµ‹è¯•å§ï¼Œä¸‹é¢ç”¨æœ€ç®€æ´çš„æ­¥éª¤æ¥å®ç°ç”¨meinheldåŠ é€Ÿgunicornã€‚</p>
<p>step1:</p>
<pre><code>#pip install meinheld
</code></pre>
<p>step2:
ä¿®æ”¹supervisorçš„é…ç½®ï¼Œæ·»åŠ </p>
<pre><code>--worker-class="egg:meinheld#gunicorn_workerâ€
</code></pre>
<p>è¿™ä¸ªå‚æ•°ã€‚</p>
<p>é‡å¯ï¼Œæå®š</p>
<p>gunicornè¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯æŒ‰ç…§å®˜ç½‘çš„æ–‡æ¡£ç”¨supervisoræ¥ç®¡ç†åï¼Œä¸€æ—¦é‡å¯å°±ä¼šç­‰å¾ˆé•¿æ—¶é—´æ¥è®©mastorè¿›ç¨‹å»bootå­è¿›ç¨‹ã€‚å®˜ç½‘æ–‡æ¡£è¿˜è¯´äº†å¯ä»¥é€šè¿‡å‘é€sighubç»™mastorè¿›ç¨‹å¯ä»¥â€œä¼˜é›…â€çš„é‡å¯å­è¿›ç¨‹ï¼š<a href="http://docs.gunicorn.org/en/latest/signals.html">ä»»æ„é—¨</a></p>
<p>æ‰€ä»¥å…³é”®æ­¥éª¤å°±æ˜¯å‘é€SIGHUPä¿¡å·ç»™mastorè¿›ç¨‹å°±å¯ä»¥äº†ã€‚</p>
<pre><code>#!/bin/bash
if [ x$1 == x ]; then
   echo 'which app?'
   exit 1;
fi
pid=`ps -ef|grep $1|awk '{ print $3 }'|uniq -c|sort -k1,1nr|head -1|awk '{ print $2 }'`
rs=`kill -1 -$pid`
pc=`ps aux|grep $1|wc -l`
if [ $pc &gt; 1 ]; then
    echo 'restart done'
    exit 0;
else
    echo 'Error!Not start'
fi
</code></pre>
<p>ä¿å­˜ä¸º restart.sh,chmod +x restart.sh  ,æœ€åå¦‚æœä½ çš„gunicornæ˜¯è¿™æ ·å¯åŠ¨çš„ï¼š</p>
<pre><code>/usr/bin/gunicorn -w 8 -b 0.0.0.0:8000 --worker-class=egg:meinheld#gunicorn_worker app:app
</code></pre>
<p>å°±åªéœ€è¦   ./restart.sh app:app  å°±å¯ä»¥äº†</p>
<p>ps bash shell ä¸è¯†åˆ« -SIGHUPæ‰€ä»¥ä¼šæŠ¥é”™ kill -l æ‰¾åˆ°å¯¹åº”çš„ä¿¡å·ç¼–å·ï¼Œæ¢æˆ kill -1 å°±å¥½äº†</p>
<p>ç¥ç©å¾—å¼€å¿ƒ</p>
        </div>
        
        <div class="meta">
            Posted on <a href="/2013-11-05/speedup-gunicorn-and-restart-gracefully.html">2013-11-05 00:00:00</a>
        </div>
    </div>

    <div class="post">
        <h3><a href="/2013-10-21/appletv3play.html">Apple TV3ä¸å®Œå…¨è¯•ç©æ‰‹å†Œ</a></h3>
      
        <div class="body">
            <h3>å…ˆæ¥åä¸ªæ§½</h3>
<p>å…¥æ‰‹Apple TV3æ˜¯ä¸ªå¾ˆå¶ç„¶çš„æœºä¼šï¼Œä¹‹å‰ä¸€ç›´æƒ³å…¥æ‰‹ä¸€ä¸ªå¯ä»¥åœ¨ç”µè§†ä¸Šæ”¾ç½‘ç»œç”µå½±çš„ä¸œè¥¿ï¼Œæ‰€ä»¥è¯•è¿‡å¾ˆå¤šä¸åŒå¥‡è‘©çš„äº§å“ã€‚æœ€æ—©æ˜¯ç¾å¦‚ç”»çš„SDå¡æ’­æ”¾å™¨ï¼Œè¿™è´§éœ€è¦è‡ªå·±ä¸‹è½½ï¼Œä¼ SDå¡ä¸Šï¼Œç„¶åæ’ç”µè§†ï¼Œæ‰€ä»¥ç”¨èµ·æ¥éå¸¸ä¸æ–¹ä¾¿ï¼Œæ‰€ä»¥ç”¨äº†æ²¡å¤šä¹…å°±æŸä¹‹é«˜é˜äº†ã€‚åæ¥æœ‰ä¸ªå¯ä»¥è¿è¡Œå®‰å“ç³»ç»Ÿçš„å¥‡è‘©é«˜æ¸…æ’­æ”¾å™¨ï¼Œå½“æ—¶700å¤šï¼Œç‰‡æºå¾ˆå¥‡è‘©ï¼Œæ“ä½œå¾ˆå¥‡è‘©ï¼Œè¯´æ˜¯å®‰å“ç³»ç»Ÿç»“æœå•¥APPéƒ½è£…ä¸äº†ã€‚æœ€åæŠ˜ä»·å¤„ç†æ‰äº†ã€‚åæ¥å‡ºç°äº†MK802è¿™ç±»å®‰å“æ£’å­ï¼Œé‚å…¥äº†ä¸€ä¸ªï¼Œä¾¿å®œå€’æ˜¯ä¾¿å®œï¼Œä¸è¿‡éœ€è¦å¤–æ¥ä¸€ä¸ªæ— çº¿é¼ æ ‡ï¼Œç”¨èµ·æ¥å“åº”é€Ÿåº¦è¿˜æ˜¯ä¸é”™ï¼Œè¿˜èƒ½ç©ç©æ„¤æ€’çš„å°é¸Ÿï¼Œåˆ‡åˆ‡æ°´æœä»€ä¹ˆçš„ï¼Œä¸è¿‡åœ¨æ²™å‘ä¸Šç”¨æ— çº¿é¼ æ ‡å¾ˆæ˜¯åˆ«æ‰­ã€‚ä¸è¿‡åå¾—ä¹Ÿå¿«ï¼Œç”¨äº†1ä¸ªå¤šæœˆå°±åæ‰äº†ï¼Œä¸€ç›´åœç•™åœ¨å¼€æœºçŠ¶æ€å†ä¹Ÿè¿›ä¸åˆ°ç³»ç»Ÿäº†ã€‚ä¹‹åæœ‰äº†æ ‘è“æ´¾ï¼Œç”±äºCPUå¾ˆæŒ«ï¼Œæ‰€ä»¥XMBCè·‘èµ·æ¥ç›¸å½“çš„å¡ï¼Œè€Œä¸”XMBCåˆä¸èƒ½è°ƒç”¨omxplayerå»ç‰›é€¼è½°è½°çš„ç©ç¡¬è§£ç 1080pé«˜æ¸…è§†é¢‘ï¼Œå› ä¸ºomxplayeræ”¯æŒm3u8æ ¼å¼çš„HFSæµæ’­æ”¾æ–¹æ¡ˆï¼Œç„¶åæˆ‘å°±è¯•å›¾è‡ªå·±ç”¨ç™¾åº¦ç½‘ç›˜çš„APIæ¥å£è·å–è½¬ç æ¥å£å¾—åˆ°çš„m3u8æ–‡ä»¶é€šè¿‡omxplayeræ¥æ’­æ”¾ã€‚ç»“æœå¾ˆå®¹æ˜“å‡ºç°éŸ³ç”»ä¸åŒæ­¥çš„æƒ…å†µã€‚å°ç±³ç›’å­ï¼Œä½ æŠ¢å¾—åˆ°ä¹ˆï¼ŸæŠ¢åˆ°ç›’å­çš„é»„ç‰›ååœ°èµ·ä»·è¦åŠ 400å¤šï¼Œäººäº‰ä¸€å£æ°”ä½›äº‰ä¸€ç‚·é¦™ä¸ä¹°ä¹Ÿç½¢ã€‚ç™¾åº¦å½±æ£’ï¼Ÿè¿˜ä¼šé æŠ¢è´­çš„è´§ï¼Œè¿˜åªèƒ½ç”¨ç™¾åº¦è‡ªå®¶çš„ç‰‡æºã€‚ä¸”å„å¼å„æ ·çš„å®‰å“ç›’å­æ£’å­ä»€ä¹ˆçš„å¹¶ä¸èƒ½è‰¯å¥½çš„æ”¯æŒAirplayï¼Œæ‰€ä»¥å¹²è„†ä¸çœ‹ä¹Ÿä¸æƒ³ï¼Œæœæ–­çš„Apple TV3äº†ã€‚</p>
<p>æœ‰ç©ºçš„æ—¶å€™ä¼šé›†å…¶æ‰€æœ‰çš„ç›’å­æ£’å­åšä¸ªæ¨ªå‘å¯¹æ¯”ï¼Œç„¶åå¬å”¤ç¥é¾™â€¦â€¦
å¦‚æœæœ‰å¥½å¿ƒäººå€Ÿæˆ‘æ–°å°ç±³ç›’å­ï¼ˆæŠ¢ä¸åˆ°ï¼‰ï¼Œç™¾åº¦å½±æ£’ï¼ˆè¿˜æ˜¯æŠ¢ä¸åˆ°ï¼‰ï¼Œé˜¿é‡Œæ£’å­ï¼ˆè¿˜æ²¡å‡º)â€¦ çš„è¯</p>
<h3>ç¬¬ä¸€çœ¼å°è±¡</h3>
<p>ä¸‹é¢ç»“æŸå„ç§åæ§½è¿›å…¥æ­£é¢˜ï¼Œæˆ‘ä»¬æ¥è°ˆè°ˆApple TV3.ï¼ˆä»¥ä¸‹å°†ç”¨ATV3æ¥è¡¨ç¤ºï¼‰</p>
<p><img alt="image" src="http://www.techgradergeek.com/wp-content/uploads/2012/10/Apple-TV-3.png" /></p>
<p>å…ˆä»å¤–è§‚å…¥æ‰‹ï¼Œé¦–å…ˆä¸€ä¸ªæ¼‚äº®çš„å¤–è§‚æ˜¯éå¸¸é‡è¦çš„ï¼Œå¦‚æœæŠŠATV3å’Œå…¶ä»–çš„ç›’å­æ£’å­æ”¾åœ¨ä¸€èµ·å°±å¦‚åŒåœ¨åœæ»¡å¤§ä¼—çš„åœè½¦åœºé‡Œçªç„¶å¼€è¿›æ¥ä¸€è¾†é©¬è¨æ‹‰è’‚ã€‚æœ‰ä¸€ä¸ªè‘—åçš„ç†è®ºå°±æ˜¯å¦‚æœçœ‹èµ·æ¥æ¼‚äº®çš„é£æœºï¼Œä¸€å®šæ˜¯å¥½é£æœºï¼Œçªƒä»¥ä¸ºåŒæ ·çš„ç†è®ºä¸€æ ·å¯ä»¥ç”¨äºç›’å­ç•Œã€‚å¦‚æœéƒ½åˆ†ä¸å‡ºç²¾åŠ›æ¥æä¸ªæ¼‚äº®çš„å£³å­ï¼Œå¤šåŠæ˜¯å› ä¸ºè¿åŸºæœ¬åŠŸèƒ½éƒ½è¿˜æ²¡è°ƒè¯•å¦¥å½“å°±æ‹¿å‡ºæ¥é”€å”®äº†â€¦</p>
<p>æ¥å£ä»€ä¹ˆçš„å°±ä¸ç”¨å¤šè¯´äº†ï¼ŒHDMIï¼Œç½‘çº¿ï¼ˆç”±äºå®¶é‡Œwifiä¸ç»™åŠ›å°±æ’äº†è·Ÿç½‘çº¿ï¼Œå›å¤´ç”¨Time Capsuleæ¥æ›¿æ¢äº†ï¼‰ï¼Œæ’ä¸Šç”µæºï¼ŒæŠŠç”µè§†è¾“å…¥æºåˆ‡æ¢åˆ°HDMIï¼Œç„¶åå“’å“’~~~~</p>
<p><img alt="image" src="http://ww1.sinaimg.cn/large/578b198bgw1e9tcf54y0tj20jz0dajtp.jpg" /></p>
<p>å…¶å®ç»è¿‡å®æµ‹itunesä¸Šçš„å½±ç‰‡æ˜¯å¯ä»¥æ’­æ”¾çš„ï¼Œæ²¡æœ‰è¢«å¢™ï¼Œä½†æ˜¯æ…¢æ˜¯æ…¢å¾—å¯ä»¥ï¼Œä½ è¦æ˜¯èƒ½ç­‰çš„è¯ï¼Œè¿˜æ˜¯èƒ½ç”¨ï¼Œå¦ç»è¿‡æµ‹è¯•é‡Œé¢çš„ç”µå°åŠŸèƒ½æ˜¯å¯ä»¥ç”¨çš„ï¼Œå¾ˆæµç•…ã€‚æ“ä½œä¸Šé€šè¿‡remoteæ¥æ§åˆ¶éå¸¸çš„æµç•…ï¼Œæ¯«æ— è¿å’Œæ„Ÿï¼Œç”±äºæ‰‹é‡Œæ²¡æœ‰å°ç±³ç›’å­æ— æ³•å¯¹æ¯”ï¼Œä»¥åæœ‰æœºä¼šå†æ¥ã€‚</p>
<p>éœ€è¦æµç•…åº¦çš„çœ‹ç‰‡ï¼Œæˆ‘ä»¬åªèƒ½è¿™ä¹ˆå¹²ï¼š</p>
<h3>DNSåŠ«æŒå¯ä»¥ç ´</h3>
<p>DNSåŠ«æŒè¿™å›äº‹ï¼Œå…¶å®æ˜¯ç”¨ä¸€ä¸ªDNSä»£ç†å°†ATV3çš„é¢„å‘Šç‰‡é¢‘é“çš„è¯·æ±‚é€šè¿‡DNSä»£ç†å±‚æ¬¡åŠ«æŒåˆ°æŒ‡å®šçš„æœåŠ¡å™¨ä¸Šï¼ŒæœåŠ¡å™¨å†’åé¡¶æ›¿äº†é¢„å‘Šç‰‡é¢‘é“çš„å†…å®¹ï¼Œç”¨æœç‹ï¼Œä¼˜é…·ï¼Œè¿…é›·ç­‰ç‰‡æºçš„å†…å®¹æ›¿ä»£äº†é¢„å‘Šç‰‡é¢‘é“å†…éƒ¨çš„å†…å®¹ã€‚</p>
<p>æ–°æµªå¾®åšä¸Šçš„@ç›’å­å¤§å¸ˆ æä¾›äº†å›½å†…å¾ˆå¤šç‰‡æºçš„DNSåŠ«æŒæœåŠ¡</p>
<p>å…·ä½“å®æ–½è¿‡ç¨‹å¦‚ä¸‹ï¼š
<img alt="image" src="http://ww3.sinaimg.cn/large/578b198bgw1e9tcz12f6jj20ja0cr75r.jpg" /></p>
<p><img alt="image" src="http://ww1.sinaimg.cn/large/578b198bgw1e9td6uaua4j20ji0bjq3q.jpg" /></p>
<p><img alt="image" src="http://ww4.sinaimg.cn/large/578b198bgw1e9td8g3xa0j20jl0c1jsf.jpg" /></p>
<p><img alt="image" src="http://ww4.sinaimg.cn/large/578b198bgw1e9td9xri7rj20jq0b2aay.jpg" /></p>
<p><img alt="image" src="http://ww3.sinaimg.cn/large/578b198bgw1e9tdbbm7n5j20jx0cpt9u.jpg" /></p>
<p><img alt="image" src="http://ww1.sinaimg.cn/large/578b198bgw1e9tdedn2i8j20k30dujsq.jpg" /></p>
<p><img alt="image" src="http://ww2.sinaimg.cn/large/578b198bgw1e9tdfmzj3pj20je0bv3zk.jpg" /></p>
<p>è®¾ä¸ºè¿™ä¸ªå€¼åä¸€è·¯ç‚¹Remoteï¼Œä¹Ÿå°±æ˜¯é¥æ§å™¨ä¸Šçš„Menué”®å›åˆ°é¦–é¡µï¼Œç‚¹å‡»é¢„å‘Šç‰‡ï¼š</p>
<p><img alt="image" src="http://ww4.sinaimg.cn/large/578b198bgw1e9tdhq1uusj20ju0eq76g.jpg" /></p>
<h3>ä¸–ç•Œå°†ä¸ºä½ æ‰“å¼€</h3>
<p><img alt="image" src="http://ww3.sinaimg.cn/large/578b198bgw1e9tdj34p8wj20kf0ecgob.jpg" /></p>
<p>å»æœç‹çœ‹çœ‹ç¾å‰§ï¼š
<img alt="image" src="http://ww1.sinaimg.cn/large/578b198bgw1e9tdknyvkqj20k10ecmyi.jpg" /></p>
<p><img alt="image" src="http://ww1.sinaimg.cn/large/578b198bgw1e9tdlytd8mj20k90djta9.jpg" /></p>
<p>Airplayå°±ä¸ä¸Šå›¾äº†ï¼Œä¸Šå›¾ä¹Ÿçœ‹ä¸å‡ºåŒºåˆ«ï¼Œè‡ªå®¶äº§å“ç”¨èµ·æ¥è¶…çº§ç®€å•ï¼Œç¨³å®šã€‚</p>
<p>å¾ˆå¤šå®‰å“ç›’å­ã€æ£’å­éƒ½è¯´è‡ªå·±æ”¯æŒAirplayï¼Œç»“æœå®é™…ä½¿ç”¨èµ·æ¥åªèƒ½è¯´æ˜¯ä¸€å¡Œç³Šæ¶‚ï¼Œä¼°è®¡éƒ½æ˜¯ç”¨äº†åŒä¸€ä¸ªå¼€æºé¡¹ç›®çš„ä»£ç è€Œå·²ã€‚xmbcçš„AirplayéŸ³é¢‘å°šå¯ï¼Œè§†é¢‘æ˜¯è¿ä¸Šä¸€æ¬¡æ–­å¼€åç¬¬äºŒæ¬¡æ­»æ´»æœç´¢ä¸åˆ°è®¾å¤‡ï¼Œä¹Ÿæ˜¯å®Œå…¨ä¸å…·å¤‡å¯ç”¨æ€§ã€‚</p>
<p>å¤§éƒ¨åˆ†æ‰§ç€äºå®‰å“ç›’å­æˆ–è€…æ ‘è“æ´¾çš„äººæœ€åç»™å‡ºçš„è¯´æ³•æ˜¯è¦çœ‹ç§»åŠ¨ç¡¬ç›˜ä¸‹è½½ä¸‹æ¥çš„ï¼Œè¿™ä¸ªéšä¾¿ä¸€ä¸ªç¡¬ç›˜ç›’å­æ’­æ”¾å™¨å°±èƒ½æå®šçš„äº‹æƒ…ï¼Œè‡³äºè¿™ä¹ˆå…´å¸ˆåŠ¨ä¼—ä¹ˆ</p>
<h3>å¼€å‘è€…çš„ç¦åˆ©</h3>
<p>å¯¹äºè‡ªå·±æœ‰å¼€å‘èƒ½åŠ›çš„åŒå­¦æ¥è¯´ï¼Œ@ç›’å­å¤§å¸ˆ ç•™ä¸‹çš„ä¸ªäººé“¾æ¥çš„å£æ˜¯ä¸€ä¸ªå¾ˆæ–¹ä¾¿çš„é€”å¾„è®©ATVå¯ä»¥æ’­æ”¾è‡ªå·±çš„ç‰‡æºï¼ŒNASçš„ä¹Ÿå¥½ï¼Œæˆ–è€…ç™¾åº¦ç½‘ç›˜ä¸Šçš„å½±ç‰‡ã€‚</p>
<p>ç™¾åº¦ç½‘ç›˜æ˜¯ä¸ªä¸é”™çš„ä¸»æ„ï¼Œå¾ˆé€‚åˆå½±ç‰‡çš„åˆ†äº«ï¼Œè€Œä¸”ä¸Šé¢çš„ç‰‡å­éƒ½æ¯”è¾ƒæ–°ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•åœ¨ATVä¸Šæ’­æ”¾ç½‘ç›˜é‡Œçš„å½±ç‰‡ã€‚</p>
<p>é¦–å…ˆï¼Œå¦‚æœæƒ³åˆ›å»ºä¸ªäººé“¾æ¥ï¼Œä½ å¿…é¡»å…ˆæ³¨å†ŒDNSçš„å¸å·ã€‚åœ¨è¿™ä¸ªåœ°æ–¹</p>
<p>å¯†ç ç”¨ä½ æƒ³è¦æ³¨å†Œçš„å¯†ç ï¼Œå› ä¸ºç™»å½•ä¸æˆåŠŸåå°±ä¼šè®©ä½ å†è¾“å…¥ä¸€æ¬¡åˆšæ‰çš„å¯†ç ï¼Œç„¶åå°±ç”¨ä½ ä¹‹å‰å¡«çš„ç”¨æˆ·åå¯†ç æ³¨å†Œäº†ã€‚</p>
<p>æ³¨å†Œååœ¨ç”µè„‘ä¸Šæ‰“å¼€æµè§ˆå™¨è¿›å…¥  http://www.atvttvv.net/  ç„¶åç”¨åˆšæ‰æ³¨å†Œçš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•ã€‚</p>
<p>å…ˆæ— è§†æ‰é‚£ä¸ªè¶…çº§ç®€é™‹çš„ç•Œé¢ï¼Œæ®è¯´@ç›’å­å¤§å¸ˆ åœ¨åšæ–°ç‰ˆï¼Œä¹Ÿè®¸åˆ°æ—¶å€™ä¼šå®Œå–„ç•Œé¢åŠŸèƒ½ä»€ä¹ˆçš„ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥å»å…ˆå‡†å¤‡æ’­æ”¾çš„é“¾æ¥äº†ã€‚</p>
<p>ç”±äºç”¨ç™¾åº¦ç½‘ç›˜çš„ç‰‡æºï¼Œæˆ‘ä¸æ‰“ç®—ç”¨æ¯”è¾ƒæç«¯çš„hackçš„æ–¹å¼æ¥è·å–æ’­æ”¾åœ°å€ï¼Œè€Œæ˜¯é€šè¿‡ç™¾åº¦å¼€æ”¾APIçš„æ¥å£ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªè§†é¢‘è½¬ç çš„æ¥å£å¾ˆæ˜¯é”€é­‚ï¼Œå¯ä»¥æŒ‡å®šæ¸…æ™°åº¦è½¬æ¢è¾“å‡ºå¯¹åº”çš„mp4æ ¼å¼çš„å½±ç‰‡ã€‚ç»è¿‡å®é™…è°ƒç”¨å‘ç°ï¼Œç”±äºç™¾åº¦é‡‡ç”¨äº†åˆ†å¸ƒå¼çš„è½¬ç æŠ€æœ¯ï¼Œæ‰€ä»¥å…¶å®è¿”å›çš„æ˜¯å·²ç»è½¬ç å®Œæˆç‰‡æ®µçš„m3u8æ–‡ä»¶ã€‚ä½†æ˜¯ç”±äºè½¬ç é€Ÿåº¦çš„é—®é¢˜ä»éœ€è¦å¤§æ¦‚å¥½å‡ åˆ†é’Ÿæ‰èƒ½è½¬ç å®Œæ¯•ï¼Œä½†æ˜¯æœ‰ä¸ä¼šé€šçŸ¥ä½ è½¬ç å®Œæ¯•äº†ï¼Œæ‰€ä»¥åªèƒ½ä¸åœçš„è°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œç›´åˆ°æœ€åè·å–çš„m3u8æ–‡ä»¶çš„å¤§å°ä¸å†å˜åŒ–ä¸ºæ­¢ã€‚</p>
<h4>é¦–å…ˆæˆ‘ä»¬è¦ç™»å½•ç™¾åº¦å¸å·è·å–åˆ°token</h4>
<h1>æ³¨æ„ï¼Œä¸‹é¢å†…å®¹å› ä¸ºç™¾åº¦äº‘çš„äº‘è½¬ç æ¥å£ä¸ç¨³å®šï¼Œå¾…ç¨³å®šåå†è¡¥ä¸Š</h1>
        </div>
        
        <div class="meta">
            Posted on <a href="/2013-10-21/appletv3play.html">2013-10-21 00:00:00</a>
        </div>
    </div>

    <div class="post">
        <h3><a href="/2013-08-08/torcast.html">åŸºäºRediså®ç°å¤šä¸ªtornadoè¿›ç¨‹é—´æ¶ˆæ¯é€šä¿¡</a></h3>
      
        <div class="body">
            <p>è¯´å®è¯æ‡’äº†å¾ˆä¹…æ²¡å†™è¿‡ä¸œè¥¿äº†ï¼Œé‡å¤´å†™èµ·æ¥ä¸»è¦æ˜¯ä¸ºäº†å¤‡å¿˜</p>
<hr />
<p>tornadoæ˜¯ä¸€ä¸ªåœ¨è¿›ç¨‹å†…å•çº¿ç¨‹è¿è¡Œçš„webæœåŠ¡æ¡†æ¶ï¼Œè™½ç„¶æ˜¯å•çº¿ç¨‹ä½†æ˜¯å†…éƒ¨çš„IOéƒ½é‡‡ç”¨çš„éé˜»å¡å¼çš„è®¾è®¡ï¼Œæ‰€ä»¥è·‘èµ·æ¥é€Ÿåº¦æ˜¯æ æ çš„ã€‚å•è¿›ç¨‹ç©ºè½½çš„qpså¯ä»¥è¾¾åˆ°3500/sï¼ˆå®˜ç½‘æ•°æ®ï¼‰ã€‚ä½†æ˜¯å¥½æ±‰æ‰›ä¸è¿‡äººå¤šï¼Œæ‰€ä»¥å¤§å¤šæ•°æ—¶å€™æ˜¯éœ€è¦å¤šä¸ªè¿›ç¨‹ä¸€èµ·å·¥ä½œæ¥æ¨ªå‘æ‰©å±•å¤„ç†èƒ½åŠ›ï¼Œæœ‰å¾—æ—¶å€™ç”šè‡³éœ€è¦å¤šå°æœåŠ¡å™¨ä¸€èµ·æ¥ï¼Œè¿™ä¸ªæ—¶å€™å‰ç«¯ä¼šæœ‰ä¸ªåå‘ä»£ç†æ¥æŠŠæ‰€æœ‰çš„è¿›ç¨‹çš„è¯·æ±‚ç®¡ç†èµ·æ¥ï¼Œæ¯”å¦‚nginxï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™åŸºäºlongpullingçš„ä¸€äº›åº”ç”¨å°±è·‘ä¸èµ·æ¥äº†ï¼Œæ¯”å¦‚tornadoè‡ªå¸¦çš„é‚£ä¸ªchatroomçš„ä¾‹å­ã€‚Tornadoè‡ªèº«æ²¡æœ‰å®ç°httpåè®®ä»¥å¤–çš„å¼‚æ­¥IOï¼Œä½†æ˜¯æä¾›äº†IOStreamå¯ä¾›æˆ‘ä»¬æ¥æ‰©å±•ï¼Œæ‰€ä»¥ç”¨IOStreamå’Œå¤–éƒ¨çš„æ¶ˆæ¯åˆ†å‘çš„è¿›ç¨‹å¼‚æ­¥é€šä¿¡å°±èƒ½è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨Redisæ¥å®ç°æ¶ˆæ¯åˆ†å‘ã€‚
redisæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„å†…å­˜KVæ•°æ®åº“ï¼ŒåŒæ—¶ä¹Ÿå…·å¤‡ç®€å•é«˜æ•ˆçš„pubsubçš„èƒ½åŠ›ï¼Œè€Œä¸”é€šä¿¡åè®®ç›¸å½“çš„ç®€æ´é«˜æ•ˆæ–¹ä¾¿å®ç°ã€‚redisçš„python clientæ˜¯é˜»å¡çš„ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä¼šç”¨IOStreamå®ç°redisé€šä¿¡åè®®Publishå’ŒSubscribeè¿™ä¸€éƒ¨åˆ†ã€‚
é¦–å…ˆæ¥çœ‹IOStreamï¼ŒIOStreamæ˜¯å¯¹socketçš„å¼‚æ­¥å°è£…ï¼Œç„¶åå°†socketäº‹ä»¶æ³¨å†Œåˆ°IOLoopä¸­ï¼Œè¿™æ ·ç”±Tornadoçš„äº‹ä»¶ä¸»å¾ªç¯æ¥æ§åˆ¶socketçš„å¼‚æ­¥äº‹ä»¶è€Œä¸éœ€è¦å¼€å¯æ–°çš„çº¿ç¨‹ä»è€Œèº²å¼€GILçš„å¢™ã€‚ä½¿ç”¨ä¸ŠIOStreamå¾ˆç®€å•ï¼ŒæŠŠä¸€ä¸ªsocketæ”¾è¿›å»å°±å¥½äº†ã€‚</p>
<div class="highlight"><pre><span class="n">sock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="w"> </span><span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tornado</span><span class="o">.</span><span class="n">iostream</span><span class="o">.</span><span class="n">IOStream</span><span class="p">(</span><span class="n">sock</span><span class="p">)</span><span class="w"></span>
<span class="n">stream</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span><span class="w"> </span><span class="n">port</span><span class="p">))</span><span class="w"></span>
</pre></div>

<p>è¿™æ ·å­ä¸€ä¸ªåŒ…è£…è¿‡çš„socketå°±å¯ç”¨äº†ã€‚
IOStreamæœ‰å‡ ä¸ªéé˜»å¡è¯»çš„æ–¹æ³•å°è£…ï¼ŒåŒ…æ‹¬</p>
<ol>
<li>read_until</li>
<li>read_bytes</li>
<li>read_until_close</li>
</ol>
<p>è¿™ä¸‰ä¸ªæ–¹æ³•éƒ½éœ€è¦è®¾å®šä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚read_untilæ˜¯è®¾å®šä¸€ä¸ªé—´éš”ç¬¦å·ï¼Œç›´åˆ°è¯»åˆ°è¿™ä¸ªé—´éš”ç¬¦å·å°±æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚read_bytesæ˜¯è¯»å–è®¾å®šé•¿åº¦çš„byteï¼Œè¯»æ»¡å°±æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚read_until_closeæ˜¯ç¼“å†²æ‰€æœ‰æ•°æ®ï¼Œç›´åˆ°é“¾æ¥å…³é—­å†æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚</p>
<p>IOStreamçš„è¯»å†™çš„æ–¹æ³•éƒ½æ˜¯éé˜»å¡çš„ï¼Œæ‰€ä»¥ç­‰å¾…æ•°æ®åˆ°è¾¾çš„æ–¹å¼æ˜¯è¿™æ ·å­çš„ï¼ˆä»¥åŸºäºæ–‡æœ¬è¡Œçš„åè®®ä¸ºä¾‹å­ï¼‰ï¼š</p>
<div class="highlight"><pre><span class="k">def</span><span class="w"> </span><span class="nf">recive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span><span class="w"></span>
<span class="w">    </span><span class="k">def</span><span class="w"> </span><span class="nf">on_line</span><span class="p">(</span><span class="n">data</span><span class="p">):</span><span class="w"></span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">when_line</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="w"></span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">recive</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">read_until</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">on_line</span><span class="p">)</span><span class="w"></span>
</pre></div>

<p>ç”±äºTornadoçš„IOLoopä¸€æ—¦startèµ·æ¥å°±æ˜¯ä¸ªæ­»å¾ªç¯ï¼Œæ‰€ä»¥è¿™äº›ä¸€å®šè¦æ”¾åœ¨åœ¨startæ‰§è¡Œå‰ï¼Œåœ¨startä¹‹åçš„ä»£ç éƒ½æ²¡æœ‰æ‰§è¡Œçš„æœºä¼šäº†ã€‚</p>
<p>ç„¶åå°±æ˜¯ç”¨IOStreamæ¥å®ç°Redisçš„é€šä¿¡åè®®äº†ï¼Œä¸å¾—ä¸è¯´è¿™ä¸ªåè®®çœŸæ˜¯ç®€æ´é«˜æ•ˆåˆ°å¯æ€•ï¼Œå¦‚æœä¸éœ€è¦å®ç°redisçš„æ‰€æœ‰å‘½ä»¤çš„è¯å…¶å®æˆ‘ä»¬åªéœ€è¦å¾ˆå°‘çš„ä»£ç å°±èƒ½å®ç°ã€‚redisçš„é€šä¿¡åè®®å‚è§ <a href="http://redis.io/topics/protocol">å®˜æ–¹æ–‡æ¡£</a> <a href="http://redis.cn/topics/protocol.html">ä¸­æ–‡ç¿»è¯‘ç‰ˆ</a></p>
<p>é€šè¿‡åè®®è§„èŒƒå¯çŸ¥å…¶å®ç®€å•çš„æ¥çœ‹å¯ä»¥æŠŠredisçš„é€šä¿¡äº¤äº’å½“æˆæ˜¯åŸºäºæ–‡æœ¬è¡Œçš„åè®®æ¥å¯¹å¾…ï¼Œå½“ç„¶å¦‚æœæƒ³é«˜æ•ˆç‡çš„äº¤äº’å¤§é‡çš„æ•°æ®è¿˜æ˜¯å¯ä»¥ç”¨å¤´+bodyçš„æ–¹å¼é€šè¿‡read_bytesæ¥è¯»å–å¤§é‡å†…å®¹çš„éƒ¨åˆ†ã€‚ç”±äºåªèŠ±äº†ä¸€å¤©æ¥å®ç°æ‰€æœ‰çš„åŠŸèƒ½åŒ…æ‹¬demoï¼Œæ‰€ä»¥æˆ‘ç›´æ¥ç”¨æ–‡æœ¬è¡Œçš„æ–¹å¼æ¥å¤„ç†ï¼Œå¹¶ä¸”å¿½ç•¥äº†messageä»¥å¤–çš„æ‰€æœ‰è¿”å›æ•°æ®ã€‚</p>
<p>Redisæ•°æ®åº“è¿æ¥ä¸Šäº†åéœ€è¦select dbï¼Œå’Œsubscribeè¿™ä¸¤ä¸ªå¿…è¦çš„æ“ä½œæ‰èƒ½å¼€å§‹ç­‰å¾…æ¶ˆæ¯åˆ°æ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆå°è£…Redisçš„å‘½ä»¤ã€‚</p>
<div class="highlight"><pre><span class="k">def</span><span class="w"> </span><span class="nf">parseCommand</span><span class="p">(</span><span class="o">*</span><span class="n">argv</span><span class="p">):</span><span class="w"></span>
<span class="w">    </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="s">&quot;*&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">argv</span><span class="p">)),</span><span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">]]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">[[</span><span class="s">&quot;$&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)),</span><span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">argv</span><span class="p">)]</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="n">i1</span><span class="p">,</span><span class="n">i2</span><span class="p">:</span><span class="n">i1</span><span class="o">+</span><span class="n">i2</span><span class="w"> </span><span class="p">,</span><span class="n">output</span><span class="p">))</span><span class="w"></span>
</pre></div>

<p>ç”±äºredisçš„åè®®å°†å‘½ä»¤å’Œå‚æ•°éƒ½ä¸€è§†åŒä»ï¼Œæ‰€ä»¥å¤„ç†èµ·æ¥æ˜¯ç›¸å½“çš„ç®€å•ï¼Œä¸Šé¢çš„3è¡Œä»£ç åŸºæœ¬ä¸Šå°±å¯ä»¥è¾“å‡ºæ‰€æœ‰çš„Rediså‘½ä»¤äº†ã€‚</p>
<p>æœ€åæ˜¯è§£æredisçš„è¿”å›å€¼äº†ã€‚æ ¹æ®redisçš„åè®®ï¼Œå¤šè¡Œè¿”å›æ˜¯<em>å¼€å¤´ï¼Œæ‰€ä»¥è¯»å–åˆ° </em>å°±è®¤ä¸ºæ˜¯æœ‰æ¶ˆæ¯æ¥äº†ï¼Œ *åé¢è·Ÿçš„æ˜¯è¿”å›çš„æ¡æ•°ï¼Œè€Œæ¯æ¡éƒ½æœ‰ä¸€ä¸ªæ ‡æ˜è‡ªå·±é•¿åº¦çš„å¤´ï¼Œæ‰€ä»¥ä¸€å…±æ˜¯æ¡æ•°x2è¿™ä¹ˆå¤šè¡Œï¼Œæ‰€ä»¥å°±è·å–å®Œæ¡æ•°x2è¡Œåå»æ‰$å¼€å¤´çš„è¡Œï¼Œå‰©ä¸‹çš„å°±æ˜¯æ•°æ®äº†ï¼Œç¬¬ä¸€ä¸ªæ˜¯ç±»å‹ï¼Œæˆ‘ä»¬è¿™é‡Œåªéœ€è¦è·å–messageç±»å‹çš„ï¼Œå°±æ”¾è¿‡å…¶ä»–æ•°æ®ï¼Œåªéœ€è¦é‡åˆ°ç¬¬ä¸€ä¸ªå€¼æ˜¯messageçš„æ‰§è¡Œå›è°ƒå‡½æ•°è¿”å›é¢‘é“åå’Œæ¶ˆæ¯æœ¬èº«å°±è¡Œäº†ã€‚</p>
<p>å…·ä½“é¡¹ç›®æ”¾åœ¨ <a href="https://github.com/ipconfiger/TorCast">https://github.com/ipconfiger/TorCast</a> ç”±äºå®ç°å¾ˆä»“ä¿ƒè¿˜æ˜¯æœ‰å¾ˆå¤§çš„ä¼˜åŒ–ç©ºé—´ï¼Œæš‚æ—¶ä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Œå…¶ä¸­Demoå°±æ˜¯ä¸€ä¸ªèŠå¤©å®¤ï¼Œç±»ä¼¼tornadoçš„demoï¼Œä¸è¿‡æ˜¯å¯ä»¥åœ¨nginxåšåå‘ä»£ç†çš„å¤šè¿›ç¨‹ç¯å¢ƒä½¿ç”¨çš„ã€‚åæ­£å®ç°ä»“ä¿ƒä»£ç æ··ä¹±ï¼Œå¦‚äº®çæ°ªé‡‘å®çœ¼è¿˜è¯·åŸè°…åˆ™ä¸ªã€‚</p>
<p>å¦ï¼Œæˆ‘éƒ¨ç½²äº†ä¸€ä¸ªdemoåœ¨ <a href="http://42.121.19.100:8000">http://42.121.19.100:8000</a> æ¬¢è¿å‰æ¥åˆ·å±ï¼Œçœ‹çœ‹å¤šå°‘äººå¯ä»¥ç©åå®ƒ</p>
        </div>
        
        <div class="meta">
            Posted on <a href="/2013-08-08/torcast.html">2013-08-08 00:00:00</a>
        </div>
    </div>

    <div class="post">
        <h3><a href="/2011-12-11/mysql-schemaless.html">MySQLæ•°æ®åº“æ”¯æŒSchemalessçš„æ•°æ®åº“å­˜å‚¨æ–¹æ¡ˆ</a></h3>
      
        <div class="body">
            <p>åœ¨PyConä¸Šæœ‰ç«¥é‹æä¾›äº†ä¸€ä¸ªç±»ä¼¼æ¦‚å¿µçš„åˆ†äº«ï¼Œä¸è¿‡ä¸å¤§é€‚åˆä¸€èˆ¬ç±»å‹çš„äº’è”ç½‘é¡¹ç›®ï¼Œæ„Ÿè§‰æœ‰ç‚¹è¿‡äºå¦ç±»ã€‚ä¸è¿‡æˆ‘å®ç°è¿™ä¸ªæ–¹æ¡ˆæ˜¯åœ¨çœ‹åˆ°PyConçš„åˆ†äº«ä¹‹å‰ã€‚ç®—æ˜¯åŒæ ·çš„è¯‰æ±‚ä¸åŒçš„å®ç°æ–¹å¼å§ã€‚ä¸”æˆ‘è¿™é‡Œåªæ˜¯å®ç°äº†ä¸€ä¸ªæ•°æ®è®¿é—®çš„ç»„ä»¶è€Œä¸æ˜¯Serverã€‚</p>
<p>é¦–å…ˆæœ¬æ–‡çš„æ–¹æ³•æ¥è‡ªFriendFeedåˆ†äº«çš„å¦‚ä½•ä½¿ç”¨MySQLæ•°æ®åº“çš„åˆ†äº«ã€‚ç®€è€Œè¨€ä¹‹å°±æ˜¯æŠŠPythonå¯¹è±¡ç›´æ¥dumpsåzipå‹ç¼©å­˜å‚¨åœ¨MySQLä¸€ä¸ªå­—æ®µé‡Œã€‚è¿™æ ·ä¸å°±Schemalessäº†ä¹ˆï¼Ÿå­˜ä»€ä¹ˆæ•°æ®ç±»å‹ï¼Œç±»ä»€ä¹ˆç»“æ„ï¼ŒMySQLéƒ½ä¸éœ€è¦çŸ¥é“ï¼ŒåŠ ä¸ªå±æ€§ä»€ä¹ˆçš„éƒ½ä¸éœ€è¦ä¿®æ”¹æ•°æ®åº“è¡¨ç»“æ„ï¼Œå¯¹äºä¸šåŠ¡å¿«é€Ÿå˜æ›´ã€å¿«é€Ÿå¢é•¿çš„äº’è”ç½‘ä¸šåŠ¡æ¥è¯´å†åˆé€‚ä¸è¿‡äº†ã€‚è®¿é—®å¯¹è±¡ç›´æ¥é€šè¿‡ä¸»é”®æŸ¥è¯¢ï¼Œå¿«é€Ÿç›´æ¥ã€‚butï¼ŒæŸ¥è¯¢æ€ä¹ˆåŠï¼Ÿæœ‰çš„ç«¥é‹å¯èƒ½ä¼šé—®ã€‚OKï¼ŒæŸ¥è¯¢è¿™äº‹å¾—åˆ†ä¸¤è¯´ï¼Œå¦‚æœæ˜¯ç®€å•çš„æ£€ç´¢ï¼Œå¯ä»¥é€šè¿‡å»ºç´¢å¼•è¡¨çš„æ–¹å¼æ¥è§£å†³ï¼Œæˆ–è€…å‘¢ç”¨å¤–éƒ¨çš„ç´¢å¼•ï¼Œæ¯”å¦‚lucentï¼Œè¿˜èƒ½å…¨æ–‡æ£€ç´¢å“¦ã€‚ç°åœ¨è€Œä»Šçœ¼ç›®ä¸‹æˆ‘å®ç°äº†ç´¢å¼•è¡¨ç´¢å¼•çš„æ–¹å¼ï¼Œå› ä¸ºå¤–éƒ¨çš„ç´¢å¼•æ–¹å¼æ¯”è¾ƒåƒå¥‡ç™¾æ€ªï¼Œæ‰€ä»¥å¦‚æœéœ€è¦å¯ä»¥æ ¹æ®å…·ä½“æƒ…å†µè‡ªå·±æ¥å†™ä¸€ä¸ªï¼Œåæ­£å®ç°ç›¸åº”çš„å‡ ä¸ªæ–¹æ³•å°±è¡Œã€‚</p>
<p>ç›´æ¥ä¸Šä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ã€‚å‡è®¾è¦å®ç°ä¸€ä¸ªblogï¼Œéœ€è¦å­˜blogçš„ä¿¡æ¯ï¼Œå…ˆå®šä¹‰ä¸€ä¸ªblogçš„æ¨¡å‹ç±»(éœ€è¦importä»€ä¹ˆå¤§å®¶è‡ªåŠ¨è„‘è¡¥)</p>
<script src="https://gist.github.com/ipconfiger/6142119.js"></script>

<p>è¿™ä¸ªconnectionæ˜¯å› ä¸ºæˆ‘è¿˜æ²¡æƒ³å¥½å¦‚ä½•èƒ½æ— ç¼ç»“åˆåˆ°Djangoä¸­åˆèƒ½å…¼é¡¾è„±ç¦»Djangoç‹¬ç«‹ä½¿ç”¨çš„æš‚æ—¶æªæ–½ï¼Œå®Œæˆç‰ˆä¼šå»æ‰</p>
<p>å¦‚æœåœ¨ä½¿ç”¨djangoçš„è¯åªéœ€è¦ python manage.py shell ç„¶å Blog.objects.create_table()</p>
<p>è¿™ä¸ªæ—¶å€™ä¼šè‡ªåŠ¨åˆ›å»ºæ¨¡å‹å®šä¹‰çš„è¡¨å’Œç´¢å¼•è¡¨</p>
<script src="https://gist.github.com/ipconfiger/6142155.js"></script>

<p>è¿™ä¸ªæ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ Blog.objects.create(title=u"æ ‡é¢˜",content=u"å†…å®¹",post_date=datetime.datetime.now(),auther=user) æˆ–è€…Blog.objects.create(title=u"æ ‡é¢˜",content=u"å†…å®¹",post_date=datetime.datetime.now(),auther=user.id)</p>
<p>å°±èƒ½å¤Ÿåˆ›å»ºä¸€ä¸ªBlogçš„å¯¹è±¡ã€‚è¿™ä¸ªæ—¶å€™blogsè¡¨å’Œä¸¤ä¸ªç´¢å¼•è¡¨éƒ½ä¼šæ’å…¥æ•°æ®ã€‚ä¸è¿‡blogsè¡¨ä¸­çš„objectåˆ—æ˜¯äººç±»æ— æ³•ç†è§£çš„ç«æ˜Ÿæ–‡..........</p>
<p>é€šè¿‡idç›´æ¥è·å–å¯¹è±¡  Blog.objects.get(1),æ ¹æ®ç´¢å¼•è·å–  Blog.objects.auther.query(auther=user.id) æˆ–è€…  Blog.objects.auther.query(auther=user)</p>
<p>è¿™ä¸ªä¼šç”ŸæˆSQLï¼ŒSELECT <code>id</code> FROM  <code>blog_idx_auther</code> WHERE <code>auther</code>=%s ç„¶åå–å‡ºmatchåˆ°å¯¹è±¡çš„idåˆ—è¡¨ï¼Œç„¶åéå†idåˆ—è¡¨ï¼Œé€šè¿‡ Blog.objects.get(id)è·å¾—çš„å¯¹è±¡åˆ—è¡¨ã€‚</p>
<p>Blog.objects.get(id)çš„æ—¶å€™æ˜¯æœ‰å¯¹è±¡ç¼“å­˜çš„ï¼ˆç°é˜¶æ®µé€šè¿‡rediså®ç°ï¼‰ï¼Œæ‰€ä»¥ç»è¿‡æµ‹è¯•ï¼Œé€Ÿåº¦æ˜¯é è°±çš„ã€‚è€Œç›¸å¯¹MangoDBæ¥è¯´ï¼ŒMySQLçš„æ•°æ®å­˜å‚¨ä¹Ÿæ›´åŠ é è°±ä¸€ç‚¹ï¼Œæ‰€ä»¥ç›¸æ¯”æ¢ç°åœ¨è€Œä»Šçœ¼ç›®ä¸‹è¿˜ä¸æ€ä¹ˆé è°±çš„mangodbæ¥ä½œä¸ºä¸»å­˜å‚¨æ¥è¯´ï¼ŒåŸºäºMySQLçš„Schemalessæ–¹æ¡ˆè¿˜æ˜¯ç›¸å¯¹é è°±çš„ã€‚</p>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/ipconfiger/free4my">https://github.com/ipconfiger/free4my</a> å†…é™„demoçš„blogå®ç°ä¸€æš</p>
        </div>
        
        <div class="meta">
            Posted on <a href="/2011-12-11/mysql-schemaless.html">2011-12-11 00:00:00</a>
        </div>
    </div>

    <div class="post">
        <h3><a href="/2011-11-12/django-long-conn.html">è®©Djangoæ”¯æŒæ•°æ®åº“é•¿è¿æ¥</a></h3>
      
        <div class="body">
            <p>ä¹¦æ¥ä¸Šå› </p>
<p>ä¸Šå›æˆ‘ä»¬è¯´åˆ°ï¼š<a href="http://www.cnblogs.com/Alexander-Lee/archive/2011/05/02/tornado_host_django.html">ã€Šåœ¨ç”Ÿäº§ç³»ç»Ÿä½¿ç”¨Tornado WebServeræ¥ä»£æ›¿FastCGIåŠ é€Ÿä½ çš„Djangoåº”ç”¨ã€‹</a></p>
<p>é‚£ä¹ˆç°åœ¨å¾ˆæµè¡Œç”¨ä¸€äº›é«˜æ€§èƒ½çš„nonblockçš„app serveræ¥host Djangoçš„åº”ç”¨ï¼Œè¿™äº›Serverå¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªå•è¿›ç¨‹å•çº¿ç¨‹çš„ç¨‹åºï¼Œç„¶åç”¨nginxåœ¨å‰ç«¯åå‘ä»£ç†å¹¶ä¸”è´Ÿè½½å‡è¡¡åˆ°Nå¤šä¸ªåç«¯å·¥ä½œè¿›åŸæ¥å……åˆ†åˆ©ç”¨å¤šCPUçš„æ€§èƒ½ï¼Œå½“ç„¶è¿™éƒ¨åˆ†çš„é…ç½®å·¥ä½œåœ¨ä¸Šå›å·²ç»è¯´å¾—å¾ˆæ¸…æ¥šäº†ã€‚ä½†æ˜¯å¯¹äºDjangoæ¥è¯´æœ‰ä¸€ä¸ªé—®é¢˜ã€‚å› ä¸ºDjangoçš„æ•°æ®åº“è¿æ¥æ˜¯åœ¨æŸ¥è¯¢çš„æ—¶å€™å®æ—¶åˆ›å»ºçš„ï¼Œç”¨å®Œå°±ä¼šå…³æ‰ï¼Œè¿™æ ·å°±ä¼šé¢‘ç¹çš„å¼€é—­è¿æ¥ã€‚ä½†æ˜¯å¯¹äºTornadoè¿™ç§Serveræ¥è¯´è¿™ç§æ–¹å¼æ˜¯ä½æ•ˆçš„ã€‚è¿™ç§Serveræœ€é«˜æ•ˆçš„å·¥ä½œæ¨¡å¼æ˜¯æ¯ä¸ªè¿›ç¨‹å¼€å¯ä¸€ä¸ªè¿æ¥ï¼Œå¹¶é•¿æœŸä¿æŒä¸å…³é—­ã€‚æœ¬æ–‡çš„ç›®çš„å°±æ˜¯å°è¯•ä½¿Djangoæ”¹å˜ä¸€è´¯çš„ä½œé£ï¼Œé‡‡ç”¨è¿™ç§é«˜æ•ˆçš„å·¥ä½œæ¨¡å¼ã€‚æœ¬æ–‡åŸºäºDjango1.3çš„ç‰ˆæœ¬ï¼Œå¦‚æœæ˜¯ä½ç‰ˆæœ¬å¯ä»¥ç¨åŠ æ›´æ”¹ä¸€æ ·å¯ä»¥ä½¿ç”¨ã€‚</p>
<p>Djangoçš„æ•°æ®åº“å¯ä»¥é€šè¿‡é…ç½®ä½¿ç”¨ä¸“é—¨å®šåˆ¶çš„Backendï¼Œæˆ‘ä»¬å°±ä»è¿™é‡Œå…¥æ‰‹ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬çœ‹çœ‹Djangoè‡ªå¸¦çš„Backendæ˜¯å¦‚ä½•å®ç°çš„ã€‚åœ¨Djangoå®˜ç½‘ä¸Šå¯ä»¥çœ‹åˆ°è‡ªå¸¦MySqlçš„Packageç»“æ„ï¼Œå¯ä»¥ç‚¹å‡» æ­¤å¤„ å‰å¾€ç»ä»°ã€‚</p>
<p>é€šè§‚æºç æˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒDjangoåŸºæœ¬ä¸Šæ˜¯å°è£…äº†MySQLdbçš„Connectionå’ŒCursorè¿™ä¸¤ä¸ªå¯¹è±¡ã€‚è€Œä¸”é‡å¤´å®ç°æ•´ä¸ªBackendæ—¢ä¸å®é™…è€Œä¸”ä¹Ÿä¸èƒ½ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ¢ä¸€ä¸ªæ€è·¯ã€‚æ‰€æœ‰çš„æ•°æ®åº“æ“ä½œéƒ½æ˜¯ä»è·å–Connectionå¯¹è±¡å¼€å§‹çš„ï¼Œè€Œè·å–Connectionå¯¹è±¡åªæœ‰ä¸€ä¸ªå…¥å£ï¼Œå°±æ˜¯MySQLdb.connectè¿™ä¸ªå‡½æ•°ã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦åŒ…è£…MySQLdbè¿™ä¸ªæ¨¡å—ï¼Œç”¨æˆ‘ä»¬è‡ªå·±çš„connectæ–¹æ³•æ›¿ä»£åŸæœ¬çš„ï¼Œè¿™æ ·å°±ä»æ ¹æºä¸Šè§£å†³äº†é—®é¢˜ã€‚æˆ‘ä»¬åœ¨åŒ…è£…å™¨å†…éƒ¨ç»´æŠ¤MySQLdbçš„Connectionå¯¹è±¡ï¼Œä½¿å…¶ä¿æŒé•¿è¿æ¥ï¼Œæ¯æ¬¡connectè¢«è°ƒç”¨çš„æ—¶å€™åˆ¤æ–­ä¸€ä¸‹ï¼Œå¦‚æœè¿æ¥å­˜åœ¨å°±è¿”å›ç°æœ‰è¿æ¥ï¼Œä¸å°±å®Œç¾äº†å—ï¼Ÿæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ†åˆ†é’Ÿå†™ä¸‹ç¬¬ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼š</p>
<script src="https://gist.github.com/ipconfiger/6141949.js"></script>

<p>æŠŠä¸Šé¢ä»£ç å­˜åˆ°ä¸€ä¸ªå«pool.pyçš„æ–‡ä»¶é‡Œã€‚ç„¶åæŠŠDjangoæºç é‡Œçš„db/backend/mysqlè¿™ä¸ªpackageæ‹·è´å‡ºæ¥ï¼Œå•ç‹¬å­˜åˆ°æˆ‘ä»¬projectç›®å½•é‡Œä¸€ä¸ªmysql_poolçš„ç›®å½•é‡Œã€‚ç„¶åä¿®æ”¹å…¶ä¸­çš„base.pyï¼Œåœ¨é¡¶ä¸Šimportçš„éƒ¨åˆ†ï¼Œæ‰¾åˆ° import MySQLdb as Database è¿™å¥ï¼Œç”¨ä¸‹é¢ä»£ç æ›¿æ¢ä¹‹</p>
<script src="https://gist.github.com/ipconfiger/6141966.js"></script>

<p>è¿™æ ·æˆ‘ä»¬å°±ç”¨è‡ªå·±çš„æ¨¡å—æ›¿æ¢äº†MySQLdbçš„ï¼Œå½“è¦connectçš„æ—¶å€™åˆ¤æ–­åˆ°æœ‰è¿æ¥çš„æ—¶å€™å°±ä¸é‡æ–°åˆ›å»ºè¿æ¥äº†ã€‚</p>
<p>æŠŠç«™ç‚¹è·‘èµ·æ¥çœ‹ï¼Œç»“æœå¦‚ä½•ï¼Ÿåˆ·æ–°å‡ æ¬¡åæŠ¥é”™äº†ã€‚Whyï¼Ÿçœ‹çœ‹æ—¥å¿—å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„é”™è¯¯ï¼š</p>
<script src="https://gist.github.com/ipconfiger/6142422.js"></script>

<p>çœ‹æ¥æˆ‘ä»¬å…‰æ˜¯åŒ…è£…äº†MySQLdbæœ¬èº«è¿˜ä¸è¡Œï¼Œåœ¨connectåDjangoè·å–äº†Connectionçš„å¯¹è±¡ï¼Œä¹‹åå°±èƒ½ä¸ºæ‰€æ¬²ä¸ºï¼Œä»–ç”¨å®Œåå¾ˆè‡ªè§‰çš„å…³æ‰äº†ï¼Œå› ä¸ºä»–ç›´è§‰çš„ä»¥ä¸ºæ¯æ¬¡connectéƒ½æ‹¿åˆ°äº†æ–°çš„Connectionå¯¹è±¡ã€‚æ‰€ä»¥æˆ‘ä»¬å¿…é¡»æŠŠConnectionå¯¹è±¡ä¹ŸåŒ…è£…äº†äº†ã€‚æ‰€ä»¥å‡çº§åçš„è§£å†³æ–¹æ¡ˆä»£ç å¦‚ä¸‹ï¼š</p>
<script src="https://gist.github.com/ipconfiger/6141996.js"></script>

<p>æˆ‘ä»¬å¢åŠ äº†ä¸€ä¸ª_ConnectionWrapperç±»æ¥ä»£ç†Connectionå¯¹è±¡ï¼Œç„¶åå±è”½æ‰closeå‡½æ•°ã€‚æŠŠç«™ç‚¹è·‘èµ·æ¥åå‘ç°ä¸ä¼šå‡ºç°ä¹‹å‰çš„é—®é¢˜äº†ï¼Œè·‘èµ·æ¥ä¹Ÿé¡ºç•…ä¸å°‘ã€‚ä½†æ˜¯è¿‡äº†å‡ ä¸ªå°æ—¶åé—®é¢˜åˆæ¥äº†ã€‚å› ä¸ºMySQLdbçš„Connectionæœ‰ä¸ªå¾ˆè›‹ç—›çš„é—®é¢˜ï¼Œå°±æ˜¯è¿æ¥é—²ç½®8å°æ—¶åä¼šè‡ªå·±æ–­æ‰ã€‚ä¸è¿‡è¦è§£å†³è¿™ä¸ªé—®é¢˜å¾ˆç®€å•ï¼Œæˆ‘ä»¬å‘ç°è¿æ¥å¦‚æœé—²ç½®äº†å¿«8å°æ—¶å°±closeæ‰é‡æ–°å»ºç«‹ä¸€ä¸ªè¿æ¥ä¸å°±è¡Œäº†ä¹ˆï¼Ÿæ‰€ä»¥æœ€åè§£å†³æ–¹æ¡ˆçš„ä»£ç å¦‚ä¸‹ï¼š
ã€€
<script src="https://gist.github.com/ipconfiger/6142002.js"></script></p>
<p>å°±æ­¤é—®é¢˜è§£å†³ï¼Œä¸–ç•Œç»ˆäºæ¸…å‡€äº†</p>
        </div>
        
        <div class="meta">
            Posted on <a href="/2011-11-12/django-long-conn.html">2011-11-12 00:00:00</a>
        </div>
    </div>

    <div class="post">
        <h3><a href="/2011-09-27/translate-tornado-template-document.html">ç¿»è¯‘å¤„å¥³ä½œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ï¼tornadoçš„æ¨¡æ¿ç³»ç»Ÿæ–‡æ¡£</a></h3>
      
        <div class="body">
            <p>jekyllçš„è½¬ä¹‰ç¬¦å¤ªå‘çˆ¹æ‰€ä»¥æ ¼å¼ä¹±æ‰ï¼Œè¿˜æ˜¯çœ‹è€åœ°å€å§<a href="http://www.cnblogs.com/Alexander-Lee/archive/2011/09/27/tornado_template.html">ä¼ é€ä»¬</a> ï¼Œä»¥å‰çš„Blogæ–‡ç« å†…åµŒå…¥äº†å¤ªå¤šä»£ç ï¼Œæ¬è¿å›°éš¾</p>
        </div>
        
        <div class="meta">
            Posted on <a href="/2011-09-27/translate-tornado-template-document.html">2011-09-27 00:00:00</a>
        </div>
    </div>

    <div class="post">
        <h3><a href="/2011-08-23/test.html">A Test Post</a></h3>
      
        <div class="body">
            <p>us imperdiet cursus mi congue. Cras ante augue, aliquam feugiat elementum quis, ullamcorper id lacus. Phasellus quis lectus nec elit pretium scelerisque. Aliquam leo felis, semper vel pellentesque id, tincidunt sed nisi. In lacus diam, faucibus ut euismod non, hendrerit quis sem. In quis massa vitae quam feugiat tempus. In eleifend tincidunt tellus a euismod. Aenean elementum, nisl sit amet fringilla lobortis, quam turpis consectetur urna, nec sollicitudin arcu justo vel magna.</p>
<p>Sed et lorem orci. Nullam consectetur elementum nibh, at aliquam metus adipiscing eget. Ut tincidunt fermentum urna, a eleifend dui volutpat eget. Integer varius nunc nec nulla tristique interdum. Suspendisse imperdiet libero sit amet lacus elementum nec dignissim dui accumsan. Curabitur at felis nunc, eu fermentum nisl. Curabitur quis ante non nisl hendrerit varius. Aliquam quis diam non massa gravida malesuada eu quis mi. Aenean tincidunt nunc vel sapien fermentum eu aliquam arcu tempor. Nulla risus</p>
<pre><code>def func():
    doc={"id":123}
    print doc
</code></pre>
        </div>
        
        <div class="meta">
            Posted on <a href="/2011-08-23/test.html">2011-08-23 00:00:00</a>
        </div>
    </div>

    <div class="post">
        <h3><a href="/2011-05-02/tornado-for-django.html">åœ¨ç”Ÿäº§ç³»ç»Ÿä½¿ç”¨Tornado WebServeræ¥ä»£æ›¿FastCGIåŠ é€Ÿä½ çš„Djangoåº”ç”¨</a></h3>
      
        <div class="body">
            <p>ç”±äºæ¢äº†å·¥ä½œï¼Œæ‰€ä»¥ä¹‹å‰çš„æ¸¸æˆå¼•æ“æš‚æ—¶æ”¾ä¸‹ï¼Œä½†æ˜¯ä¸ä¼šåœæ­¢çš„ï¼Œè¿™ä¸ªé¡¹ç›®ä¼šåœ¨æˆ‘çš„ä¸šä½™æ—¶é—´æ¥å®Œæˆã€‚</p>
<p>---------------------------------------é—·éªšçš„åˆ†å‰²çº¿ï¼Œä¸‹é¢æ˜¯æ­£æ–‡-------------------------------------------</p>
<p>tornadoæˆ‘åœ¨ä¹‹å‰çš„æ–‡ç« é‡Œå·²ç»æœ‰è¿‡å¤šæ¬¡ä»‹ç»ï¼Œåœ¨æ­¤å°±ä¸è¯¦ç»†ä»‹ç»äº†ï¼Œ</p>
<p>è¯¦ç»†ä»‹ç»å¯å‚è§ï¼š</p>
<p><a href="http://www.cnblogs.com/Alexander-Lee/archive/2010/03/20/1690292.html">ç©è›‡è®°-ä½¿ç”¨tornadoæ„å»ºé«˜æ€§èƒ½Webåº”ç”¨ä¹‹ä¸€</a> </p>
<p><a href="http://www.cnblogs.com/Alexander-Lee/archive/2010/03/24/1693367.html">ç©è›‡è®°-ä½¿ç”¨Tornadoæ„å»ºé«˜æ€§èƒ½Webä¹‹äºŒ-autoreload</a></p>
<p>ç”±äºå®˜ç½‘è¢«å¢™ï¼Œè®¨è®ºç»„ä¹Ÿè¢«å¢™ï¼ˆå›§ï¼Œä¸‡æ¶çš„å¢™ï¼‰æ‰€ä»¥tornadoçš„èµ„æ–™å¾ˆå°‘ï¼Œå®˜ç½‘çš„èµ„æ–™ä¹Ÿè¯­ç„‰ä¸è¯¦ï¼Œæ‰€ä»¥å¾ˆå¤šç«¥é‹å¯¹å¦‚ä½•éƒ¨ç½²ä½¿ç”¨Tornadoå¿ƒé‡Œæ²¡åº•ã€‚æ‰€ä»¥æœ¬æ–‡çš„ä¸»è¦ç›®çš„å°±æ˜¯æ•™ä¼šåˆšå…¥é—¨çš„æ–°æ‰‹å¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨Tornado</p>
<p>Tornadoæ˜¯ä¸€ä¸ªå¼‚æ­¥webæ¡†æ¶å’ŒæœåŠ¡å™¨ï¼Œæ‰€ä»¥åœ¨å¼€å‘longpullingçš„chatä¹‹ç±»åº”ç”¨éå¸¸çš„åˆé€‚ï¼Œä½†æ˜¯å…¶å®æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„httpæœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªWSGIServerã€‚æ‰€ä»¥å³ä½¿ä½ çš„ç½‘ç«™æ²¡æœ‰ä½¿ç”¨Tornadoçš„æ¡†æ¶ï¼Œè€Œæ˜¯ç”¨äº†web.pyæˆ–è€…æ˜¯Djangoæ¥å¼€å‘ï¼ˆå‚»ç“œä¸‡å²ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™Tornadoä¾ç„¶å¯ä»¥ç”¨æ¥åŠ é€Ÿä½ çš„ç½‘ç«™ã€‚ä½¿ç”¨Tornadoæ¥ä»£æ›¿fastCGIå¯ä»¥å¤§å¹…æé«˜æ€§èƒ½ï¼Œä¸”å¯ä»¥æ‰¿è½½çš„å¹¶å‘èƒ½åŠ›ä¹Ÿæœ‰äº†æˆå€çš„æé«˜ï¼ˆå¤§å®¶å¯ä»¥è‡ªå·±Profileï¼Œæœ¬æ–‡åªä»‹ç»å¦‚æœåšï¼‰ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬å¼€å§‹æ¥ä»‹ç»å¦‚ä½•é…ç½®ã€‚è¿™é‡Œæˆ‘ä»¬å‡è®¾ä½ çš„ä¸€ä¸ªç”¨Djangoå†™çš„ç½‘ç«™åœ¨ä¸€å°Linuxçš„æœåŠ¡å™¨ä¸Šå¿«ä¹åœ°ç€ï¼ˆubuntu or CentOSï¼Œæ²¡è¯•è¿‡åœ¨å…¶ä»–å‘è¡Œç‰ˆæŠ˜è…¾è¿‡ï¼Œwindowsï¼Ÿä½ åœ¨è¯´ç¬‘å§ï¼‰ï¼Œéšç€ç½‘ç«™è¶Šæ¥è¶Šçº¢ç«ï¼Œä½ è¶Šå‘æ„Ÿè§‰æœåŠ¡å™¨ä¸å ªé‡è´Ÿã€‚è¿™ä¸ªæ—¶å€™Tornadoå‡ºç°äº†ï¼Œä»–å¯ä»¥è®©ä½ å†è‹Ÿå»¶æ®‹å–˜å¥½å‡ ä¸ªæœˆï¼ŒèŠ‚çº¦ä¸€å¤§æŠŠçš„é“¶å­å»æŠŠå¦¹.............å›åˆ°æ­£é¢˜ã€‚æ ¹æ®å®˜ç½‘çš„æ¨èéƒ¨ç½²æ–¹å¼ï¼Œæˆ‘ä»¬è¿˜æ˜¯é‡‡ç”¨Nginxé€šè¿‡upstreamæ¥åå‘ä»£ç†åˆ°Nä¸ªTornadoçš„æœåŠ¡å™¨å®ä¾‹ä¸Šçš„éƒ¨ç½²æ–¹å¼ã€‚so</p>
<p>Setp1ï¼šå®‰è£…supervisord</p>
<p>ç”±äºTornadoå¹¶æ²¡æœ‰è‡ªèº«æä¾›Daemonçš„èƒ½åŠ›ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨ä¸€ä¸ªæœåŠ¡ç®¡ç†å·¥å…·æ¥ç®¡ç†Tornadoçš„è¿›ç¨‹ï¼Œsupervisordæ˜¯ç”¨Pythonå®ç°çš„ä¸€æ¬¾éå¸¸å®ç”¨çš„è¿›ç¨‹ç®¡ç†å·¥å…·ã€‚å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç®¡ç†Nè¿‡è¿›ç¨‹ï¼Œä¸”æ”¯æŒè¿›ç¨‹åˆ†ç»„ã€‚Supervisordå¯ä»¥é€šè¿‡sudo easy_install supervisorå®‰è£…ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡Supervisordå®˜ç½‘ä¸‹è½½åsetup.py installå®‰è£…ã€‚</p>
<p>Step2: ç»™Djangoçš„ç«™ç‚¹å¢åŠ ä¸€ä¸ªTornadoçš„æœåŠ¡å™¨æ–‡ä»¶ï¼ˆæ¯”å¦‚serv.pyï¼‰</p>
<p>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶Serv.pyåœ¨Djangoç«™ç‚¹çš„æ ¹ç›®å½•ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<script src="https://gist.github.com/ipconfiger/6142227.js"></script>

<p>æˆ‘è¿™é‡Œé€šè¿‡ç¬¬ä¸€ä¸ªå‚æ•°æ¥æŒ‡å®šTornadoæœåŠ¡ç›‘å¬çš„ç«¯å£ã€‚è¿™æ ·æ¯”è¾ƒçµæ´»ï¼Œè¿™ç‚¹æˆ‘ä»¬åœ¨åé¢çš„æ­¥éª¤ä¼šç”¨åˆ°ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡</p>
<p>python Serv.py 8000</p>
<p>è¿™ä¸ªå‘½ä»¤æ¥å¯åŠ¨æœåŠ¡å™¨</p>
<p>Step3: é…ç½®Supervisord</p>
<p>ç¬¬ä¸€æ­¥å®‰è£…çš„Supervisordè¿˜æ²¡æœ‰é…ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶çš„æ ·æ¿ã€‚åœ¨rootæƒé™ä¸‹æ‰§è¡Œ</p>
<p>echo_supervisord_conf &gt; /etc/supervisord.conf</p>
<p>è¿™ä¸ªæ—¶å€™åœ¨/etc/åˆ›å»ºäº†é…ç½®æ–‡ä»¶ï¼Œç”¨vimæ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œåœ¨é…ç½®æ–‡ä»¶çš„å±è‚¡åé¢åŠ ä¸Šä»¥ä¸‹è¿™ä¸€æ®µ</p>
<script src="https://gist.github.com/ipconfiger/6142234.js"></script>

<p>è¿™ä¸ªé…ç½®ä¼šå¯åŠ¨4ä¸ªTornadoçš„æœåŠ¡è¿›ç¨‹åˆ†åˆ«ç›‘å¬ 8001,8002,8003,8004 è¿™å››ä¸ªç«¯å£</p>
<p>commandè¿™ä¸€è¡Œæ˜¯è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œè¿™é‡Œæ˜¯ç”¨ python /var/www/site/Serv.py ç«¯å£å·æ¥å¯åŠ¨Tornadoçš„æœåŠ¡è¿›ç¨‹ 80%(process_num)02d çš„ç”¨é€”æ˜¯é€šè¿‡è¿›ç¨‹ç¼–å·æ¥ç”Ÿæˆç«¯å£å·ã€‚ä¸‹é¢çš„process_nameè¿™ä¸ªå‚æ•°ä¹Ÿä¼šç”¨åˆ°ã€‚è¿™é‡Œè¦æŒ‡å®šçš„æ–‡ä»¶åå°±æ˜¯ä¸Šä¸€æ­¥æˆ‘ä»¬åˆ›å»ºé‚£ä¸ªServ.pyæ–‡ä»¶</p>
<p>process_nameæ˜¯è¿›ç¨‹çš„åå­—ï¼Œç”±äºè¿™é‡Œè¦å¯åŠ¨4ä¸ªè¿›ç¨‹ï¼Œæ‰€ä»¥è¦ç”¨process_numæ¥åŒºåˆ†</p>
<p>umaskæ˜¯ç¨‹åºæ‰§è¡Œçš„æƒé™å‚æ•°</p>
<p>startsecsè¿™ä¸ªå‚æ•°æ˜¯ç¨‹åºå¯åŠ¨çš„ç­‰å¾…æ—¶é—´</p>
<p>stopwaitsecsè¿™ä¸ªå‚æ•°æ˜¯ç¨‹åºåœæ­¢çš„ç­‰å¾…æ—¶é—´</p>
<p>redirect_stderrè¿™ä¸ªå‚æ•°å°†é”™è¯¯æµé‡å®šå‘åˆ°stdçš„æµè¾“å‡ºï¼Œè¿™æ ·å¯ä»¥çœå»ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶çš„é…ç½®ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä¸ç”¨è¿™ä¸ªå‚æ•°åˆ†å¼€é…ç½®æ—¥å¿—æ–‡ä»¶</p>
<p>stdout_logfile è¿™ä¸ªå‚æ•°æ˜¯STDæµè¾“å‡ºæ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ï¼ŒTornadoä¼šè¾“å‡ºæ‰€æœ‰çš„è¯·æ±‚å’Œé”™è¯¯ä¿¡æ¯ï¼Œé€šè¿‡è¿™ä¸ªå¯ä»¥ç»Ÿä¸€åšæ—¥å¿—å¤„ç†ï¼Œåˆ†éš”ä»€ä¹ˆçš„ï¼Œåœ¨ç¨‹åºé‡Œå°±åªéœ€è¦printåˆ°stdæµå°±è¡Œäº†ã€‚</p>
<p>numprocs è¿™ä¸ªå‚æ•°æŒ‡å®šäº†è¿›ç¨‹çš„æ•°é‡ï¼Œè¿™é‡Œæ˜¯4ï¼Œè¡¨æ˜è¦å¯åŠ¨4ä¸ªTornadoè¿›ç¨‹</p>
<p>numprocs_start è¿™ä¸ªå‚æ•°æŒ‡å®šäº†è¿›ç¨‹å·çš„èµ·å§‹ç¼–å·ï¼Œè¿™é‡Œæ˜¯1ï¼Œè¿™æ ·å‰é¢çš„commandå’Œprocess_nameé‡Œçš„%(process_num)02déƒ¨åˆ†å°±ä¼šåœ¨æ‰§è¡Œçš„æ—¶å€™è¢«æ›¿æ¢ä¸º01~05çš„å­—ç¬¦ä¸²</p>
<p>é…ç½®ä¿®æ”¹å®Œæˆå:wqä¿å­˜é€€å‡ºï¼Œæ‰§è¡Œï¼š</p>
<p>supervisorctl reload</p>
<p>é‡æ–°åŠ è½½é…ç½®åï¼Œè¿™äº›è¿›ç¨‹å°±å¯åŠ¨èµ·æ¥äº†</p>
<p>Step4ï¼šä¿®æ”¹é…ç½®Nginx</p>
<p>é¦–å…ˆæ‰¾åˆ°åœ¨vhostç›®å½•é‡Œä½ çš„ç«™ç‚¹é…ç½®æ–‡ä»¶ï¼Œæ‰“å¼€åï¼Œåœ¨å¤´ä¸Šå¢åŠ upstreamçš„å†…å®¹</p>
<script src="https://gist.github.com/ipconfiger/6142241.js"></script>

<p>ç„¶ååœ¨Serveré…ç½®èŠ‚é‡Œæ‰¾åˆ°</p>
<p>location è¿™ä¸ªé…ç½®èŠ‚</p>
<p>å°†å†…éƒ¨æ¸…ç©ºï¼Œåœ¨å…¶ä¸­åŠ å…¥upstreamçš„é…ç½®ï¼Œå˜æˆå¦‚ä¸‹æ ·å­</p>
<script src="https://gist.github.com/ipconfiger/6142265.js"></script>

<p>ä¿å­˜é…ç½®æ–‡ä»¶åæ‰§è¡Œ  è®©nginxé‡å¯çš„æŒ‡ä»¤ nginx -s reload(æ³¨æ„ nginxæ–‡ä»¶åœ¨ä¸åŒå‘è¡Œç‰ˆä¸­ä½ç½®æœ‰å·®åˆ«)</p>
<p>ç„¶åä½ å°±èƒ½å¤Ÿé€šè¿‡åŸŸåçœ‹åˆ°ä½ çš„ç½‘ç«™äº†ï¼Œè¯•è¯•æ˜¯ä¸æ˜¯å¿«å¤šäº†</p>
<p>æ³¨æ„ï¼šç”Ÿäº§ç³»ç»Ÿä¸‹å¼€å¯å¤šå°‘ä¸ªTornadoè¿›ç¨‹æ¯”è¾ƒå¥½å‘¢ï¼Œè¿™ä¸ªè§ä»è§æ™ºäº†ï¼Œæ®æˆ‘å‹åŠ›æµ‹è¯•çš„ç»“æœçœ‹æ¥ï¼Œç”¨CPUæ ¸æ•°x2çš„æ•°é‡æœ€å¥½ï¼Œå†å¤š å°±æµªè´¹äº†æ²¡æœ‰æå‡ï¼ˆä¸ºä»€ä¹ˆä¹˜2ï¼Ÿå› ä¸ºæœ‰ç§CPUä¸Šçš„æŠ€æœ¯å«è¶…çº¿ç¨‹ï¼‰ã€‚æˆ‘çš„VPSä¸Šç”¨çš„4ä¸ªè¿›ç¨‹ã€‚å¦‚æœæ˜¯8æ ¸IntelCPUè¦æŒ–å°½CPUæ½œèƒ½çš„è¯éœ€è¦å¼€16ä¸ªè¿›ç¨‹</p>
        </div>
        
        <div class="meta">
            Posted on <a href="/2011-05-02/tornado-for-django.html">2011-05-02 00:00:00</a>
        </div>
    </div>



      </div>
    </div>

    <div class="footer" align="center">

  Copyright &copy; <a href=http://diezcami.github.io target="_blank">Camille Diez</a> 2015<BR />
  Powered by <a href=http://jekyllrb.com target="_blank">Jekyll</a>

</div>

  </body>
</html>